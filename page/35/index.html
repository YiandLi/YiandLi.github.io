<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":20,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="A foolish, slow learner.">
<meta property="og:type" content="website">
<meta property="og:title" content="Yili">
<meta property="og:url" content="http://example.com/page/35/index.html">
<meta property="og:site_name" content="Yili">
<meta property="og:description" content="A foolish, slow learner.">
<meta property="og:locale">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/35/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Yili</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yili</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Suggest Google Chrome for better math Reading.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/MySQL%20info/mysql%20%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/03/MySQL%20info/mysql%20%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">mysql 事务 Transaction</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-03 22:49:21" itemprop="dateCreated datePublished" datetime="2021-03-03T22:49:21-08:00">2021-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>6 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>定义：</p>
<ul>
<li>是一组操作的集合，是一个不可分割的工作单位。</li>
<li>会把所有的操作作为一个整体一起向系统提交或者撤销；即这些操作要么同时成功，要么同时失败。</li>
</ul>
<p>只有使用了 <strong>Innodb</strong> 数据库引擎的数据库或表才支持事务。</p>
<p>流程：</p>
<ol>
<li>开启事务</li>
<li>执行事务内部操作，如果发成异常，则回滚事务</li>
<li>提交事务，此时数据库才会更新，而且是一次性更新所有事务内部的操作</li>
</ol>
<p>好处：保证了数据的完整性和一致性</p>
<h2 id="回滚"><a class="markdownIt-Anchor" href="#回滚"></a> 回滚</h2>
<h3 id="查看-设置事务提交方式"><a class="markdownIt-Anchor" href="#查看-设置事务提交方式"></a> 查看 / 设置事务提交方式</h3>
<p>查看提交方式，默认为自动提交。所有指令都直接提交，所以无法回滚。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@autocommit;</span><br><span class="line">&gt;&gt;&gt; 1</span><br></pre></td></tr></table></figure>
<p>修改提交方式为手动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`SET @@autocommit=0;`</span><br></pre></td></tr></table></figure>
<p>有两种方式支持回滚</p>
<ol>
<li>设置提交方式为 <strong>手动</strong>，无论做出什么修改都要<code>commit</code>/<code>rollback</code>，并且可以多次回滚。</li>
<li>开启事务方式，支持回滚一次。</li>
</ol>
<h3 id="手动提交事务"><a class="markdownIt-Anchor" href="#手动提交事务"></a> 手动提交事务</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@autocommit;</span><br><span class="line">&gt;&gt;&gt; 1</span><br><span class="line"></span><br><span class="line"># 设置手动回滚</span><br><span class="line">SET @@autocommit=0;</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line">COMMIT;</span><br><span class="line"></span><br><span class="line"># ... 一些sql操作命令，数据是改变的，但是还没有提交</span><br><span class="line"></span><br><span class="line"># 回滚事务</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure>
<p>这个 ROLLBACK 不会清楚缓存，可以回滚多次。<br />
这种方式不会自动修改数据，必须要 COMMIT，或者 ROLLBACK。</p>
<h3 id="自动提交模式下开启事务"><a class="markdownIt-Anchor" href="#自动提交模式下开启事务"></a> 自动提交模式下开启事务</h3>
<p><code>START TRANSACTION;</code>或者<code>BEGIN;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@autocommit;</span><br><span class="line">&gt;&gt;&gt; 1</span><br><span class="line"></span><br><span class="line"># 开启事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ... 一些sql操作命令，数据改变，但是还没有提交</span><br><span class="line"></span><br><span class="line"># 回滚事务，此次生效，回滚成功</span><br><span class="line">ROLLBACK;</span><br><span class="line"></span><br><span class="line"># 提交事务，和上面的回滚事务只能选一个</span><br><span class="line">COMMIT;</span><br><span class="line"></span><br><span class="line"># ... 一些sql操作命令，数据改变</span><br><span class="line"></span><br><span class="line"># 第二次回滚事务，此次无法生效，缓存被清除了</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure>
<p>也就是说这种方式，仍然是自动修改数据，但是支持回滚，但是只能回滚一次，其实就是事务结束了。<br />
如果指定<code>START TRANSACTION</code>，则会立即启动一个事务，并且必须通过显式<code>COMMIT</code>或<code>ROLLBACK</code>来结束该事务。</p>
<h2 id="事务四大特性acid"><a class="markdownIt-Anchor" href="#事务四大特性acid"></a> 事务四大特性（ACID）</h2>
<ol>
<li>原子性（Atomicity）：事务中的操作是不可分割的，是一个原子。要么全成功，要么全失败。</li>
<li>一致性（Consistency）：事务完成前后，数据需要一致，比如金额总额一致。</li>
<li>隔离性（Isolation）：两个操作并发执行时，相互不影响。</li>
<li>持久性（Durability）：事务一旦提交或者回滚对数据库的改变就是永久的。</li>
</ol>
<h2 id="并发事务引发的问题"><a class="markdownIt-Anchor" href="#并发事务引发的问题"></a> 并发事务引发的问题</h2>
<p>博客：<a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/concurrency-problems-in-dbms-transactions/">Concurrency problems in DBMS Transactions</a><br />
两个事务 A，B在同时操作一个表时，引发的问题。</p>
<p>分类：</p>
<ul>
<li>脏读(Temporary Update Problem / Dirty read problem)：一个事务读取到<strong>另一个事务还没有提交</strong>的数据。</li>
<li>不可重复读(Unrepeatable Read Problem)：一个事务先后读取同一条数据，但是两次读取的记录不同。</li>
<li>幻读(Phantom Read Problem)：一个事务查询数据时，没有查询到数据行，然后决定插入。（这时另一个并发进程在执行插入）但是在插入时，发现已经存在。</li>
</ul>
<h2 id="事务隔离界别"><a class="markdownIt-Anchor" href="#事务隔离界别"></a> 事务隔离界别</h2>
<p>为了解决事务引发的问题</p>
<table>
<thead>
<tr>
<th>隔离级别名称</th>
<th></th>
<th>会出现脏读</th>
<th>会出现不可重复读</th>
<th>会出现幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read Uncommitted</td>
<td>可以读到其他事务<strong>修改过但是还没有提交</strong>的数据</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>Read Committed</td>
<td>只能读到其他事务<strong>已经提交</strong>的数据</td>
<td></td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>Repeatable Read <br>(<strong>Default</strong>)</td>
<td>事务B只能在事务A修改并提交过数据后，自己也提交事务后，<br> 才能读到事务B修改的数据。</td>
<td></td>
<td></td>
<td>✓</td>
</tr>
<tr>
<td>Serializable</td>
<td>事务之间通过一个接一个串行地执行<br>通过加锁实现（读锁和写锁）</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="命令"><a class="markdownIt-Anchor" href="#命令"></a> 命令</h3>
<p>查看事务隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@TRANSACTION_ISOLATION</span><br></pre></td></tr></table></figure>
<p>设置事务隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SET [GLOBAL | SESSION] TRANSACTION</span><br><span class="line">    ISOLATION LEVEL [LEVEL]</span><br><span class="line"></span><br><span class="line">LEVEL: &#123;</span><br><span class="line">     REPEATABLE READ</span><br><span class="line">   | READ COMMITTED</span><br><span class="line">   | READ UNCOMMITTED</span><br><span class="line">   | SERIALIZABLE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>SESSION</code>：</p>
<ul>
<li>对当前会话的所有后续的事务有效</li>
<li>该语句可以在已经开启的事务中间执行，但不会影响当前正在执行的事务</li>
<li>如果在事务之间执行，则对后续的事务有效。</li>
</ul>
<p><code>GLOBAL</code>：全局级别，对全局所有的子视图都会被修改，但是已经存在的视图不会被修改。<br />
不指定的话，则设置当前视图下的下一个没开始的事务。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/MySQL%20info/mysql%20%E7%BA%A6%E6%9D%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/03/MySQL%20info/mysql%20%E7%BA%A6%E6%9D%9F/" class="post-title-link" itemprop="url">mysql DDL 约束</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-03 22:49:21" itemprop="dateCreated datePublished" datetime="2021-03-03T22:49:21-08:00">2021-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>7 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mysql约束"><a class="markdownIt-Anchor" href="#mysql约束"></a> mysql约束</h1>
<p>是什么：是作用于表中字段上的规则，用于限制存储在表中的数据，属于 DDL 的限制操作。<br />
为什么：保证数据的正确，有效，完整</p>
<p>分类：</p>
<ol>
<li>非空约束：管理的字段不能存储null值。<code>sname varchar(10) NOT NULL</code></li>
<li>唯一性约束：存储的字段值不能有重复值，但是可以存储null。<code>email varchar(20) UNIQUE</code>；唯一但是可以为空，并且可以有多个空值，(空和空不相等)。</li>
<li>主键约束 <code>sid int PRIMARY KEY</code> ，默认非空且唯一</li>
<li>外键约束：要求外键字段值应该来源于关联表的主键的值，但是可以存储null值。</li>
<li>默认约束：如果没有指定字段值，则采用默认值 <code>DEFAULT</code></li>
<li>检查约束（8.0.16版本后）：保证满足某一条件 <code>CHECK</code></li>
<li>自增：<code>AUTO_INCREMENT</code></li>
</ol>
<h2 id="设置方法"><a class="markdownIt-Anchor" href="#设置方法"></a> 设置方法</h2>
<ol>
<li>建表时直接设置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE stu</span><br><span class="line">(</span><br><span class="line">    `id`     int PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;主键&#x27;,</span><br><span class="line">    `name`   varchar(10) NOT NULL UNIQUE COMMENT &#x27;姓名&#x27;,</span><br><span class="line">    `age`    int CHECK ( age &gt; 0 and age &lt;= 120 ),</span><br><span class="line">    `status` char(1) DEFAULT &#x27;1&#x27; COMMENT &#x27;状态&#x27;,</span><br><span class="line">    `gender` char(1) COMMENT &#x27;性别&#x27;</span><br><span class="line">) comment &#x27;用户表&#x27;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>建表时候在约束区进行设置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user2(</span><br><span class="line">    id INT,</span><br><span class="line">    `name` VARCHAR(20),</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>建后直接设置
<ul>
<li>修改 name 的数据类型和约束 -&gt; <code>modify</code></li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE stu MODIFY 字段名称 varchar(10) NOT NULL;</span><br></pre></td></tr></table></figure>
<ul>
<li>修改 name 的名称，数据类型和约束 -&gt; <code>change</code></li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名称` CHANGE 旧字段名称 新字段名称 字段类型 约束;</span><br></pre></td></tr></table></figure>
和 <code>modify</code> 区别只在于能够修改字段名称。
<ul>
<li>增加外键约束：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名称` ADD UNIQUE (`字段名`)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="check"><a class="markdownIt-Anchor" href="#check"></a> Check</h2>
<p><strong>Mysql 并不是强制要求的，即并不支持这个操作</strong>； PostgreSQL 支持。<br />
如果非要设置这个检查约束，则见 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtianze/p/6700244.html">MySQL关于check约束无效的解决办法</a> 。</p>
<h3 id="attribute-based-check"><a class="markdownIt-Anchor" href="#attribute-based-check"></a> Attribute-Based Check</h3>
<p>在声明变量后使用这个 Check 选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Sells</span><br><span class="line">(</span><br><span class="line">    bar   CHAR(20),</span><br><span class="line">    beer  CHAR(20) CHECK ( beer IN</span><br><span class="line">                           (SELECT name FROM Beers)),</span><br><span class="line">    price REAL CHECK ( price &lt;= 5.00 )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>beer</code>部分中使用了子查询作为 check 的部分 ，对象可以是本表，或者其他的外部表 。</p>
<p>只有在数据被插入或者更新时，才会 check 。</p>
<p>如果在 Beers 表格中有个元组被删除了，那么这个 check 约束是不会报错的，是不会自动检查的，和外键不同。</p>
<h3 id="tuple-based-check"><a class="markdownIt-Anchor" href="#tuple-based-check"></a> Tuple-Based Check</h3>
<p><code>CHECK</code> 还可以用来约束多个字段，即直接对整个 tuple 进行约束：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Sells</span><br><span class="line">(</span><br><span class="line">    bar   CHAR(20),</span><br><span class="line">    beer  CHAR(20),</span><br><span class="line">    price REAL,</span><br><span class="line">    CHECK (bar = &#x27;Joe&#x27; OR price &lt;= 5.00)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="主键约束"><a class="markdownIt-Anchor" href="#主键约束"></a> 主键约束</h2>
<ul>
<li>设置方法见上文</li>
</ul>
<h3 id="删除方法"><a class="markdownIt-Anchor" href="#删除方法"></a> 删除方法</h3>
<p><code>ALTER TABLE user1 DROP PRIMARY KEY;</code></p>
<p>删除有两种操作，<code>DELETE</code> 和 <code>TRUNCATE</code> 的区别：</p>
<ul>
<li><code>DELETE</code> 删除表中的数据，不重置 <code>AUTO_INCREMENT</code> 的值</li>
<li><code>TRUNCATE</code> 摧毁表，重建表， <code>AUTO_INCREMENT</code> 重置为 1</li>
</ul>
<p>如果想自定义id的值,可以使用下面的sql进行设置：<br />
<code>ALTER TABLE 表名 AUTO_INCREMENT=起始值;</code></p>
<h3 id="联合约束"><a class="markdownIt-Anchor" href="#联合约束"></a> 联合约束</h3>
<p>联合多个字段设置为主键约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user4(</span><br><span class="line">    id INT,</span><br><span class="line">    `name` VARCHAR(20),</span><br><span class="line">    PRIMARY KEY (id,`name`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 保证id和name字段不为空,然后联合判断唯一性</span><br><span class="line">INSERT INTO user4 VALUES(1,&#x27;tom&#x27;); -- 正常插入</span><br><span class="line">INSERT INTO user4 VALUES(2,&quot;tom&quot;); -- 正常插入</span><br><span class="line">INSERT INTO user4 VALUES(1,&quot;rose&quot;); -- 正常插入</span><br><span class="line">INSERT INTO user4 VALUES(2,&quot;rose&quot;); -- 正常插入</span><br><span class="line">INSERT INTO user4 VALUES(1,&quot;tom&quot;); -- 插入异常:Duplicate entry &#x27;1-tom&#x27; for key &#x27;PRIMARY&#x27;</span><br><span class="line">INSERT INTO user4 VALUES(NULL,&quot;jack&quot;); -- 插入异常:Column &#x27;id&#x27; cannot be null</span><br><span class="line">INSERT INTO user4 VALUES(3,NULL); -- 插入异常:Column &#x27;name&#x27; cannot be null</span><br></pre></td></tr></table></figure>
<p>联合 unique：<br />
<code>create table Test (a int, b int, unique(a, b));</code></p>
<h1 id="外键约束"><a class="markdownIt-Anchor" href="#外键约束"></a> 外键约束</h1>
<p>被外键索引的主表的键必须要是：1.PRIMARY KEY 或者 2.UNIQUE 。<br />
给 两张表 建立连接，从而保证数据一致性和完整性。<br />
<strong>子表</strong>的外键关联了<strong>父表</strong>的主键。</p>
<p>有两种冲突情况：</p>
<ol>
<li>插入外键表格的数据，主键表中没有相对应的数据。 -》 数据库会直接拒绝</li>
<li>当删除主键表格中的数据时，相连接的外键数据会变成无主的元组。<br />
可以设置约束，用来实现：如果子表有外键关联一个父表，那么父表：
<ol>
<li>无法随意删除其记录（默认）</li>
<li>删除后子表设置 Null</li>
<li>删除后子表设置默认值</li>
<li>子表也删除/更新相应记录。</li>
</ol>
</li>
</ol>
<p>建立：</p>
<ol>
<li>创建时在声明完变量，table括号内，重起一行添加：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONSTRAINT 外键约束对象名 FOREIGN KEY (外键字段名) REFERENCES 一方表/主表(主键字段名)</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student_class(</span><br><span class="line">    `id` int PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    `studentid` int not null,</span><br><span class="line">    `classid` int not null,</span><br><span class="line">    &lt; CONSTRAINT fkstudentid &gt; FOREIGN KEY (studentid) REFERENCES student(id),</span><br><span class="line">    &lt; CONSTRAINT fkcourseid &gt; FOREIGN KEY (classid) REFERENCES course(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>&lt; CONSTRAINT fkstudentid &gt;</code> 可以不加，或者使用 <code>beer CHAR(20) REFERENCES Beers(name)</code> 声明后直接建立外键。</p>
<p>同时也支持多个字段建立外键：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table F(</span><br><span class="line">    a int, b int,</span><br><span class="line">    foreign key (a, b)references P (a, b)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>建后直接设置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 多方表</span><br><span class="line">ADD CONSTRAINT 外键约束对象名 FOREIGN KEY(外键字段名)</span><br><span class="line">REFERENCE 一方表/主表(主键字段)</span><br></pre></td></tr></table></figure>
<p>删除外键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 多方表</span><br><span class="line">DROP FOREIGN KEY 外键约束对象名;</span><br></pre></td></tr></table></figure>
<h2 id="外键约束的删除和更新行为"><a class="markdownIt-Anchor" href="#外键约束的删除和更新行为"></a> 外键约束的删除和更新行为</h2>
<ul>
<li>NO ACTION / RESTRICT ：当在「一方表/父表」中更新/删除对应记录时候，首先检查是否有外键，如果有，则「不允许更新」。</li>
<li>CASCADE：在「一方表/父表」中「更新/删除」对应记录时候，首先检查是否有外键，如果有，则也会「更新/删除」子表记录。</li>
<li>SET NULL：在「一方表/父表」中「删除」对应记录时候，首先检查是否有外键，如果有，则会将「子表」中的对应值设置为 null。</li>
<li>SET DEFAULT：在「一方表/父表」中「删除」对应记录时候，首先检查是否有外键，如果有，则会将「子表」中的对应值设置为「DEFAULT 值」（Innodb 不支持）。</li>
</ul>
<p>设置方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 子表名</span><br><span class="line">ADD CONSTRAINT 外键约束对象名</span><br><span class="line">FOREIGN KEY (外键字段) REFERENCES 一方表/父表名 (主表字段名)</span><br><span class="line">ON [UPDATE, DELETE] [更新行为名称 e.g. CASCADE]</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Sells (</span><br><span class="line">    bar CHAR(20),</span><br><span class="line">    beer CHAR(20),</span><br><span class="line">    price REAL,</span><br><span class="line">    FOREIGN KEY(beer) REFERENCES Beers(name)</span><br><span class="line">    ON DELETE SET NULL ON UPDATE CASCADE );</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/MySQL%20info/mysql%20DDL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/03/MySQL%20info/mysql%20DDL/" class="post-title-link" itemprop="url">mysql DDL Data Definition Language</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-03 22:44:21" itemprop="dateCreated datePublished" datetime="2021-03-03T22:44:21-08:00">2021-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>11 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>DDL (Data Definition Language) 数据库定义语言<br />
用于定义SQL模式、基本表、视图和索引的创建和撤消操作，在建表的时候使用。</p>
<ul>
<li>CREATE</li>
<li>ALTER</li>
<li>DROP</li>
<li>TRUNCATE</li>
<li>COMMIT</li>
<li>RENAME</li>
</ul>
<h3 id="打开与退出"><a class="markdownIt-Anchor" href="#打开与退出"></a> 打开与退出</h3>
<p>命令行：输入 <code>mysql -u root -p</code>，还可以选添 <code>-P 3306</code> 来设置端口号<br />
进入后：<code>quit</code>退出</p>
<h3 id="数据库管理命令"><a class="markdownIt-Anchor" href="#数据库管理命令"></a> 数据库管理命令</h3>
<ul>
<li>所有的表文件都存放在data文件夹中</li>
<li>查看所有数据库名：<code>show databases;</code></li>
<li>information_schema 存放在内存中，每次都会自动销毁</li>
<li>创建一个数据库：
<ol>
<li><code>create database [if not exists] 数据库名 [default charset utf8mb4];</code><br />
<code>[if not exists]</code>是可选择的，用来防止报错。<br />
<code>[default charset utf8]</code>为指定的默认字符集。</li>
<li>目录下手动新建文件夹也可以</li>
</ol>
</li>
<li>删除一个数据库：<code>drop database 数据库名;</code><br />
如果表存在则删除表（用于重新创建）：<code>drop table if exists suspects;</code></li>
<li>使用数据库 <code>use database 数据库名;</code></li>
<li>查询当前的数据库 <code>select database();</code> 注意加个括号</li>
</ul>
<h3 id="表文件管理命令"><a class="markdownIt-Anchor" href="#表文件管理命令"></a> 表文件管理命令</h3>
<ul>
<li>
<p>查看指定的数据库下所有的表文件名：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br><span class="line">show tables;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在指定数据库下创建表文件：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br><span class="line">create table 表文件名(</span><br><span class="line">    字段名 数据类型名 [comment 字段注释],</span><br><span class="line">    字段名 数据类型名  &lt;--最后一个字段不要加&quot;,&quot;</span><br><span class="line">) [comment 表注释];</span><br></pre></td></tr></table></figure>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database bjpowernode;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use bjpowernode;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table stu(</span><br><span class="line">    -&gt; sid int,</span><br><span class="line">    -&gt; sname varchar(10),</span><br><span class="line">    -&gt; age int</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>在这里面，字符串类型使用 <strong>varchar(5)</strong>，括号内放置最大字符长度。<br />
可以使用<code> [comment 字段注释]/[comment 表注释]</code> 进行注释。</p>
  <details>
  <summary>详细的 char-us-varchar，各种数值类型对比</summary>
<table>
<thead>
<tr>
<th style="text-align:center">Value</th>
<th style="text-align:center">CHAR(4)</th>
<th style="text-align:center">CHAR(4)-Storage</th>
<th style="text-align:center">VARCHAR(4)</th>
<th style="text-align:center">VARCHAR(4)-Storage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">“”</td>
<td style="text-align:center">’    ’</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:center">&quot;</td>
<td style="text-align:center">1 byte</td>
</tr>
<tr>
<td style="text-align:center">‘ab’</td>
<td style="text-align:center">'ab  ’</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:center">‘ab’</td>
<td style="text-align:center">3 bytes</td>
</tr>
<tr>
<td style="text-align:center">‘abcd’</td>
<td style="text-align:center">‘abcd’</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:center">‘abcd’</td>
<td style="text-align:center">5 bytes</td>
</tr>
<tr>
<td style="text-align:center">‘abcdefgh’</td>
<td style="text-align:center">‘abcd’</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:center">‘abcd’</td>
<td style="text-align:center">5 bytes</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">Type</th>
<th style="text-align:left">Storage</th>
<th style="text-align:left">Minimum Value</th>
<th style="text-align:left">Maximum Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">(Bytes)</td>
<td style="text-align:left">(Signed/Unsigned)</td>
<td style="text-align:left">(Signed/Unsigned)</td>
</tr>
<tr>
<td style="text-align:left">TINYINT</td>
<td style="text-align:left">1</td>
<td style="text-align:left">-128</td>
<td style="text-align:left">127</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">255</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT</td>
<td style="text-align:left">2</td>
<td style="text-align:left">-32768</td>
<td style="text-align:left">32767</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">65535</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMINT</td>
<td style="text-align:left">3</td>
<td style="text-align:left">-8388608</td>
<td style="text-align:left">8388607</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">16777215</td>
</tr>
<tr>
<td style="text-align:left">INT</td>
<td style="text-align:left">4</td>
<td style="text-align:left">-2147483648</td>
<td style="text-align:left">2147483647</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">4294967295</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td style="text-align:left">8</td>
<td style="text-align:left">-9223372036854775808</td>
<td style="text-align:left">9223372036854775807</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">18446744073709551615</td>
</tr>
</tbody>
</table>
  </details>
<ul>
<li>数据类型：
<ul>
<li>CHAR(n) 存储时右边会使用空格进行占位</li>
<li>VARCHAR() 可变长度字符串，不进行占位，存储时会将长度存储为 prefix</li>
<li>INT</li>
<li>FLOAT / REAL</li>
<li>YEAR: YYYY</li>
<li>TIME: HH:MM:SS</li>
<li>DATE: YYYY-MM-DD</li>
<li>DATETIME: YYYY-MM-DD HH:MM:SS<br />
比如：<code>insert into test values('2016-1-1', '2016- 1-1 3:10:10')</code>，分别对应 <code>date</code> 和 <code>datetime</code> 。</li>
<li>TIMESTAMP: YYYY-MM-DD HH:MM:SS 描述的时间在不同时区索引出来可能是不同的，动态计算出对应时区时间。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>删除表文件： <code>drop table 表文件名;</code></p>
</li>
<li>
<p>查看表文件中的字段信息： <code>desc 表文件名称;</code></p>
</li>
<li>
<p>查看表文件中更详细的信息/创建的命令： <code>show create table 表文件名称;</code></p>
</li>
<li>
<p>为表文件添加字段： <code>alter table 表文件名 add 新字段名 数据类型名称 &lt;attribute declaration&gt;;</code></p>
</li>
<li>
<p>修改数据类型： <code>alter table 表文件名 modify 字段名 新数据类型;</code></p>
</li>
<li>
<p>删除表文件字段： <code>alter table 表文件名 drop 字段名;</code></p>
</li>
</ul>
<h3 id="表文件数据行管理命令"><a class="markdownIt-Anchor" href="#表文件数据行管理命令"></a> 表文件数据行管理命令</h3>
<ul>
<li>插入命令：要求mysql服务器向指定的表文件中添加数据行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into 表文件名 (字段名1,字段名2,字段名3)</span><br><span class="line">values(值1,值2,值3);        &lt;-字符串和日期的值使用单引号扩起来</span><br></pre></td></tr></table></figure>
<ul>
<li>批量插入：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into 表文件名(字段1,字段2,字段3)</span><br><span class="line">values</span><br><span class="line">(值1,值2,值3),</span><br><span class="line">(值1,值2,值3),</span><br><span class="line">(值1,值2,值3);</span><br></pre></td></tr></table></figure>
<ul>
<li>简化版本插入命令：<code>insert into 表文件名 values(值1,值2,值3);</code><br />
如果插入数据时，每一个字段都可以赋值，此时插入命令不需要指定字段名，数据顺序此时要与表文件字段顺序相同</li>
<li>删除命令：
<ol>
<li><code>delete from 表文件名;</code>删除所有数据</li>
<li><code>delete from 表文件名 where 判断条件;</code>删除满足条件的数据行数据。判断数据一般放置关系条件或者逻辑条件。(等于使用单等号=)</li>
</ol>
</li>
<li>更新命令：要求mysql服务器将指定的表文件数据进行更新
<ol>
<li>对所有数据行<code>update 表文件名 set 字段名1=值,字段名2=值 [WHERE 条件];</code></li>
</ol>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update stu set age=age+3;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 2  Changed: 2  Warnings: 0</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>对指定数据行<code>update 表文件名 set 字段名1=值,字段名2=值 where 判断条件;</code>使用where来选择</li>
</ol>
</li>
<li>数据行复制命令：<code>insert into B select * from A</code>可以将表A中的数据行复制到表B(要求表A与表B字段结构完全一致)</li>
<li>表文件备份命令：<code>create table B select * from A</code>将表A进行一次备份，备份生成表B</li>
</ul>
<h3 id="查询命令-dql"><a class="markdownIt-Anchor" href="#查询命令-dql"></a> 查询命令 DQL</h3>
<ul>
<li>查询命令：<code>select * from 表文件名;</code>要求mysql服务器将指定的表文件数据进行展示</li>
<li>语法：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表</span><br><span class="line">FROM 表名</span><br><span class="line">WHERE 条件列表</span><br><span class="line">GROUP BY 分组字段列表</span><br><span class="line">HAVING 分组后条件列表</span><br><span class="line">ORDER BY 排序字段列表</span><br><span class="line">LIMIT 分页参数</span><br></pre></td></tr></table></figure>
<h3 id="mql执行计划explain"><a class="markdownIt-Anchor" href="#mql执行计划explain"></a> mql执行计划(explain)</h3>
<ol>
<li>命令格式：explain 查询命令</li>
<li>命令作用：展示当前查询得到的结果是否通过索引来进行定位</li>
<li>例子：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE ename=&#x27;smith&#x27;</span><br><span class="line">--&gt; EXPLAIN SELECT * FROM emp WHERE ename=&#x27;smith&#x27;</span><br><span class="line">--&gt; type: ref(索引查询) rows:1(查询次数)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>判断：type属性表示执行效率。<br />
<strong>all</strong>(对所有数据行进行遍历)<br />
<strong>type</strong>(WHERE对所有数据行进行遍历，SELECT从索引中抓取)<br />
<strong>range</strong>(WHERE直接通过索引来查询，但是不稳定，因为字段变化时会导致失效)<br />
<strong>ref</strong>(WHERE直接通过索引来查询，一次只得到一行数据 --&gt; 该行数据没有重复)<br />
<strong>const</strong>(通过主键索引来进行定位)</li>
</ol>
<p><strong>mysql如果发现通过索引得到数据行数&gt;1/3是，会自动放弃索引查询，type依然是all</strong></p>
<h3 id="视图"><a class="markdownIt-Anchor" href="#视图"></a> 视图</h3>
<ol>
<li>定义：Mysql对象，用于存储 <strong>查询语句</strong> 。</li>
<li>目的：提高查询语句使用效率，可复用性。</li>
<li>命令：<code>CREATE VIEW 视图对象名 AS 查询语句;</code></li>
<li>调用：<code>SELECT * FROM 视图对象名;</code>，还可以通过视图对象关联表文件数据行进行插入，删除，更新操作。</li>
<li>作用：<strong>隐藏业务中涉及表关系，开发人员通过视图进行操作时不会知道具体操作的表，提高了安全性。</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 创建视图</span><br><span class="line">CREATE VIEW CanDrink AS</span><br><span class="line">SELECT distinct drinker, beer</span><br><span class="line">FROM Frequents, Sells</span><br><span class="line">WHERE Frequents.bar = Sells.bar;</span><br><span class="line"></span><br><span class="line">-- 使用视图</span><br><span class="line">select beer from CanDrink</span><br><span class="line">where drinker = &#x27;Bill&#x27;;</span><br></pre></td></tr></table></figure>
<p>DBMS 会将视图先存储起来，然后交给下面的查询语句继续调用。<br />
具体地，DBMS 并 <strong>不是存储了视图表格</strong>，而是存储了他的 <strong>查询语句</strong>（有点像关系代数），在后面调用视图时，会自动将该语句进行内嵌。</p>
<blockquote>
<p>The queries defining any views used by the query are also replaced by their algebraic equivalents, and “spliced into” the expression tree for the query.</p>
</blockquote>
<br>
<p><strong>What Happens When We Query a View ?</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- build view</span><br><span class="line">CREATE VIEW LA- view AS</span><br><span class="line">SELECT buyer, seller, product, store</span><br><span class="line">FROM Person, Purchase</span><br><span class="line">WHERE Person.city = ‘LA’</span><br><span class="line">  AND Person.name = Purchase.buyer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- query on view</span><br><span class="line">SELECT name, LA-view.store</span><br><span class="line">FROM LA-view, Product</span><br><span class="line">WHERE LA-view.product = Product.name AND Product.category = &#x27;shoes&#x27;</span><br></pre></td></tr></table></figure>
<p>底层的实现为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, Purchase.store</span><br><span class="line">FROM Person, Purchase, Product</span><br><span class="line">WHERE   Person.city = &#x27;LA&#x27; AND</span><br><span class="line">        Person.name = Purchase.buyer AND</span><br><span class="line">        Purchase.product = Product.name AND</span><br><span class="line">        Product.category = &#x27;shoes&#x27;;</span><br></pre></td></tr></table></figure>
<br>
<p>同时，内嵌之后，DBMS 会自动优化组合起来的查询语句，实现查询加快的效果。<br />
<img src="https://pica.zhimg.com/80/v2-ab12768d5bd8a5992b05bfad83634406_1440w.png" alt="" /></p>
<p>主要是两个步骤：</p>
<ol>
<li>将 select 操作向底层推，这样需要 join 的条目就少了</li>
<li>将 project 操作向上推，先运算，再投影</li>
</ol>
<h3 id="存储引擎"><a class="markdownIt-Anchor" href="#存储引擎"></a> 存储引擎</h3>
<ol>
<li>定义：是mysql服务器对表文件内容的管理方式，目前主要采用INNODB，Myisam.</li>
<li>管理命令：
<ul>
<li>查看支持存储引擎种类：<code>show engines</code>，默认使用innodb引擎</li>
<li>修改引擎，<code>my.cnf文件</code>，在<code>/etc</code>配置文件夹下，<code>default-storage-engine=INNODB</code></li>
<li>设置表文件呢依赖的存储引擎：<code>alter TABLE 表名 ENGINE=存储引擎</code></li>
</ul>
</li>
<li>存储引擎特征：
<ul>
<li>Myisam：
<ul>
<li>修改表时，不会备份。提高效率，操作后无法取消本操作。</li>
<li>使用三个表存储信息：<strong>test1.frm</strong>储存表文件字段信息，<strong>test1.myd</strong>储存表文件数据行信息，<strong>test1.myi</strong>存储表文件字段关联的索引信息。</li>
</ul>
</li>
<li>INNODB：
<ul>
<li>对表内容修改时，首先进行一次备份，因此效率较慢。</li>
<li>但是执行完毕后，可以使用备份取消当前操作，增加安全性。</li>
<li>使用一个文件<strong>test1.frm</strong>存储所有信息。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="事物transaction"><a class="markdownIt-Anchor" href="#事物transaction"></a> 事物(transaction)</h3>
<ol>
<li>介绍：用于对当前表文件备份进行管理。</li>
<li>命令格式：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start transaction #通过服务器提供一个事物对象来管理备份接下来的操作</span><br><span class="line">delete from emp where deptno=30 #生成emp.bak</span><br><span class="line">delete from dept where deptno=30 #生成emp.bak</span><br><span class="line">ROLLBACK #取消本次操作</span><br><span class="line">COMMIT #提交操作：将本次操作的所有备份信息删除</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/MySQL%20info/mysql%20%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/03/MySQL%20info/mysql%20%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">mysql 索引</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-03 22:44:21" itemprop="dateCreated datePublished" datetime="2021-03-03T22:44:21-08:00">2021-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>9 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>mysql索引(index)</strong></p>
<p>不加索引的时候，在匹配某个属性时，是一个一个进行匹配扫描的。</p>
<ul>
<li>优点
<ul>
<li>使用平衡树来存储数据，降低查询时间 -&gt; io 成本</li>
<li>降低数据排序的成本 -&gt; cpu 成本</li>
</ul>
</li>
<li>缺点
<ul>
<li>降低更新表的效率：<br />
增删改数据都会改变平衡树各节点中的索引数据内容，破坏树结构。<br />
因此，在每次数据改变时， DBMS必须去重新梳理树（索引）的结构以确保它的正确，</li>
<li>索引列额外占用磁盘空间 -&gt; b+树</li>
</ul>
</li>
</ul>
<p>索引命令语法：</p>
<ul>
<li>添加索引：<code>CREATE INDEX 索引名 ON 表名(字段, ...)</code></li>
<li>查看索引：<code>SHOW INDEX FROM 表名</code><br />
这时会看到三个索引，因为服务器会默认为<strong>主键约束</strong>，<strong>外键约束</strong>，<strong>唯一性约束</strong>绑定索引。</li>
<li>删除索引：<code>DROP INDEX 索引名 ON 表名</code>、</li>
</ul>
<p>常用的存储索引的数据结构：hashmap , b+ tree , R-tree , Ful-text</p>
<p>索引分类：</p>
<ol>
<li>主键索引：默认自动创建，唯一</li>
<li>唯一索引：默认自动创建，可以有多个</li>
<li>常规索引：为了快速定位数据，可以有多个</li>
<li>全文索引<code>FULLTEXT</code>：查找文本关键值，而不是比较索引值，可以有多个</li>
</ol>
<p>索引类型：</p>
<ul>
<li>
<p>聚集索引（Clustered Index）：</p>
<ul>
<li>表中必须有，并且只能有一个</li>
<li>将数据库表的数据行按照指定 search key 的顺序进行排序并存储</li>
<li>将数据存储和索引放在一起，其对应的树的 <strong>叶子节点指向物理数据</strong>，非叶子节点就是索引</li>
<li>加了索引之后，整个表就变成了一种 平衡树 结构。换句话说，就是整个表就变成了一个索引，存储顺序也发生了改变，即「聚集索引」。这就是为什么一张表只能有一个主键，因为只能有一种物理存储方式。</li>
<li>[Coding, MySQL] 会自动创建聚集索引：
<ol>
<li>primary key if exists</li>
<li>otherwise 1st unique key</li>
<li>if no unique key , use the hidden row ID (we cant see)</li>
</ol>
</li>
</ul>
</li>
<li>
<p>二级索引/非聚集索引（Secondary / Non-Clustered Index），也就是我们平时经常提起和使用的 常规索引。</p>
<ul>
<li>可以没有，也可以是多个</li>
<li>叶子节点指向的是对应的主键值</li>
</ul>
</li>
</ul>
<p>两种索引方式的都是采用平衡树作为数据结构。索引树结构中各节点的值来自于表中的索引字段。<br />
如果给表中多个字段加上索引， 那么就会出现多个独立的索引结构，每个索引（非聚集索引）互相之间不存在关联。<br />
每次给字段建一个新索引， 字段中的数据就会被复制一份出来， 用于生成索引。 因此， 给表添加索引，会增加表的体积， 占用磁盘存储空间。</p>
<p>查询非聚集索引和聚集索引的区别在于</p>
<ul>
<li>聚集索引：可以直接通过对应的平衡树查到需要查找的数据</li>
<li>非聚集索引 - 回表查询：首先通过聚集索引平衡树查到记录对应的主键值，再使用主键的值通过聚集索引平衡树查找到需要的数据</li>
</ul>
<p><img src="https://pic1.zhimg.com/v2-ef9b5d5d6407d80b937ca19d6be9dadc_b.jpg" alt="" /></p>
<p>不管以任何方式查询表， 最终都会利用主键通过聚集索引来定位到数据， 聚集索引（主键）是通往真实数据所在的唯一路径。</p>
<p>我们在建立索引之后，比如建立了 <code>birthday</code> 的索引，然后通过 <code>where birthday= ..</code> 来查询时：</p>
<ol>
<li>通过非聚集索引index_birthday查找birthday等于1991-11-1的所有记录的主键ID值</li>
<li>通过得到的主键ID值执行聚集索引查找，找到主键ID值对就的真实数据（数据行）存储的位置</li>
<li>从得到的真实数据中取得 select 字段的值返回</li>
</ol>
<p>B+Tree 对应两种搜索方式：</p>
<ol>
<li>Equality search：<code>Where age = 25</code>从根节点开始向下找，直到目标叶节点</li>
<li>Range query
<ul>
<li>[a, b]：<code>Where 20 &lt;= age and age &lt;= 30</code>，从根节点开始，向下找，先找到第一个满足条件的叶节点，然后向后顺序遍历，直到不符合要求。</li>
<li>[-, b]：<code>Where age &lt;= 30</code>，先找到左下角叶节点，然后遍历。</li>
<li>[a, -]：<code>Where 20 &lt;= age</code> 先找到左边第一个叶节点，然后遍历打最右边节点。</li>
</ul>
</li>
</ol>
<h1 id="数据结构"><a class="markdownIt-Anchor" href="#数据结构"></a> 数据结构</h1>
<h2 id="btree"><a class="markdownIt-Anchor" href="#btree"></a> B+Tree</h2>
<p>原始 B+Tree 的叶子节点组成一个单向链表，在 MySQL 中又为其添加了一个反向指针，叶子节点构成了一个双向闭环链表，来增加数据访问速度。<br />
内部节点存放的是索引，数据存放在叶子节点处。</p>
<p>max-Degree：一个节点的最大子节点个数，即指针的个数，key的数量为 指针数量-1 。</p>
<p>每个节点都是独立存放在单独的 页/block 中。</p>
<p>优势：</p>
<ol>
<li>每个内部节点对应的 block 不存放数据，进而可以存放更多键和指针，可以降低层数，检索效率高。</li>
<li>相较于 b树，叶子节点形成了链表，便于范围搜素和排序。</li>
<li>相较于 hash，hash 只支持等值匹配，不支持范围匹配和排序。</li>
</ol>
<h2 id="hash-index"><a class="markdownIt-Anchor" href="#hash-index"></a> Hash Index</h2>
<p>采用一定 hash 算法，将键值换算成为新的 hash 值，映射到 hash 表对应的槽位上。</p>
<p>只用于等值匹配，不支持范围查询。实现时，比如<code>where name='lyl'</code> ，先得到 <code>'lyl'</code> 的 hash 值，然后直接去hash表读取其地址，得到数据。</p>
<p>查询效率高，在没有 hash冲突 的情况下，只需要一次检索即可，一般比 B+Tree 查询要快。</p>
<h1 id="sql-性能分析"><a class="markdownIt-Anchor" href="#sql-性能分析"></a> SQL 性能分析</h1>
<ol>
<li>
<p>查询执行频次：<br />
<code>SHOW GLOBAL STATUS LIKE 'COM_______'</code> ：查看当前数据库增删改查的访问频次，四个命令正好都是六个字母，所以是1+6个下划线。</p>
</li>
<li>
<p>慢查询日志：用于定位哪些 sql 语句时间比较长<br />
慢查询日志记录了所有执行时间超过指定参数 (long_query_time， 单位：秒，默认10秒) 的所有SQL语句的日志。<br />
MySQL的慢查询日志默认没有开启，需要在MySQL的配置文件 <code>/etc/my.cnf</code> 中配置。</p>
<ul>
<li><code>show variables  like '%slow_query_log%';</code> 查看是否开启</li>
<li><code>show variables/global like 'long_query_time%';</code> 查看预设时间，variables是当前会话的，global是全局的（文件中的）。</li>
<li><code>show variables like 'slow_query_log_file';</code> 日志存放地址，可以通过 <code>tail -f</code> 命令实时查看</li>
<li><code>set global slow_query_log=1;</code> 开启，只对当前数据库生效，如果MySQL重启后则会失效。</li>
<li><code>set global long_query_time=4;</code> 设置时间，需要重新连接或新开一个会话才能看到修改值。</li>
<li><code>/etc/my.cnf</code> -&gt; <code>slow_query_log=1</code>，<code>long_query_time=10</code>，<code>slow_query_log_file=/tmp/mysql_slow.log</code> 永久开启</li>
</ul>
</li>
<li>
<p>MySQL提供了日志分析工具 <code>mysqldumpslow</code></p>
</li>
<li>
<p><code>show profile</code> 可以告诉我们操作耗时</p>
<ul>
<li>首先通过<code>SELECT @@have_profiling;</code> 查看是否支持该功能</li>
<li>如果关闭，则通过 <code>SET profiling=1;</code> 进行开启</li>
<li>查看每一条SOL的耗时: <code>show profiles;</code></li>
<li>查看指定 query_id 的SQL语句各个阶段的耗时情况 <code>show profile for query [query _id];</code></li>
<li>查看指定 query_id 的SQL语句CPU的使用情况: <code>show profile cpu for query [query id];</code></li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/CQL%20%E8%AF%AD%E8%A8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/03/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/CQL%20%E8%AF%AD%E8%A8%80/" class="post-title-link" itemprop="url">CQL 语言</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-03 18:41:24" itemprop="dateCreated datePublished" datetime="2021-03-03T18:41:24-08:00">2021-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge-Graph/" itemprop="url" rel="index"><span itemprop="name">Knowledge Graph</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>文档：<a target="_blank" rel="noopener" href="https://neo4j.com/docs/cypher-manual/current/clauses/">https://neo4j.com/docs/cypher-manual/current/clauses/</a></p>
<p>A Cypher query part can either read and match on the graph, or make updates on it, <strong>not both simultaneously.</strong></p>
<p>When performing <strong>Reading</strong> performance, Cypher will <strong>not match</strong> the pattern <strong>until</strong> you ask for the results.</p>
<p>In an updating query, all the <strong>reading</strong> will be <strong>firstly</strong> done totally, followed by all the <strong>writing</strong> performance.</p>
<p>These parts are separated by the statement <code>WITH</code>.<br />
<code>WITH</code> is like an event horizon — it’s <strong>a barrier</strong> between <strong>a plan</strong> and <strong>the finished execution</strong> of that plan.</p>
<p>Using <code>WITH</code>, you specify how you want the aggregation to happen, and that the aggregation has to be finished before Cypher can start filtering.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n &#123;name: &#x27;John&#x27;&#125;)-[:FRIEND]-(friend)</span><br><span class="line">WITH n, count(friend) AS friendsCount</span><br><span class="line">WHERE friendsCount &gt; 3</span><br><span class="line">RETURN n, friendsCount</span><br></pre></td></tr></table></figure>
<h2 id="introduction-to-cypher"><a class="markdownIt-Anchor" href="#introduction-to-cypher"></a> Introduction to Cypher</h2>
<ul>
<li>Basic mode:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(nodes)-[:ARE_CONNECTED_TO]-&gt;(otherNodes)</span><br></pre></td></tr></table></figure>
<ul>
<li>rounded brackets <code>(nodes)</code> to include the node</li>
<li>arrow <code>-[:ARE_CONNECTED_TO]-&gt;</code> to declare the relationship</li>
</ul>
</li>
</ul>
<h3 id="nodes"><a class="markdownIt-Anchor" href="#nodes"></a> Nodes</h3>
<ul>
<li><strong>Nodes</strong> and <strong>relationships</strong> are the simple components of the <strong>pattern</strong>, which are the most valuable and powerful piece of the property graph model.</li>
</ul>
<br>
<ul>
<li>
<p>Cypher comments: <code>//</code></p>
</li>
<li>
<p>could use the nickname for a node like <code>(p)</code> for a person</p>
</li>
<li>
<p>also could use <code>()</code> for an anonymous node. This means that you are not be able to return this node later in the query.</p>
</li>
<li>
<p>assigning a node label, e.g. Person, Technology, and Company.<br />
It is like a class, and it likes we are telling the Cypher to only check those labels for that label.<br />
This helps Cypher distinguish between entities and optimize execution for your queries. It is always better to use node labels in your queries, where possible.</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">()                  //anonymous node (no label or variable) can refer to any node in the database</span><br><span class="line">(p:Person)          //using variable p and label Person</span><br><span class="line">(:Technology)       //no variable, label Technology</span><br><span class="line">(work:Company)      //using variable work and label Company</span><br></pre></td></tr></table></figure>
<h3 id="relationships"><a class="markdownIt-Anchor" href="#relationships"></a> Relationships</h3>
<p>Directed relationships: <code>--&gt;</code>or <code>&lt;--</code> between two nodes<br />
Undirected relationships: <code>--</code> between two nodes</p>
<p>Additional information, such as <strong>relationship type</strong> and <strong>relationship properties</strong> could be added.</p>
<p>When using un-directional relationships <code>--</code> for query, Cypher would <strong>ignores any particular direction</strong> and <strong>retrieves the relationship and connected nodes</strong>, no matter what the physical direction is.<br />
In this case, user needn’t know the specific relationship.</p>
<p>But when using directional relationships <code>--&gt; / &lt;--</code> for query. The wrong direction will not return any results.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//data stored with this direction</span><br><span class="line">CREATE (p:Person)-[:LIKES]-&gt;(t:Technology)</span><br><span class="line"></span><br><span class="line">//query relationship backwards will not return results</span><br><span class="line">MATCH (p:Person)&lt;-[:LIKES]-(t:Technology)</span><br><span class="line"></span><br><span class="line">//better to query with undirected relationship unless sure of direction</span><br><span class="line">MATCH (p:Person)-[:LIKES]-(t:Technology)</span><br></pre></td></tr></table></figure>
<h3 id="node-or-relationship-properties"><a class="markdownIt-Anchor" href="#node-or-relationship-properties"></a> Node or relationship properties</h3>
<p>properties are <code>name-value</code> pairs</p>
<p>Node property: <code>(p:Person &#123;name: 'Sally'&#125;)</code><br />
Relationship property: <code>-[rel:IS_FRIENDS_WITH &#123;since: 2018&#125;]-&gt;</code></p>
<h3 id="patterns-in-cypher"><a class="markdownIt-Anchor" href="#patterns-in-cypher"></a> Patterns in Cypher</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(p:Person &#123;name: &quot;Sally&quot;&#125;)-[rel:LIKES]-&gt;(g:Technology &#123;type: &quot;Graphs&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="patterns"><a class="markdownIt-Anchor" href="#patterns"></a> Patterns</h2>
<h3 id="node-syntax"><a class="markdownIt-Anchor" href="#node-syntax"></a> Node syntax</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">() // an anonymous, uncharacterized node</span><br><span class="line">(matrix) // every node with a variable</span><br><span class="line">(:Movie) // every node with a type/label</span><br><span class="line">(matrix:Movie)</span><br><span class="line">(matrix:Movie &#123;title: &#x27;The Matrix&#x27;&#125;) // every node with a property</span><br><span class="line">(matrix:Movie &#123;title: &#x27;The Matrix&#x27;, released: 1997&#125;)</span><br></pre></td></tr></table></figure>
<p>For the Type name, we are used to assign an all-upper-format; and if there is space, we use to use <code>_</code> in place of the blank.<br />
For the property value, if it is a char type, we should use quotation marks <code>' / &quot;</code> around it.</p>
<h3 id="relationship-syntax"><a class="markdownIt-Anchor" href="#relationship-syntax"></a> Relationship syntax</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--&gt;</span><br><span class="line">-[role]-&gt;  // variable</span><br><span class="line">-[:ACTED_IN]-&gt; // type/label</span><br><span class="line">-[role:ACTED_IN]-&gt;</span><br><span class="line">-[role:ACTED_IN &#123;roles: [&#x27;Neo&#x27;]&#125;]-&gt;</span><br></pre></td></tr></table></figure>
<h3 id="pattern-syntax"><a class="markdownIt-Anchor" href="#pattern-syntax"></a> Pattern syntax</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(keanu:Person:Actor &#123;name: &#x27;Keanu Reeves&#x27;&#125;)</span><br><span class="line">    -[role:ACTED_IN &#123;roles: [&#x27;Neo&#x27;]&#125;]-&gt;</span><br><span class="line">    (matrix:Movie &#123;title: &#x27;The Matrix&#x27;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="pattern-variables"><a class="markdownIt-Anchor" href="#pattern-variables"></a> Pattern variables</h3>
<p>Cypher allows patterns to be assigned to variables.<br />
This allows the matching paths to be inspected, used in other expressions.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acted_in = (:Person)-[:ACTED_IN]-&gt;(:Movie)</span><br></pre></td></tr></table></figure>
<p>Then, this variable would contain the matched paths (2 nodes and 1 relationship).<br />
Later we could use a number of functions to access details of a path, like <code>nodes(path)</code>, <code>relationships(path)</code>, and <code>length(path)</code>.</p>
<h3 id="clauses"><a class="markdownIt-Anchor" href="#clauses"></a> Clauses</h3>
<p>There are multiple clauses, each performs a specific task.<br />
like:</p>
<ul>
<li>create and match patterns in the graph</li>
<li>filter, project, sort, or paginate results</li>
<li>compose partial statements</li>
</ul>
<h2 id="patterns-in-practice"><a class="markdownIt-Anchor" href="#patterns-in-practice"></a> Patterns in practice</h2>
<h3 id="creating-and-returning-data"><a class="markdownIt-Anchor" href="#creating-and-returning-data"></a> Creating and Returning data</h3>
<h4 id="create"><a class="markdownIt-Anchor" href="#create"></a> CREATE</h4>
<p>The simplest clause is called <code>CREATE</code>. It creates the patterns (nodes and relationship) that you specify.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE (:Movie &#123;title: &#x27;The Matrix&#x27;, released: 1997&#125;)</span><br></pre></td></tr></table></figure>
<p>After running this statement, Cypher returns <strong>the number of changes</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Created Nodes: 1</span><br><span class="line">Added Labels: 1</span><br><span class="line">Set Properties: 2</span><br><span class="line">Rows: 0</span><br></pre></td></tr></table></figure>
<h3 id="return"><a class="markdownIt-Anchor" href="#return"></a> RETURN</h3>
<p>to return the created data</p>
<p>The <code>RETURN</code> clause in Cypher specifies <strong>what values or results</strong> to return from a Cypher query:</p>
<ul>
<li>node</li>
<li>relationships</li>
<li>node and relationship properties</li>
<li>patterns</li>
</ul>
<p><code>RETURN</code> is not required when doing write procedures, but <strong>is needed for reads</strong>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE (a:Person &#123;name: &#x27;Tom Hanks&#x27;, born: 1956&#125;)-[r:ACTED_IN &#123;roles: [&#x27;Forrest&#x27;]&#125;]-&gt;(m:Movie &#123;title: &#x27;Forrest Gump&#x27;, released: 1994&#125;)</span><br><span class="line">CREATE (d:Person &#123;name: &#x27;Robert Zemeckis&#x27;, born: 1951&#125;)-[:DIRECTED]-&gt;(m)</span><br><span class="line">RETURN a, d, r, m</span><br></pre></td></tr></table></figure>
<h3 id="matching-patterns"><a class="markdownIt-Anchor" href="#matching-patterns"></a> Matching patterns</h3>
<p>assign the pattern to <code>MATCH</code> to describe what you are looking for.</p>
<p>A <code>MATCH</code> statement searches for the patterns you specify and return one row per successful pattern match.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// all nodes labeled with the Movie label.</span><br><span class="line">MATCH (m:Movie)</span><br><span class="line">RETURN m</span><br><span class="line"></span><br><span class="line">// look for a specific person, like Keanu Reeves.</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;Keanu Reeves&#x27;&#125;)</span><br><span class="line">RETURN p</span><br><span class="line"></span><br><span class="line">// the movies&#x27; titles that Tom Hanks acted in and roles he played.</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;Tom Hanks&#x27;&#125;)-[r:ACTED_IN]-&gt;(m:Movie)</span><br><span class="line">RETURN m.title, r.roles</span><br></pre></td></tr></table></figure>
<h3 id="aliasing-return-values"><a class="markdownIt-Anchor" href="#aliasing-return-values"></a> Aliasing return values</h3>
<p>Sometimes the return name or property is complex, so we could also alias the property with a cleaner name using <code>AS</code> at the <code>RETURN</code> line.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (tom:Person &#123;name:&#x27;Tom Hanks&#x27;&#125;)-[rel:DIRECTED]-(movie:Movie)</span><br><span class="line">RETURN tom.name AS name, tom.born AS `Year Born`, movie.title AS title, movie.released AS `Year Released`</span><br></pre></td></tr></table></figure>
<p>If there is a space in the nickname, we should use the backtick character `.<br />
And if there is a space in in the Type name, or property value, we could use <code>''</code>.</p>
<h2 id="attaching-structure"><a class="markdownIt-Anchor" href="#attaching-structure"></a> Attaching structure</h2>
<p>extend the graph based on some existing nodes:</p>
<ol>
<li>first <code>MATCH</code> the existing connection points</li>
<li>attach the newly created nodes with relationships using <code>CREATE</code></li>
</ol>
<p>It is also possible to <code>CREATE</code> a node and a relationship simultaneously, but we’d better <code>CREATE</code> one by one for better readability.</p>
<blockquote>
<p>If the <code>MATCH</code> command return many rows, we could move <code>CREATE</code> before the <code>MATCH</code> line, so that it needn’t create new node for each line.</p>
</blockquote>
<h2 id="completing-patterns"><a class="markdownIt-Anchor" href="#completing-patterns"></a> Completing patterns</h2>
<p>Sometimes when we do <code>CREATE</code> command, we are not sure whether the node/relationship has existed.</p>
<p>In this case, we could use <code>MERGE</code> command to express a repeatable update operation.</p>
<p>It would check for the existence of the data before <code>CREATE</code>. Also we could <strong>add</strong> some properties using the <code>ON CREATE</code>.<br />
But <code>ON CREATE SET</code> <strong>could only add a property</strong>, if the property has existed, <strong>no changing</strong> would be performed.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MERGE (m:Movie &#123;title: &#x27;Cloud Atlas&#x27;&#125;)</span><br><span class="line">ON CREATE SET m.released = 2012</span><br><span class="line">RETURN m</span><br></pre></td></tr></table></figure>
<p>It comes with large cost check for existing matches first, especially on large graphs. So if we are sure to <strong>not create duplicate</strong> data use <code>CREATE</code> over <code>MERGE</code>.</p>
<p>Also, <code>MERGE</code> works for relationships:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie &#123;title: &#x27;Cloud Atlas&#x27;&#125;)</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;Tom Hanks&#x27;&#125;)</span><br><span class="line">MERGE (p)-[r:ACTED_IN]-&gt;(m)</span><br><span class="line">ON CREATE SET r.roles =[&#x27;Zachry&#x27;]</span><br><span class="line">RETURN p, r, m</span><br></pre></td></tr></table></figure>
<p>if the relationship direction is arbitrary, we could use <code>-[r:ACTED_IN]-</code>.</p>
<p>If we only pass one node for <code>MERGE</code> in a relationship, it would <code>CREATE</code> both the relationship and the other node.</p>
<h2 id="getting-the-correct-results"><a class="markdownIt-Anchor" href="#getting-the-correct-results"></a> Getting the correct results</h2>
<h3 id="filtering-results"><a class="markdownIt-Anchor" href="#filtering-results"></a> Filtering results</h3>
<p>After <code>MATCH</code>, using <code>WHERE</code> clause to use any number of boolean expressions, predicates, combined with <code>AND</code>, <code>OR</code>, <code>XOR</code> and <code>NOT</code>.</p>
<p>Actually it is equivalent to the query with the condition in the pattern.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie)</span><br><span class="line">WHERE m.title = &#x27;The Matrix&#x27;</span><br><span class="line">RETURN m</span><br><span class="line"></span><br><span class="line">==</span><br><span class="line">MATCH (m:Movie &#123;title: &#x27;The Matrix&#x27;&#125;)</span><br><span class="line">RETURN m</span><br></pre></td></tr></table></figure>
<p>There are optional conditions:</p>
<ol>
<li>property matching: <code>node.property_key = &quot;value&quot;</code></li>
<li>numeric comparisons: <code>node.property_key &gt;&lt;= int</code></li>
<li>matching regular expressions: <code>p.name =~ 'K.+'</code></li>
<li>the existence of values within a list: <code>&quot;target_str&quot; IN node.property_key</code></li>
<li>a pattern predicate restricts:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)-[:ACTED_IN]-&gt;(m)</span><br><span class="line">WHERE NOT (p)-[:DIRECTED]-&gt;()  // has never directed any movies</span><br><span class="line">RETURN p, m</span><br></pre></td></tr></table></figure>
<h4 id="querying-ranges-of-values"><a class="markdownIt-Anchor" href="#querying-ranges-of-values"></a> Querying ranges of values</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)</span><br><span class="line">WHERE 3 &lt;= p.yearsExp &lt;= 7</span><br><span class="line">RETURN p</span><br></pre></td></tr></table></figure>
<h4 id="testing-if-a-property-exists"><a class="markdownIt-Anchor" href="#testing-if-a-property-exists"></a> Testing if a property exists</h4>
<p>In Neo4j, a property <strong>only exists (is stored) if it has a value</strong>. A null property is not stored.<br />
we could use <code>IS NOT NULL</code> for these nodes with the property.</p>
<h4 id="checking-strings-partial-values-fuzzy-searches"><a class="markdownIt-Anchor" href="#checking-strings-partial-values-fuzzy-searches"></a> Checking strings — partial values, fuzzy searches</h4>
<p><code>p.name STARTS WITH 'M'</code><br />
<code>p.name CONTAINS 'a'</code><br />
<code>p.name ENDS WITH 'n'</code></p>
<p>use regular expressions: <code>WHERE p.name =~ 'Jo.*'</code></p>
<h4 id="in-a-list"><a class="markdownIt-Anchor" href="#in-a-list"></a> in a list</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE p.yearsExp IN [1, 5, 6]</span><br></pre></td></tr></table></figure>
<h4 id="filtering-on-patterns-inner-join"><a class="markdownIt-Anchor" href="#filtering-on-patterns-inner-join"></a> Filtering on patterns ( Inner join )</h4>
<p>can also filter results based on relationships or patterns</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//Query1: find which people are friends of someone who works for Neo4j</span><br><span class="line">MATCH (p:Person)-[r:IS_FRIENDS_WITH]-&gt;(friend:Person)</span><br><span class="line">WHERE exists((p)-[:WORKS_FOR]-&gt;(:Company &#123;name: &#x27;Neo4j&#x27;&#125;))</span><br><span class="line">RETURN p, r, friend;</span><br><span class="line"></span><br><span class="line">//Query2: find Jennifer&#x27;s friends who do not work for a company</span><br><span class="line">MATCH (p:Person)-[r:IS_FRIENDS_WITH]-&gt;(friend:Person)</span><br><span class="line">WHERE p.name = &#x27;Jennifer&#x27;</span><br><span class="line">AND NOT exists((friend)-[:WORKS_FOR]-&gt;(:Company))</span><br><span class="line">RETURN friend.name;</span><br></pre></td></tr></table></figure>
<h4 id="optional-patterns-outre-join"><a class="markdownIt-Anchor" href="#optional-patterns-outre-join"></a> Optional patterns( Outre join )</h4>
<p>In Cypher, you can use an <code>OPTIONAL MATCH</code> pattern to try to match it, but if it doesn’t find results, those rows will return null for those values.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//Find all people whose name starts with J and who may work for a company.</span><br><span class="line">MATCH (p:Person)</span><br><span class="line">WHERE p.name STARTS WITH &#x27;J&#x27;</span><br><span class="line">OPTIONAL MATCH (p)-[:WORKS_FOR]-(other:Company)</span><br><span class="line">RETURN p.name, other.name;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">+--------------------------------+</span><br><span class="line">| p.name      | other.name       |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| &#x27;Jennifer&#x27;  | &#x27;Neo4j&#x27;          |</span><br><span class="line">| &#x27;John&#x27;      | &#x27;XYZ&#x27;            |</span><br><span class="line">| &#x27;Joe&#x27;       | null             |</span><br><span class="line">+--------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="more-complex-patterns"><a class="markdownIt-Anchor" href="#more-complex-patterns"></a> More complex patterns</h4>
<p>we could expand our pattern to perform more complex relationships:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//Query2: find who likes graphs besides Jennifer that she is also friends with</span><br><span class="line">MATCH (j:Person &#123;name: &#x27;Jennifer&#x27;&#125;)-[:LIKES]-&gt;(:Technology &#123;type: &#x27;Graphs&#x27;&#125;)&lt;-[:LIKES]-(p:Person),</span><br><span class="line">      (j)-[:IS_FRIENDS_WITH]-(p)</span><br><span class="line">RETURN p.name;</span><br></pre></td></tr></table></figure>
<p>Also, we could use <code>,</code> to use multiple conditional patterns. It is also a good way to replace <code>WHERE exists(&lt;pattern&gt;)</code>.</p>
<h3 id="returning-results"><a class="markdownIt-Anchor" href="#returning-results"></a> Returning results</h3>
<p>after <code>RETURN</code>,  we could add some simple expressions to operate the returned value:</p>
<ol>
<li>index: <code>names[0]</code>, <code>movies[1..-1]</code>, <code>substring('2014-07-01', 0, 4)</code></li>
<li>length(array)</li>
<li>toInteger(‘12’)</li>
<li>coalesce(p.nickname, ‘n/a’)</li>
</ol>
<p><code>UNIQUE</code> could trim out duplicate entities.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//Query: find people who have a twitter or like graphs or query languages</span><br><span class="line">MATCH (user:Person)</span><br><span class="line">WHERE user.twitter IS NOT null</span><br><span class="line">WITH user</span><br><span class="line">MATCH (user)-[:LIKES]-(t:Technology)</span><br><span class="line">WHERE t.type IN [&#x27;Graphs&#x27;,&#x27;Query Languages&#x27;]</span><br><span class="line">RETURN DISTINCT user.name</span><br></pre></td></tr></table></figure>
<h4 id="limiting-number-of-results"><a class="markdownIt-Anchor" href="#limiting-number-of-results"></a> Limiting number of results</h4>
<p><code>LIMIT</code> keyword takes the output of the query and limits the volume returned based on the number you specify.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//Query: find the top 3 people who have the most friends</span><br><span class="line">MATCH (p:Person)-[r:IS_FRIENDS_WITH]-(other:Person)</span><br><span class="line">RETURN p.name, count(other.name) AS numberOfFriends</span><br><span class="line">ORDER BY numberOfFriends DESC</span><br><span class="line">LIMIT 3</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/getting-started/current/cypher-intro/results/#cypher-intro-results-aggregating">https://neo4j.com/docs/getting-started/current/cypher-intro/results/#cypher-intro-results-aggregating</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/02/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/py2neo%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/02/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/py2neo%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">py2neo介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-02 18:41:24" itemprop="dateCreated datePublished" datetime="2021-03-02T18:41:24-08:00">2021-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge-Graph/" itemprop="url" rel="index"><span itemprop="name">Knowledge Graph</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>7 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="http://codewithzhangyi.com/2019/04/23/knowledge-graph-intro/">http://codewithzhangyi.com/2019/04/23/knowledge-graph-intro/</a></p>
<p>红楼梦问答： <a target="_blank" rel="noopener" href="https://piqiandong.blog.csdn.net/article/details/125697786">https://piqiandong.blog.csdn.net/article/details/125697786</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/meiqi0538/category_11901623.html?spm=1001.2014.3001.5482">https://blog.csdn.net/meiqi0538/category_11901623.html?spm=1001.2014.3001.5482</a></p>
<h2 id="neo4j-配置"><a class="markdownIt-Anchor" href="#neo4j-配置"></a> neo4j 配置</h2>
<p>mac 配置neo4j社区版：<a target="_blank" rel="noopener" href="https://www.jiyik.com/w/neo4j/neo4j-install">Neo4j Mac 系统中安装</a></p>
<p>解压的文件夹的bin目录下，有个<code>neo4j</code>，就是启动文件，所以可以在<code>~/.bashrc</code>中修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NEO4J_HOME=/Users/liuyilin/Downloads/NLP_project/neo4j-community-4.4.16 # 下载的解压文件</span><br><span class="line">export PATH=$PATH:$NEO4J_HOME/bin</span><br></pre></td></tr></table></figure>
<p>用户名 <code>neo4j</code>，新密码为  <code>neo4j123</code>。<br />
然后以后直接在后台进程中使用<code>neo4j</code>即可：<code>neo4j start</code><br />
启动后可以在命令行查看到地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Started neo4j (pid:34617). It is available at http://localhost:7474</span><br></pre></td></tr></table></figure>
<h2 id="py2neo-版本"><a class="markdownIt-Anchor" href="#py2neo-版本"></a> py2neo 版本</h2>
<p>v4 版本： <a target="_blank" rel="noopener" href="https://py2neo.org/v4/#library-reference">https://py2neo.org/v4/#library-reference</a> ，不兼容</p>
<p>2021.1 版本：<a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/">https://py2neo.org/2021.1/</a></p>
<br>
<p>导入 py2neo 包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --user  -i https://pypi.tuna.tsinghua.edu.cn/simple py2neo==2021.1</span><br></pre></td></tr></table></figure>
<h2 id="建立连接"><a class="markdownIt-Anchor" href="#建立连接"></a> 建立连接</h2>
<ul>
<li>
<p><strong>首先需要打开 neoo4j</strong></p>
</li>
<li>
<p>与网站建立连接：py2neo.graph 函数，参数为用户名以及密码，会返回一个<code>py2neo.Graph</code>链接对象</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = Graph(&quot;http://localhost:7474&quot;, auth=(&quot;neo4j&quot;,&quot;neo4j123&quot;))</span><br></pre></td></tr></table></figure>
<ul>
<li>清空原数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.delete_all()</span><br></pre></td></tr></table></figure>
<ul>
<li>CQL 语言查询<br />
<code>graph.run()</code> 里面放命令字符串</li>
</ul>
<h2 id="graph-对象方法"><a class="markdownIt-Anchor" href="#graph-对象方法"></a> Graph 对象方法</h2>
<p>Graph objects：<a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/workflow.html#graph-objects">https://py2neo.org/2021.1/workflow.html#graph-objects</a></p>
<ul>
<li>
<p><code>match(nodes=None, r_type=None, limit=None)[source]</code><br />
返回所有符合要求的 <code>py2neo.matching.RelationshipMatch</code> 对象</p>
<ul>
<li>nodes：Sequence or Set of start and end nodes (None means any node);</li>
<li>r_type：type of relationships to match (None means any type)</li>
<li>limit：maximum number of relationships to match (None means unlimited)</li>
</ul>
</li>
<li>
<p><code>match_one(nodes=None, r_type=None)</code><br />
只返回一个关系</p>
</li>
<li>
<p><code>merge(subgraph, label=None, *property_keys)[source]</code>：<br />
当<code>merge</code>调用时，是一个自动提交的一个视图，用于新建或者更新 subgraph 中的节点和关系，注意<strong>只能增不能删。</strong><br />
subgraph 中的节点和关系是独立更新的，节点先更新，关系再更新。<br />
对于subgraph中的每个节点，首先比较 label 和 property（输入参数指定），如果没有匹配选项，则创建，如果有匹配选项，则更新。<br />
对于subgraph中的每个关系，比较的是两个节点和关系type/类型，没有则新建，有则更新。</p>
<ul>
<li>subgraph：一个节点，关系，或者子图</li>
<li>label：用于匹配节点的type/label。仅用于匹配节点，匹配成功后可能会被重写。</li>
<li>property_keys：用于匹配节点的属性值。仅用于匹配节点，匹配成功后可能会被重写。</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from py2neo import Graph, Node, Relationship</span><br><span class="line">&gt;&gt;&gt; g = Graph()</span><br><span class="line">&gt;&gt;&gt; a = Node(&quot;Person&quot;, name=&quot;Alice&quot;, age=33)</span><br><span class="line">&gt;&gt;&gt; b = Node(&quot;Person&quot;, name=&quot;Bob&quot;, age=44)</span><br><span class="line">&gt;&gt;&gt; KNOWS = Relationship.type(&quot;KNOWS&quot;)</span><br><span class="line">&gt;&gt;&gt; g.merge(KNOWS(a, b), &quot;Person&quot;, &quot;name&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>delete(subgraph)</code>：删除一个子图，是一个自动提交的视图。</p>
</li>
<li>
<p>property <code>nodes</code><br />
返回一个 <code>NodeMatcher</code> 对象</p>
</li>
</ul>
<h2 id="节点操作"><a class="markdownIt-Anchor" href="#节点操作"></a> 节点操作</h2>
<p><strong>Node和Relationship在这个驱动中都继承了PropertyDict这个类，而这个类继承类python里面的dict，所以操作和python本身的dict一模一样</strong></p>
<p>节点的 <code>(:value)</code> 是参数 label，而关系的  <code>(:value)</code> 是参数 <code>type</code>。</p>
<h3 id="增删改"><a class="markdownIt-Anchor" href="#增删改"></a> 增删改</h3>
<ul>
<li>
<p>新建节点：<code>py2neo.Node</code> 类，<br />
参数为标签 label 和属性 property，返回一个节点对象</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = Node(&quot;yili&quot;, gender=&quot;male&quot;)</span><br></pre></td></tr></table></figure>
<p>得到节点为 <code>(:yili &#123;gender: 'male'&#125;)</code>，这里的 label 就是 <code>yili</code></p>
</li>
<li>
<p>放置节点：<code>graph.create</code> 函数</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.create(a)</span><br></pre></td></tr></table></figure>
<p>该方法不会自己检查该节点是否已经创建，所以在实际使用，应先检查要创建的节点是否存在。或者使用 <code>Merge</code> 方法。</p>
</li>
<li>
<p>删除节点：<code>graph.delete</code> 函数</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.delete(node_a)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>获取node的属性：<code>x=test_node_2[key]</code></p>
</li>
<li>
<p>设置node的属性：<code>test_node_2[key] = value</code> + <code>graph.push(test_node_2)</code></p>
</li>
<li>
<p>删除node的属性：<code>del node[key]</code></p>
</li>
<li>
<p>返回node里面property的个数：<code>len(node)</code></p>
</li>
<li>
<p>返回所有和这个节点有关的label：<code>node.labels</code></p>
</li>
<li>
<p>将node的所有property以dictionary的形式返回：<code>dic(node)</code></p>
</li>
</ul>
<p>使用 <code>py2neo</code> 修改 Node 或者 Relation 时，当我们直接用语法，如果没有进行绑定，就会仅仅是对本地端的数据进行了处理，而没有作用到数据库上去。</p>
<p><strong>修改节点时有两个必要条件：</strong></p>
<ol>
<li>节点已经和 <code>Graph</code>类注册，通常是<code>create()</code>方法或者<code>match()</code>方法得到的，即「自己推上去」的和「自己查询到的」。</li>
<li>修改节点后需要调用方法 <code>graph.push(node_object)</code> 把它提交上去。</li>
</ol>
<h3 id="查询节点"><a class="markdownIt-Anchor" href="#查询节点"></a> 查询节点</h3>
<h4 id="根据属性查询"><a class="markdownIt-Anchor" href="#根据属性查询"></a> 根据属性查询</h4>
<ul>
<li>
<p>匹配/链接 节点，使用到节点匹配器 <code>py2neo.matching.NodeMatcher</code> 类</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from py2neo.matching import *</span><br><span class="line">matcher = NodeMatcher(graph)  # 创建节点匹配器</span><br><span class="line"></span><br><span class="line">result = matcher.match(&#x27;判决文书&#x27;, name = &#x27;XXX刑事判决书&#x27;).exists()  # 符合条件的是否存在</span><br><span class="line"></span><br><span class="line">node = matcher.match(&#x27;判决文书&#x27;).where(name = &#x27;XXX刑事判决书&#x27;).first()　# 评估匹配并返回匹配的第一个节点</span><br></pre></td></tr></table></figure>
<p><code>matcher.match('判决文书', name = 'XXX刑事判决书')</code> 和 <code>matcher.match('判决文书').where(name = 'XXX刑事判决书')</code> 是两种匹配方式。<br />
where可以进行精确匹配，可以用表达式进行较复杂的匹配，比如 <code>where(&quot;_.name=&quot; + &quot;'&quot; + *名称 + &quot;'&quot;)</code>，默认用<code>_</code>表示节点。</p>
</li>
<li>
<p>查询节点：</p>
<ul>
<li>命令直接查询：<code>graph.run('MATCH (a:人) RETURN a')</code>，返回一个 <code>Node list</code></li>
<li><code>graph.nodes.match('人')</code>，根据type查询节点，返回一个 <code>py2neo.matching.NodeMatch</code> 类型数据。<br />
参数为<code>*labels, **properties</code>，所以也可以指定属性：<code>graph.nodes.match('人', name='小红')</code><br />
<code>type(graph.nodes)=py2neo.matching.NodeMatcher object</code>，也是一个 <code>matcher</code>对象，所以后续也是使用 <code>match()</code> 方法。</li>
</ul>
</li>
</ul>
<p><code>NodemMatcher.match()</code> 函数返回的结果是一个 <code>NodeMatch</code> 类型数据，可以用<code>list()</code>进行强制转换。<br />
同时，这个<code>NodeMatch</code>对象后可以接上一些方法：</p>
<ul>
<li><code>where()</code>：进行二次筛选</li>
<li><code>first()</code>：输出第一个节点</li>
<li><code>exists()</code>：是否存在</li>
<li><code>limit()</code>：限制数量</li>
</ul>
<h4 id="根据-id-查询"><a class="markdownIt-Anchor" href="#根据-id-查询"></a> 根据 id 查询</h4>
<p>获取节点的 id ：调用节点的<code>identity</code>属性：<code>node.identity</code></p>
<p>通过 id 得到节点 ：<code>created_node = matcher[node_id]</code></p>
<h2 id="关系操作"><a class="markdownIt-Anchor" href="#关系操作"></a> 关系操作</h2>
<p><a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/data/index.html#py2neo.data.Relationship">py2neo.data.Relationship</a></p>
<h3 id="增删改-2"><a class="markdownIt-Anchor" href="#增删改-2"></a> 增删改</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab = Relationship(a, &quot;KNOWS&quot;, b)</span><br><span class="line">graph.create(ab)</span><br></pre></td></tr></table></figure>
<p>关系同样也有类似的操作：</p>
<ul>
<li>创建relationship：<code>Relationship(start_node, type, end_node, properties)</code></li>
<li>返回Relationship的property：<code>Relationship[key]</code></li>
<li>删除某个property：<code>del Relationship[key]</code></li>
<li>将property以字典形式返回：<code>dict(relationship)</code></li>
</ul>
<h3 id="查询关系"><a class="markdownIt-Anchor" href="#查询关系"></a> 查询关系</h3>
<ul>
<li>使用关系查询器，</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">relation_matcher = RelationshipMatcher(graph)</span><br><span class="line">result = relation_matcher.match(&#123;first_node, second_node&#125;, r_type = None, key = value).first()</span><br></pre></td></tr></table></figure>
<p>参数为：<code>nodes=None, r_type=None, **properties</code><br />
- nodes ：一般为 <code>&#123;start-node, end-node&#125;</code> 格式<br />
- r_type：关系type<br />
- properties：关系属性，<code>key = value</code>格式</p>
<ul>
<li>图自带查询：<code>graph.match(r_type=&quot;喜欢&quot;)</code></li>
</ul>
<h2 id="node-and-relationship-matching"><a class="markdownIt-Anchor" href="#node-and-relationship-matching"></a> Node and relationship matching</h2>
<p><a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/matching.html?highlight=relationshipmatcher">API for Node and relationship matching</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/14/Coding/Python/python%20%E5%A4%9A%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/14/Coding/Python/python%20%E5%A4%9A%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">python 多进程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-14 10:57:32" itemprop="dateCreated datePublished" datetime="2021-02-14T10:57:32-08:00">2021-02-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>14 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/111430051">34、python并发编程之多进程（操作篇）</a><br />
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/493699150">【Python】Python多进程详解</a><br />
<a target="_blank" rel="noopener" href="http://www.cnblogs.com/Anker/p/3271773.html">僵尸进程与孤儿进程（了解）</a><br />
<a target="_blank" rel="noopener" href="https://www.cnblogs.com/fengf233/p/11506337.html">python多进程总结</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/02/14/Coding/Python/python%20%E5%A4%9A%E8%BF%9B%E7%A8%8B/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pandas/pandas%20%20Nan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Pandas/pandas%20%20Nan/" class="post-title-link" itemprop="url">pandas  Nan</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/" itemprop="url" rel="index"><span itemprop="name">Data Analysis Package</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/Pandas/" itemprop="url" rel="index"><span itemprop="name">Pandas</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>133</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="单个元素"><a class="markdownIt-Anchor" href="#单个元素"></a> 单个元素</h1>
<p>特殊类型 <code>na=np.nan</code></p>
<ul>
<li>不可以直接用来判断的方式，即以下结果和我们预期不一样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">na == np.nan  # False</span><br><span class="line">bool(na)  # True</span><br><span class="line">if na:</span><br><span class="line">    print(&#x27;na is not null&#x27;)  # Output: na is not null</span><br></pre></td></tr></table></figure>
<ul>
<li>使用专用函数判断单个元素（可以用于 map<br />
对于pandas中空值的判断，我们只能通过pandas或者numpy的函数，不能用python的内置函数any或all判断。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pd.isnull(na)  # True</span><br><span class="line">pd.isna(na)  # True</span><br><span class="line">np.isnan(na)  # True</span><br></pre></td></tr></table></figure>
<h1 id="强制转换数据类型"><a class="markdownIt-Anchor" href="#强制转换数据类型"></a> 强制转换数据类型</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dfx[[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]] = dfx[[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]].astype(&#x27;float32&#x27;)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/" class="post-title-link" itemprop="url">pandas库的简单讲解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/" itemprop="url" rel="index"><span itemprop="name">Data Analysis Package</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/Pandas/" itemprop="url" rel="index"><span itemprop="name">Pandas</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>30 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/583d83f1ff81">https://www.jianshu.com/p/583d83f1ff81</a></p>
<p>导入pandas库： <code>import pandas as pd </code></p>
<h1 id="其他点"><a class="markdownIt-Anchor" href="#其他点"></a> 其他点</h1>
<ul>
<li>注意 dp 中的 nan，应该用  <code>np.nan</code> 来指定</li>
</ul>
<h1 id="series"><a class="markdownIt-Anchor" href="#series"></a> Series</h1>
<h2 id="创建"><a class="markdownIt-Anchor" href="#创建"></a> 创建</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.Series( data=<span class="literal">None</span>, index=<span class="literal">None</span>, dtype=<span class="literal">None</span>, )</span><br></pre></td></tr></table></figure>
<p><code>data : array-like, Iterable, dict, or scalar value</code><br />
<code>index : array-like or Index (1d)</code>：如果没有指定，则默认从 0 开始<br />
<code>dtype : str, numpy.dtype, or ExtensionDtype, optional</code><br />
<code>copy : bool, default False</code> ：Copy input data. <strong>Only affects Series or 1d ndarray input.</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a= pd.Series([1,2,3,4],index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;,&#x27;d&#x27;])</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">d    4</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d = &#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; pd.Series(data=d)</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; pd.Series(data=d, index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span><br><span class="line">a   1</span><br><span class="line">b   2</span><br><span class="line">c   3</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"># 根据字典创建则需要 index 匹配 key</span><br><span class="line">&gt;&gt;&gt; pd.Series(data=d, index=[&#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;])</span><br><span class="line">x   NaN</span><br><span class="line">y   NaN</span><br><span class="line">z   NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<h2 id="attribute"><a class="markdownIt-Anchor" href="#attribute"></a> Attribute</h2>
<p><code>.T</code>：对 Pandas Series 使用 <code>.T</code> ，它将不会执行矩阵的转置操作，而只是返回原始 Series，因为 Series 本身只有一列。<br />
<code>.array</code>：return <code>&lt;PandasArray&gt;</code> ，忽略 index<br />
<code>.values</code>：return <code>numpy.ndarray</code> ，忽略 index<br />
<code>.ndim</code>：return Number of dimensions of the underlying data, by definition 1 .<br />
<code>.hahnans</code>：Return True if there are any NaNs. 注意不是方法，而是属性，不需加括号 。<br />
<code>.empty</code>：用于检查是否为空，注意区别 NaN，NaN 不是空，这里空表示 <code>pd.DataFrame(&#123;'A' : []&#125;)</code> 没有定义。<br />
<code>.name</code>：Series 的一个属性，直接创建的话，默认为空，但是可以修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a.name = &#x27;hhhh&#x27;</span><br><span class="line">&gt;&gt;&gt; a.name</span><br><span class="line">&#x27;hhhh&#x27;</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">Name: hhhh, dtype: int64</span><br></pre></td></tr></table></figure>
<p><strong>dtype 相关 ：</strong></p>
<ul>
<li><code>.dtype</code></li>
<li><code>.astype(dtype, copy=None, errors='raise')</code>：修改 dtype 属性</li>
<li><code>pandas.Series.convert_dtypes()</code>：<strong>non-inplace</strong> 用于将 Series 中的数据类型转换为最适合存储数据的数据类型，以节省内存和提高性能。</li>
</ul>
<p><strong>索引相关 ：</strong></p>
<ul>
<li><code>['a'] / .at['a'] / .loc['a']</code>：返回对应 <code>'a'</code> 的元素，注意使用中括号 <code>[]</code></li>
<li><code>[0] / .iat[0] / .iloc[0]</code>：返回对应 0-index 的元素，注意使用中括号 <code>[]</code></li>
<li><code>.keys()</code>  / <code>.values()</code>：类似字典，返回取值</li>
</ul>
<p><strong>转换函数相关 ：</strong></p>
<ul>
<li><code>.abs()</code></li>
<li><code>.pop()</code>：return and drop，参数为 index label 值，区分数组。</li>
<li><code>.add(other, level=None, fill_value=None, axis=0)</code>：<br />
等于 <code>series + other</code>，但是可以设置参数 <code>fill_value</code>
<ul>
<li><code>other</code>: 放另一个 Series ，会将同一个 index value 的进行相加 。</li>
<li><code>level=None</code>: 用于填充缺失值（NaN）。如果最少一个不是 NaN，则使用缺失值 ； 如果两个都是 NaN，则结果还是 NaN ；默认情况下不指定，则只要有一个为 NaN，结果就是 NaN 。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = pd.Series([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, np.nan], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = pd.Series([<span class="number">1</span>, np.nan, <span class="number">1</span>, np.nan], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.add(b, fill_value=<span class="number">1</span>)</span><br><span class="line">a    <span class="number">2.0</span></span><br><span class="line">b    <span class="number">2.0</span></span><br><span class="line">c    <span class="number">2.0</span></span><br><span class="line">d    <span class="number">2.0</span></span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.sub(other, level=None, fill_value=None, axis=0)</code>：同上，是删除操作<br />
等于 <code>series - other</code>，但是可以设置参数 <code>fill_value</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a.sub(b, fill_value=4)</span><br><span class="line">a    0.0</span><br><span class="line">b   -3.0</span><br><span class="line">c   -3.0</span><br><span class="line">d    3.0</span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; a.sub(b)</span><br><span class="line">a    0.0</span><br><span class="line">b    NaN</span><br><span class="line">c    NaN</span><br><span class="line">d    NaN</span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.mul(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series * other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.div(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series / other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.floordiv(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series // other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.mod(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series % other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.pow(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series ** other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.combine(other, func, fill_value=None)</code> :根据 <code>func</code>函数，处理两个series 的对应值，比如 <code>max / min / ...</code><br />
注意如果没有指定 <code>fill_value</code> ，如果存在一方为 NaN，并且是比大小的话，则保留调用该方法的 series 内部的值。<br />
如果自定义使用 lambda 的话，则会保留 NaN，即使有填充值。<br />
反正不建议使用这个操作，先 fillna 然后再进行变换比较好。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">a    3.0</span><br><span class="line">b    NaN</span><br><span class="line">d    8.0</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">a    1.0</span><br><span class="line">b    1.0</span><br><span class="line">c    1.0</span><br><span class="line">d    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.combine(a,  min)</span><br><span class="line">a    1.0</span><br><span class="line">b    NaN  # 这里保留了 Series b 的值，尽管 Series a 中有值</span><br><span class="line">c    NaN</span><br><span class="line">d    8.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>.lt(other, level=None, fill_value=None, axis=0)</code></p>
</li>
<li>
<p><code>.gt</code></p>
</li>
<li>
<p><code>.le</code></p>
</li>
<li>
<p><code>.ge</code></p>
</li>
<li>
<p><code>.ne</code></p>
</li>
<li>
<p><code>.eq</code></p>
</li>
<li>
<p><code>.round()</code> ： 四舍五入取整数，不看正负</p>
</li>
<li>
<p><code>.apply(func, convert_dtype=_NoDefault.no_default, args=(), *, by_row='compat', **kwargs)</code>：可以用于 Series 或 DataFrame 对象。</p>
<ul>
<li>args : 是该方法的一些其他参数 ， 可以使用 <code>**</code> 转换为字典，更方便 。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = pd.Series([20, 21, 12],  index=[&#x27;London&#x27;, &#x27;New York&#x27;, &#x27;Helsinki&#x27;])</span><br><span class="line">&gt;&gt;&gt; s.apply(lambda x,y: x-y, args=(5,))</span><br><span class="line">London      15</span><br><span class="line">New York    16</span><br><span class="line">Helsinki     7</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; def add_custom_values(x, **kwargs):</span><br><span class="line">...     for month in kwargs:</span><br><span class="line">...         x += kwargs[month]</span><br><span class="line">...     return x</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s.apply(add_custom_values, june=30, july=20, august=25)</span><br><span class="line">London      95</span><br><span class="line">New York    96</span><br><span class="line">Helsinki    87</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.map(arg, na_action=None)</code>和 apply 类似，但是通常用于 Series 对象。
<ul>
<li><code>arg : function, collections.abc.Mapping subclass or Series</code>，除了 lambda，也可以穿入一个字典</li>
<li><code>na_action=None</code> ，如果为 <code>ignore</code>，则 NaN 处理后还是 NaN 。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.map(&#x27;I am a &#123;&#125;&#x27;.format)</span><br><span class="line">0       I am a cat</span><br><span class="line">1       I am a dog</span><br><span class="line">2       I am a nan</span><br><span class="line">3    I am a rabbit</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s.map(&#x27;I am a &#123;&#125;&#x27;.format, na_action=&#x27;ignore&#x27;)</span><br><span class="line">0     I am a cat</span><br><span class="line">1     I am a dog</span><br><span class="line">2            NaN</span><br><span class="line">3  I am a rabbit</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>
<h1 id="dataframe"><a class="markdownIt-Anchor" href="#dataframe"></a> DataFrame</h1>
<h2 id="创建-2"><a class="markdownIt-Anchor" href="#创建-2"></a> 创建</h2>
<ol>
<li>按列直接创建：</li>
</ol>
<ul>
<li>不指定行索引index（行索引被默认为数字，从0开始），参数为列的字典</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&#x27;one&#x27;: [1, 2, 3], &#x27;two&#x27;: [4, 5, 6]&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">0    1    4</span><br><span class="line">1    2    5</span><br><span class="line">2    3    6</span><br></pre></td></tr></table></figure>
<ul>
<li>指定行索引index，参数为列的字典和行索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&#x27;one&#x27;: [1, 2, 3], &#x27;two&#x27;: [4, 5, 6]&#125;, index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a    1    4</span><br><span class="line">b    2    5</span><br><span class="line">c    3    6</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>按照行进行创建<br />
<code>append</code> 方法创建</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">创建一个空的Dataframe</span><br><span class="line">result =pd.DataFrame(columns=(&#x27;idx&#x27;,&#x27;degree&#x27;,&#x27;weight&#x27;,&#x27;diameter&#x27;))</span><br><span class="line">#将计算结果逐行插入result,注意变量要用[]括起来,同时ignore_index=True，否则会报错，ValueError: If using all scalar values, you must pass an index</span><br><span class="line">for i in idx:</span><br><span class="line">    degree=</span><br><span class="line">    weight=</span><br><span class="line">    diameter=</span><br><span class="line">    result=result.append(pd.DataFrame(&#123;&#x27;idx&#x27;:[i],&#x27;degree&#x27;:[degree],&#x27;weight&#x27;:[weight],&#x27;diameter&#x27;:[diameter]&#125;),ignore_index=True)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>使用Series创建：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&quot;one&quot;: pd.Series([1, 2, 3], index=[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]), &quot;two&quot;:pd.Series([1,2,3,4],index=[&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;,&#x27;d&#x27;])&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a  1.0    2</span><br><span class="line">b  2.0    1</span><br><span class="line">c  3.0    3</span><br><span class="line">d  NaN    4</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>使用index和columns参数创建：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dates = pd.date_range(&#x27;today&#x27;,periods=6) # 定义时间序列作为 index</span><br><span class="line">num_arr = np.random.randn(6,4) # 传入 numpy 随机数组</span><br><span class="line">columns = [&#x27;A&#x27;,&#x27;B&#x27;,&#x27;C&#x27;,&#x27;D&#x27;] # 将列表作为列名</span><br><span class="line">df1 = pd.DataFrame(num_arr, index = dates, columns = columns)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">                                   A         B         C         D</span><br><span class="line">2021-02-14 11:00:38.210410 -0.234308  0.458834  1.758701 -0.390679</span><br><span class="line">2021-02-15 11:00:38.210410 -1.448708  0.534228  0.404082  0.722971</span><br><span class="line">2021-02-16 11:00:38.210410  0.540040 -0.593858  0.882544  0.499553</span><br><span class="line">2021-02-17 11:00:38.210410 -1.295320  0.909557 -1.058109 -0.530681</span><br><span class="line">2021-02-18 11:00:38.210410  0.307840  0.328438 -0.680865 -2.096587</span><br><span class="line">2021-02-19 11:00:38.210410 -1.777850  0.615222 -0.213545 -0.219512</span><br></pre></td></tr></table></figure>
<h2 id="属性"><a class="markdownIt-Anchor" href="#属性"></a> 属性</h2>
<ul>
<li><code>.index</code>: 返回 index</li>
<li><code>.columns</code>: 返回 columns 特征列表</li>
<li><code>.ndim</code>: 返回特征数量，也就是 columns 数量</li>
<li><code>.info()</code></li>
<li><code>.describe()</code>: 返回  statistics 统计量</li>
<li><code>.values</code>: 返回一个 <code>numpy.ndarray</code></li>
<li><code>.size</code>: 返回元素数量，NaN 也算</li>
<li><code>.shape</code></li>
<li><code>.T</code>: 转制</li>
<li>更改列名：
<ol>
<li>修改列名a，b为A、B：<code>df.columns = ['A','B']</code></li>
<li>只修改列名a为A：<code>df = df.rename(columns=&#123;'a':'A'&#125;)</code></li>
</ol>
</li>
<li><code>.reset_index()</code>：重置 DataFrame 的索引，从 0 开始。
<ul>
<li><code>drop=False</code>：默认情况下新的  df 会保留原始 df 的 index，成为一个新的列；如果 <code>drop=True</code>，那么旧的 index 会被直接删除。</li>
</ul>
</li>
<li><code>.set_index('A')</code>：设置 ‘A’ 列作为行索引</li>
<li><code>.rename_axis('New_Index')</code>：重命名索引</li>
</ul>
<h3 id="dtype-类型"><a class="markdownIt-Anchor" href="#dtype-类型"></a> dtype 类型</h3>
<ul>
<li><code>.astype(dtype, copy=None, errors='raise')</code>
<ul>
<li><code>dtype : str, data type, Series or Mapping of column name -&gt; data type</code><br />
str：dtype，比如 <code>'int32'</code><br />
字典：针对特定的列进行操作，key 为 column 名称，value 为 str类型 的 dtype</li>
</ul>
</li>
<li><code>.convert_dtypes()</code>: 转化 dtype 来节省内存，Convert columns to the best possible dtypes using dtypes supporting <a target="_blank" rel="noopener" href="http://pd.NA">pd.NA</a> 。</li>
</ul>
<h3 id="数值操作"><a class="markdownIt-Anchor" href="#数值操作"></a> 数值操作</h3>
<ul>
<li><code>+-*///%   int/arr</code>：int 就是所有列都进行同一个操作 ，arr 表示对应的列跟arr对应元素进行操作 。<br />
而 <code>.add() / sub()</code> 等方法默认就是 <code>columns</code> ，好处就是可以赋值参数 <code>fill_value</code> 。</li>
<li><code>mean()</code>：每一列的 mean</li>
<li><code>sum()</code>：每一列的 sum</li>
<li><code>std(axis=0, skipna=True, ddof=1, numeric_only=False, **kwargs)</code>：计算标准差，默认列</li>
<li><code>var(axis=0, skipna=True, ddof=1, numeric_only=False, **kwargs)</code>：计算方差，默认列</li>
<li><code>nunique(axis=0, dropna=True)</code>：非重复值的数量，默认列</li>
<li><code>round()</code> ：四舍五入<br />
可以直接传入一个 <code>int</code> 表示保留小数部分的位数：<code>df.round(2)</code><br />
或者根据字典单独定义不同列需要保留的位数： <code>df.round(&#123;&quot;col1&quot;:1, &quot;col2&quot;:2&#125;)</code></li>
</ul>
<h3 id="排序"><a class="markdownIt-Anchor" href="#排序"></a> 排序</h3>
<ul>
<li><code>sort_values()</code>：根据元素值进行行排序，NaN 放在最下面
<ul>
<li><code>by : str or list of str</code> ：传入列标签的名称，或者名称的数组，表示排序的依据</li>
<li>当使用多个排序标准时，使用数组 <code>df1.sort_values(by=['age', 'visits'], ascending=[False, True])</code></li>
</ul>
</li>
<li><code>sort_index(axis=0, ascending=True, key=None)</code>：仅根据 index 进行排序，即不考虑实际的内容，只想把 index 改正
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li><code>key : callable, optional</code>：可以传入 lambda 数组</li>
</ul>
</li>
</ul>
<h3 id="增删改"><a class="markdownIt-Anchor" href="#增删改"></a> 增删改</h3>
<p><strong>插入 ：</strong></p>
<ul>
<li>插入列：<code>.insert(loc, column, value, allow_duplicates=_NoDefault.no_default)</code>
<ul>
<li><code>loc : int</code>：Must verify 0 &lt;= loc &lt;= len(columns) ， 表示新插入是第几列</li>
<li><code>column</code>：新的列名</li>
<li><code>value : Scalar, Series, or array-like</code> ：列的值</li>
<li><code>allow_duplicates : bool, optional, default lib.no_default</code> ： 是否允许和已经有的列名重复</li>
</ul>
</li>
<li>插入列：<code>df['new_column_name'] = ...</code></li>
<li>插入行：
<ul>
<li><code>df.loc[len(df)] = [4, 7]</code> ：创建一个列表，其中的元素按照 DataFrame 列的顺序排列</li>
<li><code>df = df.append(&#123;'A': 4, 'B': 7&#125;, ignore_index=True)</code> ：创建一个字典，其中键是列名，值是要插入的数据</li>
</ul>
</li>
</ul>
<p><strong>删除：</strong></p>
<ul>
<li>删除特定行或者列：<code>.drop(labels=None, *, axis=0, index=None, columns=None, level=None, inplace=False, errors='raise')</code>
<ul>
<li><code>labels : single label or list-like</code> ：名称或者名称的列表</li>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li><code>index : single label or list-like</code>：直接指定删除的行名称</li>
<li><code>columns : single label or list-like</code>：直接指定删除的列名称</li>
</ul>
</li>
<li>删除并返回特定列：<code>.pop(column_name)</code> ：删除并返回 column_name 列</li>
</ul>
<p><strong>修改：</strong></p>
<ul>
<li><code>.where(cond, other=nan, *, inplace=False, axis=None, level=None)</code>：<br />
根据指定的条件筛选 DataFrame 中的数据，并将不满足条件的 False元素 替换为指定的值 <code>other=nan</code>。
<ul>
<li><code>cond</code> 返回 True/False ， 需要维度和 df 的维度一致。用于筛选，一般直接是 df 的操作，因为目的是为了填充一些元素。</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = pd.Series(range(5))</span><br><span class="line">&gt;&gt;&gt; s.where(s &gt; 0)</span><br><span class="line">0    NaN</span><br><span class="line">1    1.0</span><br><span class="line">2    2.0</span><br><span class="line">3    3.0</span><br><span class="line">4    4.0</span><br></pre></td></tr></table></figure>
</li>
<li><code>.mask(cond, other=_NoDefault.no_default, *, inplace=False, axis=None, level=None)</code>：和 where 一样，只不过这里是替换 True 的元素 。</li>
<li><code>.truncate(before=None, after=None, axis=None, copy=None)</code>：截断，保留 [before, after] 的部分 。
<ul>
<li><code>before : date, str, int</code> ：Truncate all rows before this index value.</li>
<li><code>after : date, str, int</code> ：Truncate all rows after this index value.</li>
<li><code>axis=0 : &#123;0 or ‘index’, 1 or ‘columns’&#125;, optional</code></li>
</ul>
</li>
<li>根据一列来新建另一列，使用到了 numpy  三元条件表达式：<code>apl['涨跌'] = np.where(apl[3]&gt;0,'涨',np.where(apl[3]==0,'平','跌'))</code></li>
</ul>
<h3 id="apply-map"><a class="markdownIt-Anchor" href="#apply-map"></a> apply / map</h3>
<ul>
<li><code>.apply(func, axis=0, raw=False, result_type=None, args=(), by_row='compat', **kwargs)</code>
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li>默认是每一个 column 为一个整体，当然也可以理解为：逐个元素进行操作 ， 比如：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resampled.apply(lambda col: np.std(col))  # 计算每一列的方差</span><br><span class="line">d.apply(lambda x: x+1) # 每一列元素 + 1 -&gt; 每个元素 + 5</span><br></pre></td></tr></table></figure>
<ul>
<li>可以直接对整个 df 进行操作，即列和列之间对比，注意加上 <code>axis=1</code>：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">step1_df[&#x27;label&#x27;] = step1_df.apply(lambda x: 1 if str(x.pred_content_id) in x.true_content_id else 0, axis=1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="索引方式"><a class="markdownIt-Anchor" href="#索引方式"></a> 索引方式</h2>
<ul>
<li><code>.at['row_label', 'column_label']</code>  /  <code>.iat['row_idx', 'column_idx']</code> ：at 方法仅用于选择单个元素，</li>
<li><code>.loc['row_label', 'column_label']</code> / <code>.iloc['row_idx', 'column_idx']</code> ：选择单个元素</li>
<li><code>[column_label][row_label]</code>：选择标签对应的元素，不建议使用这种方式</li>
<li><code>[column_label]</code>：选择一整个列；<br />
<code>[row_label, :]</code>/<code>[row_label]</code>：选择一整行</li>
<li>花式索引：<code>d['one'][d['one']&gt; 2]</code> ; <code>d.loc[['a', 'c'],  'one']</code> ; <code>target[(target.event==1)&amp;(target.season==3)]</code> ， 注意用 <code>()</code> 括起来，然后加上 <code>&amp;</code>，不能改成 <code>and</code>; <code>or</code> 则是 <code>|</code> 。</li>
<li><code>isin(array)</code>/ <code>~isin(array)</code>：返回一个 True / False 数据结构，可以用于索引，比如 <code>d[d['one'].isin([1,2])]</code> 。</li>
</ul>
<h2 id="nan-处理-填充"><a class="markdownIt-Anchor" href="#nan-处理-填充"></a> NAN 处理 / 填充</h2>
<p><strong>查找 nan：</strong></p>
<ul>
<li><code>.isnull()/notnull()</code>：如果值为NaN，返回 True/False，否则返回 False/True ， 返回结果为同一个 size 的 df。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看每一列是否有NaN：</span><br><span class="line">df.isnull().any(axis=0)</span><br><span class="line"># 查看每一行是否有NaN：</span><br><span class="line">df.isnull().any(axis=1)</span><br><span class="line"># 查看所有数据中是否有NaN最快的：</span><br><span class="line">df.isnull().values.any()</span><br><span class="line"># 查看哪些列有 nan</span><br><span class="line">columns_with_nan = df.columns[df.isnull().any()]</span><br><span class="line"># 查找包含NaN值的行</span><br><span class="line">rows_with_nan = df[df.isnull().any(axis=1)]</span><br></pre></td></tr></table></figure>
<p><strong>填充 null</strong></p>
<ul>
<li>
<p><code>.dropna()</code>：返回删除所有缺失值的Series对象，并返回 df</p>
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125; default 0</code>： 0 按行删除 ；1 按列删除</li>
<li><code>how : &#123;‘any’, ‘all’&#125;, default ‘any’</code>：只要有一个 nan，就删除 ；还是全部为 nan 才删除</li>
<li><code>ignore_index : bool, default False</code>：删除后是否重新更新 index 索引</li>
</ul>
</li>
<li>
<p><code>.fillna(参数)</code>：填充NaN并返回，参数为填充值。</p>
<ul>
<li>根据每一列均值来填充 : <code>df.fillna(df.mean(), inplace=True)</code></li>
</ul>
</li>
<li>
<p><code>df.bfill(axis='rows')</code></p>
<ul>
<li><code>axis='index'</code> 或 <code>axis=0</code>（默认值）:  使用下一行数据进行填充</li>
<li><code>axis= axis='columns' </code>或<code> axis=1</code>: 使用下一列数据进行填充<br />
如果下一行或者下一列也是 None，就向后找，直到找到非空，然后全部填充，如果找不到，那就还是 Nan</li>
</ul>
</li>
<li>
<p><code>df.ffill()</code> ，参考前面，这个是使用前面的数据进行填充</p>
</li>
</ul>
<h2 id="一些方法"><a class="markdownIt-Anchor" href="#一些方法"></a> 一些方法</h2>
<ul>
<li>
<p><code>DataFrame.rolling(window, min_periods=None, center=False, win_type=None, on=None, axis=_NoDefault.no_default, closed=None, step=None, method='single')</code></p>
<ul>
<li><code>window : int, timedelta, str, offset, or BaseIndexer subclass</code>：选择 rolling window 的大小<br />
最常用的是 <code>offset : int</code>：，示选择自己和前面一共 offset 个数字 。<br />
当索引是时间类型 <code>pd.Timestamp</code> ，可以使用如 <code>2s</code> 来选定包含自己的一段时间。但是需要保证时间索引是对的，即没有进行随机排列，所以在之前可以进行 <code>df.sort_index()</code> ，先排序。</li>
<li><code>min_periods : int: default None</code>：Minimum number of observations in window required to have a value; otherwise, result is np.nan.</li>
<li><code>center : bool, default False</code>：默认向右进行划窗，可以选择进行左右两边划窗。</li>
<li><code>on</code>：用于多级索引的情况，以指定在哪个级别上执行滚动操作。</li>
<li>通常是后面跟一个函数来进行 agg 运算，比如 <code>df.rolling(2).sum()</code> 。实际是先 rolling，划分为多个组，然后进行操作，最后赋值，所以可以有：<code>lambda x: np.fabs(x - x.mean()).mean()</code> 。</li>
</ul>
</li>
<li>
<p>切分数组：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_splits = <span class="number">20</span></span><br><span class="line">df_splits = np.array_split(df, num_splits)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>pandas.concat()</code>：可以将数据根据不同的轴作简单的拼接</p>
<ul>
<li><code>a sequence or mapping of Series or DataFrame objects</code></li>
<li><code>axis : &#123;0/’index’, 1/’columns’&#125;, default 0</code>： 需要合并链接的轴，0是行，1是列，默认按行合并</li>
<li><code>join : &#123;‘inner’, ‘outer’&#125;, default 'outer'</code>：连接方式 inner 表示删除不重合的列 ；</li>
<li><code>ignore_index = Flase</code> ：按行拼接后是否重新整理 index</li>
</ul>
</li>
<li>
<p><code>shift()</code>方法，用来偏移元素<br />
参数：<br />
1. periods: 偏移量<br />
2. frep: DateOffset, timedelta, or time rule string，可选参数，默认值为None，只适用于时间序列，如果这个参数存在，那么会按照参数值移动时间索引，而数据值没有发生变化。<br />
3. axis:指定要移位的行或列，0为行，1为列<br />
4. fill_value:指定移位后的填充值，fill_value=0，即表示移位后缺失值填充为0<br />
可以用该方法对单行/列进行操作<br />
可以用该方法来去除重复行</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;&#x27;A&#x27;: [1, 2, 2, 3, 4, 5, 5, 5, 6, 7, 7]&#125;)</span><br><span class="line">df1 = df.loc[df[&#x27;A&#x27;].shift() != df[&#x27;A&#x27;]]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   A</span><br><span class="line">0  1</span><br><span class="line">1  2</span><br><span class="line">3  3</span><br><span class="line">4  4</span><br><span class="line">5  5</span><br><span class="line">8  6</span><br><span class="line">9  7</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>df.diff()</code>: 当前行减去上一行的值<br />
或者 <code>df['diff'] = df['value'] - df['value'].shift(1)</code></p>
</li>
<li>
<p>随机抽样方法</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.sample( n=None, frac=None, replace=False,</span><br><span class="line">                  weights=None, random_state=None, axis=None)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>n: int</code>：用来指定随机抽取的样本数目（行数目）或者列数目，默认随机抽取行数据。<br />
不指定<code>n</code>，也不指定<code>frac</code>时，默认随机抽取一行数据。</li>
<li><code>frac: float</code>：指定随机抽取行或列的比例</li>
<li><code>replace: bool</code>：有放回抽样还是无放回抽样。当 <code>frac&gt;1</code> 的浮点数或者参数 <code>n&gt;样本数目</code> ，需要指定<code>replace=True</code>。</li>
<li><code>weights: str or Series</code>：默认为<code>None</code>，即执行等概率抽样。
<ul>
<li><code>str</code>类型，要求是DataFrame中的一个列名，pandas将str这个列的取值作为该行数据的抽样权重进行抽样。<br />
如果列中数据相加和不等于1，该列数据将被标准化到和为1。列中如果有缺失值，该行数据的抽样权重被视为0。此外这个列中不允许无限值。</li>
<li><code>Series</code>类型，<code>Series</code>的长度可以和数据中行或列的长度不同。<br />
<code>pandas</code>会先进行索引对齐，相当于对<code>DataFrame</code>和<code>Series</code>做一个左连接。<code>DataFrame</code>中没有匹配到的索引对应的行抽样权重为0。</li>
</ul>
</li>
<li><code>random_state: int</code>：用于复现抽样结果</li>
<li><code>axis: int/str</code>：当axis指定为0或者’index’时，对行进行抽样，当axis指定为1或者’col’时，对列进行抽样。默认执行的是行抽样。</li>
</ul>
</li>
</ul>
<h3 id="groupby-聚合方法"><a class="markdownIt-Anchor" href="#groupby-聚合方法"></a> groupby 聚合方法</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lemonbit/p/6810972.html">https://www.cnblogs.com/lemonbit/p/6810972.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   A  B    C</span><br><span class="line">0  a  2  102</span><br><span class="line">1  b  8   98</span><br><span class="line">2  a  1  107</span><br><span class="line">3  c  4  104</span><br><span class="line">4  a  3  115</span><br><span class="line">5  c  2   87</span><br><span class="line">6  b  5   92</span><br><span class="line">7  c  9  123</span><br></pre></td></tr></table></figure>
<ul>
<li>按A列分组（groupby），获取其他列的均值：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(&#x27;A&#x27;).mean()</span><br></pre></td></tr></table></figure>
<ul>
<li>按多列进行分组（groupby）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df.groupby([&#x27;A&#x27;,&#x27;B&#x27;]).mean()</span><br><span class="line"></span><br><span class="line">Out[4]:</span><br><span class="line">       C</span><br><span class="line">A B</span><br><span class="line">a 1  107</span><br><span class="line">  2  102</span><br><span class="line">  3  115</span><br><span class="line">b 5   92</span><br><span class="line">  8   98</span><br><span class="line">c 2   87</span><br><span class="line">  4  104</span><br><span class="line">  9  123</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>分组后选择列进行运算</p>
<ul>
<li>仅选择B列，在 <code>groupby()</code>函数后面加个索引即可:</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">g = df.groupby(&quot;A&quot;)</span><br><span class="line">g[&#x27;B&#x27;].mean() # 仅选择B列</span><br><span class="line"></span><br><span class="line">Out[7]:</span><br><span class="line">A</span><br><span class="line">1    1.5</span><br><span class="line">2    3.0</span><br><span class="line">Name: B, dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li>选择B、C多列</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g[[&#x27;B&#x27;, &#x27;C&#x27;]].mean() # 选择B、C列</span><br></pre></td></tr></table></figure>
<ul>
<li>可以针对不同的列选用不同的聚合方法</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g.agg(&#123;&#x27;B&#x27;:&#x27;mean&#x27;, &#x27;C&#x27;:&#x27;sum&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">Out[9]:</span><br><span class="line">   B   C</span><br><span class="line">A</span><br><span class="line">1  1.5  5</span><br><span class="line">2  3.0  4</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>聚合方法</p>
<ul>
<li><code>count()</code>：nan 不会被计入</li>
<li><code>size()</code>：nan 也会被计入</li>
</ul>
</li>
<li>
<p>分组运算方法 <code>agg()</code></p>
<ul>
<li><code>agg(list)</code> 将属于同一个 group 的所有元素全部整合到一个 list 中</li>
<li><code>agg([&quot;count&quot;]).apply('list')</code></li>
<li><code>agg([&quot;max&quot;]).apply('list')</code></li>
<li><code>.groupby(by=[&quot;id_map&quot;]).hour.std()</code> group之后，选择hour列，然后计算标准差</li>
</ul>
</li>
<li>
<p><code>groupby</code>方法返回的是一个 <code>Series</code> ，无法直接输出。<br />
相当于 <code>groupby</code> 的标准列成为了索引，那么问题就转成了，索引能不能转换为数据？<br />
直接重索引即可：<code>df.reset_index()</code>，例子：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">avg_aqi.head()</span><br><span class="line">Country  Year  Month</span><br><span class="line">Albania  2022  7        32.937500</span><br><span class="line">               8        30.687500</span><br><span class="line">               9        15.565217</span><br><span class="line">         2023  1         9.000000</span><br><span class="line">Algeria  2022  7        65.000000</span><br><span class="line">Name: AQI Value, dtype: float64</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>Country  Year  Month</code> 成了索引，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">avg_aqi.reset_index().head()</span><br><span class="line">   Country  Year  Month  AQI Value</span><br><span class="line">0  Albania  2022      7  32.937500</span><br><span class="line">1  Albania  2022      8  30.687500</span><br><span class="line">2  Albania  2022      9  15.565217</span><br><span class="line">3  Albania  2023      1   9.000000</span><br><span class="line">4  Algeria  2022      7  65.000000</span><br></pre></td></tr></table></figure>
<p>直接重新索引即可</p>
<h3 id="reset_index-和-set_index"><a class="markdownIt-Anchor" href="#reset_index-和-set_index"></a> reset_index() 和 set_index()</h3>
<p>出于增强数据可读性或其他原因，我们需要对数据表的<strong>索引值</strong>进行设定。</p>
<ul>
<li>set_index</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.set_index(keys, drop=True, append=False, inplace=False, verify_integrity=False)</span><br></pre></td></tr></table></figure>
<ul>
<li>keys：列标签:str ； 或 列标签列表，创建多列索引。</li>
<li>drop：默认为True，删除用作新索引的列</li>
<li>append：是否将列附加到现有索引，默认为False。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df</span><br><span class="line">   Country  Income  Age</span><br><span class="line">0    China   10000   50</span><br><span class="line">1    China   10000   43</span><br><span class="line">2    India    5000   34</span><br><span class="line">3    India    5002   40</span><br><span class="line">4  America   40000   25</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df.set_index([&quot;Age&quot; , &quot;Income&quot;])</span><br><span class="line">            Country</span><br><span class="line">Age Income</span><br><span class="line">50  10000     China</span><br><span class="line">43  10000     China</span><br><span class="line">34  5000      India</span><br><span class="line">40  5002      India</span><br><span class="line">25  40000   America</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df.set_index(&quot;Age&quot;)</span><br><span class="line">     Country  Income</span><br><span class="line">Age</span><br><span class="line">50     China   10000</span><br><span class="line">43     China   10000</span><br><span class="line">34     India    5000</span><br><span class="line">40     India    5002</span><br><span class="line">25   America   40000</span><br><span class="line"></span><br><span class="line"># 仍然保留索引列</span><br><span class="line">&gt;&gt;&gt; df.set_index(&quot;Age&quot;, drop=False)</span><br><span class="line">     Country  Income  Age</span><br><span class="line">Age</span><br><span class="line">50     China   10000   50</span><br><span class="line">43     China   10000   43</span><br><span class="line">34     India    5000   34</span><br><span class="line">40     India    5002   40</span><br><span class="line">25   America   40000   25</span><br></pre></td></tr></table></figure>
<h3 id="拆分行合并行"><a class="markdownIt-Anchor" href="#拆分行合并行"></a> 拆分行/合并行</h3>
<h4 id="explode"><a class="markdownIt-Anchor" href="#explode"></a> explode()</h4>
<p>当 dataframe 中某一行其中一个元素是列表形式，即<strong>多个同类型的数据</strong>，若想要展开成多行进行分析，可以使用该函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.explode(self, column: Union[str, Tuple])</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df1</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c   [2, 3, 8]    1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df1.explode(&#x27;measurement&#x27;)</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c           2    1</span><br><span class="line">2  c           3    1</span><br><span class="line">2  c           8    1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df1.explode(&#x27;measurement&#x27;).reset_index(drop=True)</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c           2    1</span><br><span class="line">3  c           3    1</span><br><span class="line">4  c           8    1</span><br></pre></td></tr></table></figure>
<h2 id="内存优化"><a class="markdownIt-Anchor" href="#内存优化"></a> 内存优化</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line"><span class="comment"># inspired by https://www.kaggle.com/code/renatoreggiani/reduce-memory-usage-zzzs-cmi</span></span><br><span class="line"><span class="comment"># with tweaks determined by the selected polars loading strategy</span></span><br><span class="line"><span class="comment"># tweaks inspired by https://github.com/softhints/Pandas-Tutorials/blob/master/column/3.check-dtype-column-columns-pandas-dataframe.ipynb</span></span><br><span class="line"><span class="keyword">from</span> pandas.api.types <span class="keyword">import</span> is_datetime64_ns_dtype</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reduce_mem_usage</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; iterate through all numeric columns of a dataframe and modify the data type</span></span><br><span class="line"><span class="string">        to reduce memory usage.        </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    start_mem = df.memory_usage().<span class="built_in">sum</span>() / <span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Memory usage of dataframe is <span class="subst">&#123;start_mem:<span class="number">.2</span>f&#125;</span> MB&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">        col_type = df[col].dtype</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> col_type != <span class="built_in">object</span> <span class="keyword">and</span> <span class="keyword">not</span> is_datetime64_ns_dtype(df[col]):</span><br><span class="line">            c_min = df[col].<span class="built_in">min</span>()</span><br><span class="line">            c_max = df[col].<span class="built_in">max</span>()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">str</span>(col_type)[:<span class="number">3</span>] == <span class="string">&#x27;int&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> c_min &gt; np.iinfo(np.int8).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int8).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int8)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int16).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int16).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int16)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int32).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int32).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int32)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int64).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int64).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int64)  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> c_min &gt; np.finfo(np.float16).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.finfo(np.float16).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float16)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.finfo(np.float32).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.finfo(np.float32).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float32)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float16)</span><br><span class="line"></span><br><span class="line">    end_mem = df.memory_usage().<span class="built_in">sum</span>() / <span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Memory usage after optimization is: <span class="subst">&#123;end_mem:<span class="number">.2</span>f&#125;</span> MB&#x27;</span>)</span><br><span class="line">    decrease = <span class="number">100</span> * (start_mem - end_mem) / start_mem</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Decreased by <span class="subst">&#123;decrease:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">train_series = reduce_mem_usage(train_series)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mts = dict(zip(range(1,13), [month%12 // 3 + 1 for month in range(1, 13)]))</span><br><span class="line">target[&#x27;season&#x27;] = target.timestamp.dt.month.map(mts) </span><br><span class="line"></span><br><span class="line"># 1 -&gt; winter</span><br><span class="line"># 2 -&gt; spring</span><br><span class="line"># 3 -&gt; summer</span><br><span class="line"># 4 -&gt; fall</span><br><span class="line"></span><br><span class="line">target[&#x27;dayofweek&#x27;] = target.timestamp.dt.dayofweek</span><br><span class="line">target[&#x27;weekend&#x27;] = target.timestamp.dt.dayofweek &gt; 4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="others"><a class="markdownIt-Anchor" href="#others"></a> Others</h2>
<h3 id="pandas-文件处理"><a class="markdownIt-Anchor" href="#pandas-文件处理"></a> pandas 文件处理</h3>
<p>注意一些方法即可：</p>
<ol>
<li><code> pd.read_csv(文件名)</code>：默认分隔符为逗号</li>
</ol>
<p>参数：</p>
<ul>
<li><code>nrows</code>：需要读取的行数，从前向后</li>
<li><code>skiprows : int, list of int or Callable, optional</code>：需要跳过的行数</li>
<li><code>header</code> ： 通过设置 <code>header=None</code> 可以从第一行开始读取，后续通过 <code>df.columns = [col1, col2 ,...]</code> 来设置 columns 。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">my_csv = pd.read_csv(&quot;test.csv&quot;);</span><br><span class="line">print(my_csv)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">  Unnamed: 0  one  two</span><br><span class="line">0          a  1.0    2</span><br><span class="line">1          b  2.0    1</span><br><span class="line">2          c  3.0    3</span><br><span class="line">3          d  NaN    4</span><br></pre></td></tr></table></figure>
<ul>
<li>会出现Unnamed，这是因为他把行索引当成了单独的一列。可以用利用参数<code>index_col=0</code>将第0列作为索引。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(pd.read_csv(&quot;test.csv&quot;, index_col=0))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a  1.0    2</span><br><span class="line">b  2.0    1</span><br><span class="line">c  3.0    3</span><br><span class="line">d  NaN    4</span><br></pre></td></tr></table></figure>
<ul>
<li>除此之外，<code>index_col</code>也可以传入列名称，将某列设置为索引。</li>
<li>使用<code>parse_dates = [列表名]</code>，将该列元素解析为datetime对象。</li>
<li>如果文件没有第一行，<code>header=None, names=[列的名称]</code></li>
<li>注意在识别中，会令一整列都识别为同一种类型。在csv中，NaN可以被识别为浮点数，但是none或者其他数值会被识别为字符串形式。使用<code>na_values=[]</code>参数来指定列表中的某些数值被识别为NaN。</li>
</ul>
<ol start="2">
<li><code>pd.read_table(文件名)</code>：默认分隔符为制表符</li>
<li><code>dataFrame.to_csv(文件名)</code>：写入到文件<br />
参数：
<ul>
<li><code>sep</code> 指定的文件分隔符号，默认为逗号</li>
<li><code>na_rep</code> 缺失值转换的字符串，默认为空字符串</li>
<li><code>header = False</code> 不输出列名称一行</li>
<li><code>index = False</code> 不输出行索引一列</li>
<li><code>cols/columns</code> 指定输出的列，传入列表</li>
</ul>
</li>
</ol>
<h3 id="警告-settingwithcopywarning"><a class="markdownIt-Anchor" href="#警告-settingwithcopywarning"></a> 警告 SettingWithCopyWarning</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SettingWithCopyWarning:</span><br><span class="line">A value is trying to be set on a copy of a slice from a DataFrame</span><br></pre></td></tr></table></figure>
<p>后果是可能导致<strong>修改pandas 单元格中的数据失败</strong>。</p>
<p>原理：当前操作的dataframe是从其他dataframe得到的，不是最初始的dataframe。因此，最好是在原始的dataframe上进行操作，这样就不报警告了。</p>
<p>Pandas 中的某些操作可以返回：</p>
<ul>
<li>数据的视图（View），即一份拷贝对象，共享数据地址，</li>
<li>数据的副本（Copy），即重新创建了一个不同的地址的新对象</li>
</ul>
<p>当 Pandas 检测链式赋值（Chained assignment）时会生成警告，让我们定义一些术语，方便后续的解释：</p>
<ul>
<li>赋值（Assignment） - 设置/更改某些变量值的操作，也被称为设置（set） 。</li>
<li>访问（Access） - 返回某些值的操作，例如下面的索引和链式索引示例。也被称为获取（get） 。</li>
<li>索引（Indexing） - 引用数据子集的任何赋值或访问方法，例如 data[1:5] 。</li>
<li>链式索引（Chaining） - 连续使用多个索引操作，例如data[1:5][1:3] 。</li>
</ul>
<br>
<p>链式赋值（Chained assignment） 是指<strong>链式索引和赋值的组合</strong>，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.bidder == &#x27;parakeet2004&#x27;][&#x27;bidderrate&#x27;] = 100</span><br></pre></td></tr></table></figure>
<p>如果检查一下，可以看到在这种情况下，值没有按预期改变。</p>
<p>是因为这个操作首先进行了索引，然后进行了赋值，但是没有在原始 DataFrame 上运行。</p>
<p>我们可以使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data.bidder == &#x27;parakeet2004&#x27;, &#x27;bidderrate&#x27;] = 100</span><br></pre></td></tr></table></figure>
<p>下面看另一种情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winners = data.loc[data.bid == data.price]</span><br><span class="line">winners.loc[304, &#x27;bidder&#x27;] = &#x27;therealname&#x27;</span><br></pre></td></tr></table></figure>
<p>代码按预期工作了，还是爆出警告，SettingWithCopyWarning！但我们使用了 <code>loc</code> 呀，</p>
<p>因为 winners 是作为 get 操作的输出创建的（data.loc[data.bid == data.price]），它可能是原始 DataFrame 的副本，也可能不是，但除非我们检查，否则我们不能了解到。当我们对 winners 进行索引时，我们实际上使用的是链式索引。</p>
<p>为了防止这种情况下的警告，解决方案是在创建新 DataFrame 时明确告知 Pandas 制作一个副本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winners = data.loc[data.bid == data.price].copy()</span><br><span class="line">winners.loc[304, &#x27;bidder&#x27;] = &#x27;therealname&#x27;</span><br></pre></td></tr></table></figure>
<p>所以，解决方法：</p>
<ol>
<li>如果要更改原始数据，请使用单一赋值操作。</li>
<li>如果你想要一个副本，请确保你强制让 Pandas 制作副本。</li>
</ol>
<br>
<p>定位：<br />
在代码的开头加上这两句，将警告升级为error，就会定位到出warning的地方啦：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import warnings</span><br><span class="line">warnings.filterwarnings(&#x27;error&#x27;)</span><br></pre></td></tr></table></figure>
<p>完整内容：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42575020/article/details/98846427">https://blog.csdn.net/weixin_42575020/article/details/98846427</a></p>
<h3 id="数据可视化"><a class="markdownIt-Anchor" href="#数据可视化"></a> 数据可视化</h3>
<p>draw correlation</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(50, 50))</span><br><span class="line">corr = df_imputed.corr()</span><br><span class="line">sns.heatmap(corr, cmap=&quot;YlGnBu&quot;, annot=True)</span><br><span class="line">plt.title(&#x27;Correlation Heatmap&#x27;, fontsize=30)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>box plot</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(20, 9))</span><br><span class="line">df[idxs].boxplot()</span><br><span class="line">plt.title(&#x27;Box Plot&#x27;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Python/functools%E5%B7%A5%E5%85%B7%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Python/functools%E5%B7%A5%E5%85%B7%E5%8C%85/" class="post-title-link" itemprop="url">functools工具包</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>146</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaobingqianrui/p/8606410.html">Python之functools库</a></p>
<p>用途：操作其他函数的函数。</p>
<h1 id="partial"><a class="markdownIt-Anchor" href="#partial"></a> partial</h1>
<p>当一个函数有很多参数，但是其中一部分参数的值在每次调用时都是一样的，这时可以使<code>partial</code>类对其封装，来预先设定/冻结这些参数的值。<br />
有点像动态地设置函数的形式参数的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from functools import partial</span><br><span class="line">def fun(arg1, arg2,arg3,arg4):</span><br><span class="line">    return arg1+arg2+arg3+arg4</span><br><span class="line"></span><br><span class="line"># 如果参数arg1, arg2, arg3 一直保持不变，可以使用</span><br><span class="line"># 使用partial对象将这些不变的参数冻结起来</span><br><span class="line">nochangeparm = partial(fun,1,2,3)</span><br><span class="line">print (nochangeparm(4))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 10</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/34/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><span class="page-number current">35</span><a class="page-number" href="/page/36/">36</a><a class="page-number" href="/page/37/">37</a><a class="extend next" rel="next" href="/page/36/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">A foolish, slow learner.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">361</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/YiandLi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;YiandLi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/yiliiiii" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yiliiiii" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">620k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">51:42</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
