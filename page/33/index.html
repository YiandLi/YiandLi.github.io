<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":20,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="A foolish, slow learner.">
<meta property="og:type" content="website">
<meta property="og:title" content="Yili">
<meta property="og:url" content="http://example.com/page/33/index.html">
<meta property="og:site_name" content="Yili">
<meta property="og:description" content="A foolish, slow learner.">
<meta property="og:locale">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/33/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Yili</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yili</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Suggest Google Chrome for better math Reading.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/03/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/CQL%20%E8%AF%AD%E8%A8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/03/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/CQL%20%E8%AF%AD%E8%A8%80/" class="post-title-link" itemprop="url">CQL 语言</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-03 18:41:24" itemprop="dateCreated datePublished" datetime="2021-03-03T18:41:24-08:00">2021-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge-Graph/" itemprop="url" rel="index"><span itemprop="name">Knowledge Graph</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>文档：<a target="_blank" rel="noopener" href="https://neo4j.com/docs/cypher-manual/current/clauses/">https://neo4j.com/docs/cypher-manual/current/clauses/</a></p>
<p>A Cypher query part can either read and match on the graph, or make updates on it, <strong>not both simultaneously.</strong></p>
<p>When performing <strong>Reading</strong> performance, Cypher will <strong>not match</strong> the pattern <strong>until</strong> you ask for the results.</p>
<p>In an updating query, all the <strong>reading</strong> will be <strong>firstly</strong> done totally, followed by all the <strong>writing</strong> performance.</p>
<p>These parts are separated by the statement <code>WITH</code>.<br />
<code>WITH</code> is like an event horizon — it’s <strong>a barrier</strong> between <strong>a plan</strong> and <strong>the finished execution</strong> of that plan.</p>
<p>Using <code>WITH</code>, you specify how you want the aggregation to happen, and that the aggregation has to be finished before Cypher can start filtering.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n &#123;name: &#x27;John&#x27;&#125;)-[:FRIEND]-(friend)</span><br><span class="line">WITH n, count(friend) AS friendsCount</span><br><span class="line">WHERE friendsCount &gt; 3</span><br><span class="line">RETURN n, friendsCount</span><br></pre></td></tr></table></figure>
<h2 id="introduction-to-cypher"><a class="markdownIt-Anchor" href="#introduction-to-cypher"></a> Introduction to Cypher</h2>
<ul>
<li>Basic mode:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(nodes)-[:ARE_CONNECTED_TO]-&gt;(otherNodes)</span><br></pre></td></tr></table></figure>
<ul>
<li>rounded brackets <code>(nodes)</code> to include the node</li>
<li>arrow <code>-[:ARE_CONNECTED_TO]-&gt;</code> to declare the relationship</li>
</ul>
</li>
</ul>
<h3 id="nodes"><a class="markdownIt-Anchor" href="#nodes"></a> Nodes</h3>
<ul>
<li><strong>Nodes</strong> and <strong>relationships</strong> are the simple components of the <strong>pattern</strong>, which are the most valuable and powerful piece of the property graph model.</li>
</ul>
<br>
<ul>
<li>
<p>Cypher comments: <code>//</code></p>
</li>
<li>
<p>could use the nickname for a node like <code>(p)</code> for a person</p>
</li>
<li>
<p>also could use <code>()</code> for an anonymous node. This means that you are not be able to return this node later in the query.</p>
</li>
<li>
<p>assigning a node label, e.g. Person, Technology, and Company.<br />
It is like a class, and it likes we are telling the Cypher to only check those labels for that label.<br />
This helps Cypher distinguish between entities and optimize execution for your queries. It is always better to use node labels in your queries, where possible.</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">()                  //anonymous node (no label or variable) can refer to any node in the database</span><br><span class="line">(p:Person)          //using variable p and label Person</span><br><span class="line">(:Technology)       //no variable, label Technology</span><br><span class="line">(work:Company)      //using variable work and label Company</span><br></pre></td></tr></table></figure>
<h3 id="relationships"><a class="markdownIt-Anchor" href="#relationships"></a> Relationships</h3>
<p>Directed relationships: <code>--&gt;</code>or <code>&lt;--</code> between two nodes<br />
Undirected relationships: <code>--</code> between two nodes</p>
<p>Additional information, such as <strong>relationship type</strong> and <strong>relationship properties</strong> could be added.</p>
<p>When using un-directional relationships <code>--</code> for query, Cypher would <strong>ignores any particular direction</strong> and <strong>retrieves the relationship and connected nodes</strong>, no matter what the physical direction is.<br />
In this case, user needn’t know the specific relationship.</p>
<p>But when using directional relationships <code>--&gt; / &lt;--</code> for query. The wrong direction will not return any results.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//data stored with this direction</span><br><span class="line">CREATE (p:Person)-[:LIKES]-&gt;(t:Technology)</span><br><span class="line"></span><br><span class="line">//query relationship backwards will not return results</span><br><span class="line">MATCH (p:Person)&lt;-[:LIKES]-(t:Technology)</span><br><span class="line"></span><br><span class="line">//better to query with undirected relationship unless sure of direction</span><br><span class="line">MATCH (p:Person)-[:LIKES]-(t:Technology)</span><br></pre></td></tr></table></figure>
<h3 id="node-or-relationship-properties"><a class="markdownIt-Anchor" href="#node-or-relationship-properties"></a> Node or relationship properties</h3>
<p>properties are <code>name-value</code> pairs</p>
<p>Node property: <code>(p:Person &#123;name: 'Sally'&#125;)</code><br />
Relationship property: <code>-[rel:IS_FRIENDS_WITH &#123;since: 2018&#125;]-&gt;</code></p>
<h3 id="patterns-in-cypher"><a class="markdownIt-Anchor" href="#patterns-in-cypher"></a> Patterns in Cypher</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(p:Person &#123;name: &quot;Sally&quot;&#125;)-[rel:LIKES]-&gt;(g:Technology &#123;type: &quot;Graphs&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="patterns"><a class="markdownIt-Anchor" href="#patterns"></a> Patterns</h2>
<h3 id="node-syntax"><a class="markdownIt-Anchor" href="#node-syntax"></a> Node syntax</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">() // an anonymous, uncharacterized node</span><br><span class="line">(matrix) // every node with a variable</span><br><span class="line">(:Movie) // every node with a type/label</span><br><span class="line">(matrix:Movie)</span><br><span class="line">(matrix:Movie &#123;title: &#x27;The Matrix&#x27;&#125;) // every node with a property</span><br><span class="line">(matrix:Movie &#123;title: &#x27;The Matrix&#x27;, released: 1997&#125;)</span><br></pre></td></tr></table></figure>
<p>For the Type name, we are used to assign an all-upper-format; and if there is space, we use to use <code>_</code> in place of the blank.<br />
For the property value, if it is a char type, we should use quotation marks <code>' / &quot;</code> around it.</p>
<h3 id="relationship-syntax"><a class="markdownIt-Anchor" href="#relationship-syntax"></a> Relationship syntax</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--&gt;</span><br><span class="line">-[role]-&gt;  // variable</span><br><span class="line">-[:ACTED_IN]-&gt; // type/label</span><br><span class="line">-[role:ACTED_IN]-&gt;</span><br><span class="line">-[role:ACTED_IN &#123;roles: [&#x27;Neo&#x27;]&#125;]-&gt;</span><br></pre></td></tr></table></figure>
<h3 id="pattern-syntax"><a class="markdownIt-Anchor" href="#pattern-syntax"></a> Pattern syntax</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(keanu:Person:Actor &#123;name: &#x27;Keanu Reeves&#x27;&#125;)</span><br><span class="line">    -[role:ACTED_IN &#123;roles: [&#x27;Neo&#x27;]&#125;]-&gt;</span><br><span class="line">    (matrix:Movie &#123;title: &#x27;The Matrix&#x27;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="pattern-variables"><a class="markdownIt-Anchor" href="#pattern-variables"></a> Pattern variables</h3>
<p>Cypher allows patterns to be assigned to variables.<br />
This allows the matching paths to be inspected, used in other expressions.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acted_in = (:Person)-[:ACTED_IN]-&gt;(:Movie)</span><br></pre></td></tr></table></figure>
<p>Then, this variable would contain the matched paths (2 nodes and 1 relationship).<br />
Later we could use a number of functions to access details of a path, like <code>nodes(path)</code>, <code>relationships(path)</code>, and <code>length(path)</code>.</p>
<h3 id="clauses"><a class="markdownIt-Anchor" href="#clauses"></a> Clauses</h3>
<p>There are multiple clauses, each performs a specific task.<br />
like:</p>
<ul>
<li>create and match patterns in the graph</li>
<li>filter, project, sort, or paginate results</li>
<li>compose partial statements</li>
</ul>
<h2 id="patterns-in-practice"><a class="markdownIt-Anchor" href="#patterns-in-practice"></a> Patterns in practice</h2>
<h3 id="creating-and-returning-data"><a class="markdownIt-Anchor" href="#creating-and-returning-data"></a> Creating and Returning data</h3>
<h4 id="create"><a class="markdownIt-Anchor" href="#create"></a> CREATE</h4>
<p>The simplest clause is called <code>CREATE</code>. It creates the patterns (nodes and relationship) that you specify.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE (:Movie &#123;title: &#x27;The Matrix&#x27;, released: 1997&#125;)</span><br></pre></td></tr></table></figure>
<p>After running this statement, Cypher returns <strong>the number of changes</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Created Nodes: 1</span><br><span class="line">Added Labels: 1</span><br><span class="line">Set Properties: 2</span><br><span class="line">Rows: 0</span><br></pre></td></tr></table></figure>
<h3 id="return"><a class="markdownIt-Anchor" href="#return"></a> RETURN</h3>
<p>to return the created data</p>
<p>The <code>RETURN</code> clause in Cypher specifies <strong>what values or results</strong> to return from a Cypher query:</p>
<ul>
<li>node</li>
<li>relationships</li>
<li>node and relationship properties</li>
<li>patterns</li>
</ul>
<p><code>RETURN</code> is not required when doing write procedures, but <strong>is needed for reads</strong>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE (a:Person &#123;name: &#x27;Tom Hanks&#x27;, born: 1956&#125;)-[r:ACTED_IN &#123;roles: [&#x27;Forrest&#x27;]&#125;]-&gt;(m:Movie &#123;title: &#x27;Forrest Gump&#x27;, released: 1994&#125;)</span><br><span class="line">CREATE (d:Person &#123;name: &#x27;Robert Zemeckis&#x27;, born: 1951&#125;)-[:DIRECTED]-&gt;(m)</span><br><span class="line">RETURN a, d, r, m</span><br></pre></td></tr></table></figure>
<h3 id="matching-patterns"><a class="markdownIt-Anchor" href="#matching-patterns"></a> Matching patterns</h3>
<p>assign the pattern to <code>MATCH</code> to describe what you are looking for.</p>
<p>A <code>MATCH</code> statement searches for the patterns you specify and return one row per successful pattern match.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// all nodes labeled with the Movie label.</span><br><span class="line">MATCH (m:Movie)</span><br><span class="line">RETURN m</span><br><span class="line"></span><br><span class="line">// look for a specific person, like Keanu Reeves.</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;Keanu Reeves&#x27;&#125;)</span><br><span class="line">RETURN p</span><br><span class="line"></span><br><span class="line">// the movies&#x27; titles that Tom Hanks acted in and roles he played.</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;Tom Hanks&#x27;&#125;)-[r:ACTED_IN]-&gt;(m:Movie)</span><br><span class="line">RETURN m.title, r.roles</span><br></pre></td></tr></table></figure>
<h3 id="aliasing-return-values"><a class="markdownIt-Anchor" href="#aliasing-return-values"></a> Aliasing return values</h3>
<p>Sometimes the return name or property is complex, so we could also alias the property with a cleaner name using <code>AS</code> at the <code>RETURN</code> line.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (tom:Person &#123;name:&#x27;Tom Hanks&#x27;&#125;)-[rel:DIRECTED]-(movie:Movie)</span><br><span class="line">RETURN tom.name AS name, tom.born AS `Year Born`, movie.title AS title, movie.released AS `Year Released`</span><br></pre></td></tr></table></figure>
<p>If there is a space in the nickname, we should use the backtick character `.<br />
And if there is a space in in the Type name, or property value, we could use <code>''</code>.</p>
<h2 id="attaching-structure"><a class="markdownIt-Anchor" href="#attaching-structure"></a> Attaching structure</h2>
<p>extend the graph based on some existing nodes:</p>
<ol>
<li>first <code>MATCH</code> the existing connection points</li>
<li>attach the newly created nodes with relationships using <code>CREATE</code></li>
</ol>
<p>It is also possible to <code>CREATE</code> a node and a relationship simultaneously, but we’d better <code>CREATE</code> one by one for better readability.</p>
<blockquote>
<p>If the <code>MATCH</code> command return many rows, we could move <code>CREATE</code> before the <code>MATCH</code> line, so that it needn’t create new node for each line.</p>
</blockquote>
<h2 id="completing-patterns"><a class="markdownIt-Anchor" href="#completing-patterns"></a> Completing patterns</h2>
<p>Sometimes when we do <code>CREATE</code> command, we are not sure whether the node/relationship has existed.</p>
<p>In this case, we could use <code>MERGE</code> command to express a repeatable update operation.</p>
<p>It would check for the existence of the data before <code>CREATE</code>. Also we could <strong>add</strong> some properties using the <code>ON CREATE</code>.<br />
But <code>ON CREATE SET</code> <strong>could only add a property</strong>, if the property has existed, <strong>no changing</strong> would be performed.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MERGE (m:Movie &#123;title: &#x27;Cloud Atlas&#x27;&#125;)</span><br><span class="line">ON CREATE SET m.released = 2012</span><br><span class="line">RETURN m</span><br></pre></td></tr></table></figure>
<p>It comes with large cost check for existing matches first, especially on large graphs. So if we are sure to <strong>not create duplicate</strong> data use <code>CREATE</code> over <code>MERGE</code>.</p>
<p>Also, <code>MERGE</code> works for relationships:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie &#123;title: &#x27;Cloud Atlas&#x27;&#125;)</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;Tom Hanks&#x27;&#125;)</span><br><span class="line">MERGE (p)-[r:ACTED_IN]-&gt;(m)</span><br><span class="line">ON CREATE SET r.roles =[&#x27;Zachry&#x27;]</span><br><span class="line">RETURN p, r, m</span><br></pre></td></tr></table></figure>
<p>if the relationship direction is arbitrary, we could use <code>-[r:ACTED_IN]-</code>.</p>
<p>If we only pass one node for <code>MERGE</code> in a relationship, it would <code>CREATE</code> both the relationship and the other node.</p>
<h2 id="getting-the-correct-results"><a class="markdownIt-Anchor" href="#getting-the-correct-results"></a> Getting the correct results</h2>
<h3 id="filtering-results"><a class="markdownIt-Anchor" href="#filtering-results"></a> Filtering results</h3>
<p>After <code>MATCH</code>, using <code>WHERE</code> clause to use any number of boolean expressions, predicates, combined with <code>AND</code>, <code>OR</code>, <code>XOR</code> and <code>NOT</code>.</p>
<p>Actually it is equivalent to the query with the condition in the pattern.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie)</span><br><span class="line">WHERE m.title = &#x27;The Matrix&#x27;</span><br><span class="line">RETURN m</span><br><span class="line"></span><br><span class="line">==</span><br><span class="line">MATCH (m:Movie &#123;title: &#x27;The Matrix&#x27;&#125;)</span><br><span class="line">RETURN m</span><br></pre></td></tr></table></figure>
<p>There are optional conditions:</p>
<ol>
<li>property matching: <code>node.property_key = &quot;value&quot;</code></li>
<li>numeric comparisons: <code>node.property_key &gt;&lt;= int</code></li>
<li>matching regular expressions: <code>p.name =~ 'K.+'</code></li>
<li>the existence of values within a list: <code>&quot;target_str&quot; IN node.property_key</code></li>
<li>a pattern predicate restricts:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)-[:ACTED_IN]-&gt;(m)</span><br><span class="line">WHERE NOT (p)-[:DIRECTED]-&gt;()  // has never directed any movies</span><br><span class="line">RETURN p, m</span><br></pre></td></tr></table></figure>
<h4 id="querying-ranges-of-values"><a class="markdownIt-Anchor" href="#querying-ranges-of-values"></a> Querying ranges of values</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)</span><br><span class="line">WHERE 3 &lt;= p.yearsExp &lt;= 7</span><br><span class="line">RETURN p</span><br></pre></td></tr></table></figure>
<h4 id="testing-if-a-property-exists"><a class="markdownIt-Anchor" href="#testing-if-a-property-exists"></a> Testing if a property exists</h4>
<p>In Neo4j, a property <strong>only exists (is stored) if it has a value</strong>. A null property is not stored.<br />
we could use <code>IS NOT NULL</code> for these nodes with the property.</p>
<h4 id="checking-strings-partial-values-fuzzy-searches"><a class="markdownIt-Anchor" href="#checking-strings-partial-values-fuzzy-searches"></a> Checking strings — partial values, fuzzy searches</h4>
<p><code>p.name STARTS WITH 'M'</code><br />
<code>p.name CONTAINS 'a'</code><br />
<code>p.name ENDS WITH 'n'</code></p>
<p>use regular expressions: <code>WHERE p.name =~ 'Jo.*'</code></p>
<h4 id="in-a-list"><a class="markdownIt-Anchor" href="#in-a-list"></a> in a list</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE p.yearsExp IN [1, 5, 6]</span><br></pre></td></tr></table></figure>
<h4 id="filtering-on-patterns-inner-join"><a class="markdownIt-Anchor" href="#filtering-on-patterns-inner-join"></a> Filtering on patterns ( Inner join )</h4>
<p>can also filter results based on relationships or patterns</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//Query1: find which people are friends of someone who works for Neo4j</span><br><span class="line">MATCH (p:Person)-[r:IS_FRIENDS_WITH]-&gt;(friend:Person)</span><br><span class="line">WHERE exists((p)-[:WORKS_FOR]-&gt;(:Company &#123;name: &#x27;Neo4j&#x27;&#125;))</span><br><span class="line">RETURN p, r, friend;</span><br><span class="line"></span><br><span class="line">//Query2: find Jennifer&#x27;s friends who do not work for a company</span><br><span class="line">MATCH (p:Person)-[r:IS_FRIENDS_WITH]-&gt;(friend:Person)</span><br><span class="line">WHERE p.name = &#x27;Jennifer&#x27;</span><br><span class="line">AND NOT exists((friend)-[:WORKS_FOR]-&gt;(:Company))</span><br><span class="line">RETURN friend.name;</span><br></pre></td></tr></table></figure>
<h4 id="optional-patterns-outre-join"><a class="markdownIt-Anchor" href="#optional-patterns-outre-join"></a> Optional patterns( Outre join )</h4>
<p>In Cypher, you can use an <code>OPTIONAL MATCH</code> pattern to try to match it, but if it doesn’t find results, those rows will return null for those values.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//Find all people whose name starts with J and who may work for a company.</span><br><span class="line">MATCH (p:Person)</span><br><span class="line">WHERE p.name STARTS WITH &#x27;J&#x27;</span><br><span class="line">OPTIONAL MATCH (p)-[:WORKS_FOR]-(other:Company)</span><br><span class="line">RETURN p.name, other.name;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">+--------------------------------+</span><br><span class="line">| p.name      | other.name       |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| &#x27;Jennifer&#x27;  | &#x27;Neo4j&#x27;          |</span><br><span class="line">| &#x27;John&#x27;      | &#x27;XYZ&#x27;            |</span><br><span class="line">| &#x27;Joe&#x27;       | null             |</span><br><span class="line">+--------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="more-complex-patterns"><a class="markdownIt-Anchor" href="#more-complex-patterns"></a> More complex patterns</h4>
<p>we could expand our pattern to perform more complex relationships:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//Query2: find who likes graphs besides Jennifer that she is also friends with</span><br><span class="line">MATCH (j:Person &#123;name: &#x27;Jennifer&#x27;&#125;)-[:LIKES]-&gt;(:Technology &#123;type: &#x27;Graphs&#x27;&#125;)&lt;-[:LIKES]-(p:Person),</span><br><span class="line">      (j)-[:IS_FRIENDS_WITH]-(p)</span><br><span class="line">RETURN p.name;</span><br></pre></td></tr></table></figure>
<p>Also, we could use <code>,</code> to use multiple conditional patterns. It is also a good way to replace <code>WHERE exists(&lt;pattern&gt;)</code>.</p>
<h3 id="returning-results"><a class="markdownIt-Anchor" href="#returning-results"></a> Returning results</h3>
<p>after <code>RETURN</code>,  we could add some simple expressions to operate the returned value:</p>
<ol>
<li>index: <code>names[0]</code>, <code>movies[1..-1]</code>, <code>substring('2014-07-01', 0, 4)</code></li>
<li>length(array)</li>
<li>toInteger(‘12’)</li>
<li>coalesce(p.nickname, ‘n/a’)</li>
</ol>
<p><code>UNIQUE</code> could trim out duplicate entities.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//Query: find people who have a twitter or like graphs or query languages</span><br><span class="line">MATCH (user:Person)</span><br><span class="line">WHERE user.twitter IS NOT null</span><br><span class="line">WITH user</span><br><span class="line">MATCH (user)-[:LIKES]-(t:Technology)</span><br><span class="line">WHERE t.type IN [&#x27;Graphs&#x27;,&#x27;Query Languages&#x27;]</span><br><span class="line">RETURN DISTINCT user.name</span><br></pre></td></tr></table></figure>
<h4 id="limiting-number-of-results"><a class="markdownIt-Anchor" href="#limiting-number-of-results"></a> Limiting number of results</h4>
<p><code>LIMIT</code> keyword takes the output of the query and limits the volume returned based on the number you specify.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//Query: find the top 3 people who have the most friends</span><br><span class="line">MATCH (p:Person)-[r:IS_FRIENDS_WITH]-(other:Person)</span><br><span class="line">RETURN p.name, count(other.name) AS numberOfFriends</span><br><span class="line">ORDER BY numberOfFriends DESC</span><br><span class="line">LIMIT 3</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/getting-started/current/cypher-intro/results/#cypher-intro-results-aggregating">https://neo4j.com/docs/getting-started/current/cypher-intro/results/#cypher-intro-results-aggregating</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/02/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/py2neo%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/02/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/py2neo%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">py2neo介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-02 18:41:24" itemprop="dateCreated datePublished" datetime="2021-03-02T18:41:24-08:00">2021-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Knowledge-Graph/" itemprop="url" rel="index"><span itemprop="name">Knowledge Graph</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>7 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="http://codewithzhangyi.com/2019/04/23/knowledge-graph-intro/">http://codewithzhangyi.com/2019/04/23/knowledge-graph-intro/</a></p>
<p>红楼梦问答： <a target="_blank" rel="noopener" href="https://piqiandong.blog.csdn.net/article/details/125697786">https://piqiandong.blog.csdn.net/article/details/125697786</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/meiqi0538/category_11901623.html?spm=1001.2014.3001.5482">https://blog.csdn.net/meiqi0538/category_11901623.html?spm=1001.2014.3001.5482</a></p>
<h2 id="neo4j-配置"><a class="markdownIt-Anchor" href="#neo4j-配置"></a> neo4j 配置</h2>
<p>mac 配置neo4j社区版：<a target="_blank" rel="noopener" href="https://www.jiyik.com/w/neo4j/neo4j-install">Neo4j Mac 系统中安装</a></p>
<p>解压的文件夹的bin目录下，有个<code>neo4j</code>，就是启动文件，所以可以在<code>~/.bashrc</code>中修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NEO4J_HOME=/Users/liuyilin/Downloads/NLP_project/neo4j-community-4.4.16 # 下载的解压文件</span><br><span class="line">export PATH=$PATH:$NEO4J_HOME/bin</span><br></pre></td></tr></table></figure>
<p>用户名 <code>neo4j</code>，新密码为  <code>neo4j123</code>。<br />
然后以后直接在后台进程中使用<code>neo4j</code>即可：<code>neo4j start</code><br />
启动后可以在命令行查看到地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Started neo4j (pid:34617). It is available at http://localhost:7474</span><br></pre></td></tr></table></figure>
<h2 id="py2neo-版本"><a class="markdownIt-Anchor" href="#py2neo-版本"></a> py2neo 版本</h2>
<p>v4 版本： <a target="_blank" rel="noopener" href="https://py2neo.org/v4/#library-reference">https://py2neo.org/v4/#library-reference</a> ，不兼容</p>
<p>2021.1 版本：<a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/">https://py2neo.org/2021.1/</a></p>
<br>
<p>导入 py2neo 包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --user  -i https://pypi.tuna.tsinghua.edu.cn/simple py2neo==2021.1</span><br></pre></td></tr></table></figure>
<h2 id="建立连接"><a class="markdownIt-Anchor" href="#建立连接"></a> 建立连接</h2>
<ul>
<li>
<p><strong>首先需要打开 neoo4j</strong></p>
</li>
<li>
<p>与网站建立连接：py2neo.graph 函数，参数为用户名以及密码，会返回一个<code>py2neo.Graph</code>链接对象</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = Graph(&quot;http://localhost:7474&quot;, auth=(&quot;neo4j&quot;,&quot;neo4j123&quot;))</span><br></pre></td></tr></table></figure>
<ul>
<li>清空原数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.delete_all()</span><br></pre></td></tr></table></figure>
<ul>
<li>CQL 语言查询<br />
<code>graph.run()</code> 里面放命令字符串</li>
</ul>
<h2 id="graph-对象方法"><a class="markdownIt-Anchor" href="#graph-对象方法"></a> Graph 对象方法</h2>
<p>Graph objects：<a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/workflow.html#graph-objects">https://py2neo.org/2021.1/workflow.html#graph-objects</a></p>
<ul>
<li>
<p><code>match(nodes=None, r_type=None, limit=None)[source]</code><br />
返回所有符合要求的 <code>py2neo.matching.RelationshipMatch</code> 对象</p>
<ul>
<li>nodes：Sequence or Set of start and end nodes (None means any node);</li>
<li>r_type：type of relationships to match (None means any type)</li>
<li>limit：maximum number of relationships to match (None means unlimited)</li>
</ul>
</li>
<li>
<p><code>match_one(nodes=None, r_type=None)</code><br />
只返回一个关系</p>
</li>
<li>
<p><code>merge(subgraph, label=None, *property_keys)[source]</code>：<br />
当<code>merge</code>调用时，是一个自动提交的一个视图，用于新建或者更新 subgraph 中的节点和关系，注意<strong>只能增不能删。</strong><br />
subgraph 中的节点和关系是独立更新的，节点先更新，关系再更新。<br />
对于subgraph中的每个节点，首先比较 label 和 property（输入参数指定），如果没有匹配选项，则创建，如果有匹配选项，则更新。<br />
对于subgraph中的每个关系，比较的是两个节点和关系type/类型，没有则新建，有则更新。</p>
<ul>
<li>subgraph：一个节点，关系，或者子图</li>
<li>label：用于匹配节点的type/label。仅用于匹配节点，匹配成功后可能会被重写。</li>
<li>property_keys：用于匹配节点的属性值。仅用于匹配节点，匹配成功后可能会被重写。</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from py2neo import Graph, Node, Relationship</span><br><span class="line">&gt;&gt;&gt; g = Graph()</span><br><span class="line">&gt;&gt;&gt; a = Node(&quot;Person&quot;, name=&quot;Alice&quot;, age=33)</span><br><span class="line">&gt;&gt;&gt; b = Node(&quot;Person&quot;, name=&quot;Bob&quot;, age=44)</span><br><span class="line">&gt;&gt;&gt; KNOWS = Relationship.type(&quot;KNOWS&quot;)</span><br><span class="line">&gt;&gt;&gt; g.merge(KNOWS(a, b), &quot;Person&quot;, &quot;name&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>delete(subgraph)</code>：删除一个子图，是一个自动提交的视图。</p>
</li>
<li>
<p>property <code>nodes</code><br />
返回一个 <code>NodeMatcher</code> 对象</p>
</li>
</ul>
<h2 id="节点操作"><a class="markdownIt-Anchor" href="#节点操作"></a> 节点操作</h2>
<p><strong>Node和Relationship在这个驱动中都继承了PropertyDict这个类，而这个类继承类python里面的dict，所以操作和python本身的dict一模一样</strong></p>
<p>节点的 <code>(:value)</code> 是参数 label，而关系的  <code>(:value)</code> 是参数 <code>type</code>。</p>
<h3 id="增删改"><a class="markdownIt-Anchor" href="#增删改"></a> 增删改</h3>
<ul>
<li>
<p>新建节点：<code>py2neo.Node</code> 类，<br />
参数为标签 label 和属性 property，返回一个节点对象</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = Node(&quot;yili&quot;, gender=&quot;male&quot;)</span><br></pre></td></tr></table></figure>
<p>得到节点为 <code>(:yili &#123;gender: 'male'&#125;)</code>，这里的 label 就是 <code>yili</code></p>
</li>
<li>
<p>放置节点：<code>graph.create</code> 函数</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.create(a)</span><br></pre></td></tr></table></figure>
<p>该方法不会自己检查该节点是否已经创建，所以在实际使用，应先检查要创建的节点是否存在。或者使用 <code>Merge</code> 方法。</p>
</li>
<li>
<p>删除节点：<code>graph.delete</code> 函数</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.delete(node_a)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>获取node的属性：<code>x=test_node_2[key]</code></p>
</li>
<li>
<p>设置node的属性：<code>test_node_2[key] = value</code> + <code>graph.push(test_node_2)</code></p>
</li>
<li>
<p>删除node的属性：<code>del node[key]</code></p>
</li>
<li>
<p>返回node里面property的个数：<code>len(node)</code></p>
</li>
<li>
<p>返回所有和这个节点有关的label：<code>node.labels</code></p>
</li>
<li>
<p>将node的所有property以dictionary的形式返回：<code>dic(node)</code></p>
</li>
</ul>
<p>使用 <code>py2neo</code> 修改 Node 或者 Relation 时，当我们直接用语法，如果没有进行绑定，就会仅仅是对本地端的数据进行了处理，而没有作用到数据库上去。</p>
<p><strong>修改节点时有两个必要条件：</strong></p>
<ol>
<li>节点已经和 <code>Graph</code>类注册，通常是<code>create()</code>方法或者<code>match()</code>方法得到的，即「自己推上去」的和「自己查询到的」。</li>
<li>修改节点后需要调用方法 <code>graph.push(node_object)</code> 把它提交上去。</li>
</ol>
<h3 id="查询节点"><a class="markdownIt-Anchor" href="#查询节点"></a> 查询节点</h3>
<h4 id="根据属性查询"><a class="markdownIt-Anchor" href="#根据属性查询"></a> 根据属性查询</h4>
<ul>
<li>
<p>匹配/链接 节点，使用到节点匹配器 <code>py2neo.matching.NodeMatcher</code> 类</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from py2neo.matching import *</span><br><span class="line">matcher = NodeMatcher(graph)  # 创建节点匹配器</span><br><span class="line"></span><br><span class="line">result = matcher.match(&#x27;判决文书&#x27;, name = &#x27;XXX刑事判决书&#x27;).exists()  # 符合条件的是否存在</span><br><span class="line"></span><br><span class="line">node = matcher.match(&#x27;判决文书&#x27;).where(name = &#x27;XXX刑事判决书&#x27;).first()　# 评估匹配并返回匹配的第一个节点</span><br></pre></td></tr></table></figure>
<p><code>matcher.match('判决文书', name = 'XXX刑事判决书')</code> 和 <code>matcher.match('判决文书').where(name = 'XXX刑事判决书')</code> 是两种匹配方式。<br />
where可以进行精确匹配，可以用表达式进行较复杂的匹配，比如 <code>where(&quot;_.name=&quot; + &quot;'&quot; + *名称 + &quot;'&quot;)</code>，默认用<code>_</code>表示节点。</p>
</li>
<li>
<p>查询节点：</p>
<ul>
<li>命令直接查询：<code>graph.run('MATCH (a:人) RETURN a')</code>，返回一个 <code>Node list</code></li>
<li><code>graph.nodes.match('人')</code>，根据type查询节点，返回一个 <code>py2neo.matching.NodeMatch</code> 类型数据。<br />
参数为<code>*labels, **properties</code>，所以也可以指定属性：<code>graph.nodes.match('人', name='小红')</code><br />
<code>type(graph.nodes)=py2neo.matching.NodeMatcher object</code>，也是一个 <code>matcher</code>对象，所以后续也是使用 <code>match()</code> 方法。</li>
</ul>
</li>
</ul>
<p><code>NodemMatcher.match()</code> 函数返回的结果是一个 <code>NodeMatch</code> 类型数据，可以用<code>list()</code>进行强制转换。<br />
同时，这个<code>NodeMatch</code>对象后可以接上一些方法：</p>
<ul>
<li><code>where()</code>：进行二次筛选</li>
<li><code>first()</code>：输出第一个节点</li>
<li><code>exists()</code>：是否存在</li>
<li><code>limit()</code>：限制数量</li>
</ul>
<h4 id="根据-id-查询"><a class="markdownIt-Anchor" href="#根据-id-查询"></a> 根据 id 查询</h4>
<p>获取节点的 id ：调用节点的<code>identity</code>属性：<code>node.identity</code></p>
<p>通过 id 得到节点 ：<code>created_node = matcher[node_id]</code></p>
<h2 id="关系操作"><a class="markdownIt-Anchor" href="#关系操作"></a> 关系操作</h2>
<p><a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/data/index.html#py2neo.data.Relationship">py2neo.data.Relationship</a></p>
<h3 id="增删改-2"><a class="markdownIt-Anchor" href="#增删改-2"></a> 增删改</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab = Relationship(a, &quot;KNOWS&quot;, b)</span><br><span class="line">graph.create(ab)</span><br></pre></td></tr></table></figure>
<p>关系同样也有类似的操作：</p>
<ul>
<li>创建relationship：<code>Relationship(start_node, type, end_node, properties)</code></li>
<li>返回Relationship的property：<code>Relationship[key]</code></li>
<li>删除某个property：<code>del Relationship[key]</code></li>
<li>将property以字典形式返回：<code>dict(relationship)</code></li>
</ul>
<h3 id="查询关系"><a class="markdownIt-Anchor" href="#查询关系"></a> 查询关系</h3>
<ul>
<li>使用关系查询器，</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">relation_matcher = RelationshipMatcher(graph)</span><br><span class="line">result = relation_matcher.match(&#123;first_node, second_node&#125;, r_type = None, key = value).first()</span><br></pre></td></tr></table></figure>
<p>参数为：<code>nodes=None, r_type=None, **properties</code><br />
- nodes ：一般为 <code>&#123;start-node, end-node&#125;</code> 格式<br />
- r_type：关系type<br />
- properties：关系属性，<code>key = value</code>格式</p>
<ul>
<li>图自带查询：<code>graph.match(r_type=&quot;喜欢&quot;)</code></li>
</ul>
<h2 id="node-and-relationship-matching"><a class="markdownIt-Anchor" href="#node-and-relationship-matching"></a> Node and relationship matching</h2>
<p><a target="_blank" rel="noopener" href="https://py2neo.org/2021.1/matching.html?highlight=relationshipmatcher">API for Node and relationship matching</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/14/Coding/Python/python%20%E5%A4%9A%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/14/Coding/Python/python%20%E5%A4%9A%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">python 多进程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-14 10:57:32" itemprop="dateCreated datePublished" datetime="2021-02-14T10:57:32-08:00">2021-02-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>14 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/111430051">34、python并发编程之多进程（操作篇）</a><br />
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/493699150">【Python】Python多进程详解</a><br />
<a target="_blank" rel="noopener" href="http://www.cnblogs.com/Anker/p/3271773.html">僵尸进程与孤儿进程（了解）</a><br />
<a target="_blank" rel="noopener" href="https://www.cnblogs.com/fengf233/p/11506337.html">python多进程总结</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/02/14/Coding/Python/python%20%E5%A4%9A%E8%BF%9B%E7%A8%8B/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/" class="post-title-link" itemprop="url">pandas库的简单讲解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/" itemprop="url" rel="index"><span itemprop="name">Data Analysis Package</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/Pandas/" itemprop="url" rel="index"><span itemprop="name">Pandas</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>30 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/583d83f1ff81">https://www.jianshu.com/p/583d83f1ff81</a></p>
<p>导入pandas库： <code>import pandas as pd </code></p>
<h1 id="其他点"><a class="markdownIt-Anchor" href="#其他点"></a> 其他点</h1>
<ul>
<li>注意 dp 中的 nan，应该用  <code>np.nan</code> 来指定</li>
</ul>
<h1 id="series"><a class="markdownIt-Anchor" href="#series"></a> Series</h1>
<h2 id="创建"><a class="markdownIt-Anchor" href="#创建"></a> 创建</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.Series( data=<span class="literal">None</span>, index=<span class="literal">None</span>, dtype=<span class="literal">None</span>, )</span><br></pre></td></tr></table></figure>
<p><code>data : array-like, Iterable, dict, or scalar value</code><br />
<code>index : array-like or Index (1d)</code>：如果没有指定，则默认从 0 开始<br />
<code>dtype : str, numpy.dtype, or ExtensionDtype, optional</code><br />
<code>copy : bool, default False</code> ：Copy input data. <strong>Only affects Series or 1d ndarray input.</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a= pd.Series([1,2,3,4],index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;,&#x27;d&#x27;])</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">d    4</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d = &#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; pd.Series(data=d)</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; pd.Series(data=d, index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span><br><span class="line">a   1</span><br><span class="line">b   2</span><br><span class="line">c   3</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"># 根据字典创建则需要 index 匹配 key</span><br><span class="line">&gt;&gt;&gt; pd.Series(data=d, index=[&#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;])</span><br><span class="line">x   NaN</span><br><span class="line">y   NaN</span><br><span class="line">z   NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<h2 id="attribute"><a class="markdownIt-Anchor" href="#attribute"></a> Attribute</h2>
<p><code>.T</code>：对 Pandas Series 使用 <code>.T</code> ，它将不会执行矩阵的转置操作，而只是返回原始 Series，因为 Series 本身只有一列。<br />
<code>.array</code>：return <code>&lt;PandasArray&gt;</code> ，忽略 index<br />
<code>.values</code>：return <code>numpy.ndarray</code> ，忽略 index<br />
<code>.ndim</code>：return Number of dimensions of the underlying data, by definition 1 .<br />
<code>.hahnans</code>：Return True if there are any NaNs. 注意不是方法，而是属性，不需加括号 。<br />
<code>.empty</code>：用于检查是否为空，注意区别 NaN，NaN 不是空，这里空表示 <code>pd.DataFrame(&#123;'A' : []&#125;)</code> 没有定义。<br />
<code>.name</code>：Series 的一个属性，直接创建的话，默认为空，但是可以修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a.name = &#x27;hhhh&#x27;</span><br><span class="line">&gt;&gt;&gt; a.name</span><br><span class="line">&#x27;hhhh&#x27;</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">Name: hhhh, dtype: int64</span><br></pre></td></tr></table></figure>
<p><strong>dtype 相关 ：</strong></p>
<ul>
<li><code>.dtype</code></li>
<li><code>.astype(dtype, copy=None, errors='raise')</code>：修改 dtype 属性</li>
<li><code>pandas.Series.convert_dtypes()</code>：<strong>non-inplace</strong> 用于将 Series 中的数据类型转换为最适合存储数据的数据类型，以节省内存和提高性能。</li>
</ul>
<p><strong>索引相关 ：</strong></p>
<ul>
<li><code>['a'] / .at['a'] / .loc['a']</code>：返回对应 <code>'a'</code> 的元素，注意使用中括号 <code>[]</code></li>
<li><code>[0] / .iat[0] / .iloc[0]</code>：返回对应 0-index 的元素，注意使用中括号 <code>[]</code></li>
<li><code>.keys()</code>  / <code>.values()</code>：类似字典，返回取值</li>
</ul>
<p><strong>转换函数相关 ：</strong></p>
<ul>
<li><code>.abs()</code></li>
<li><code>.pop()</code>：return and drop，参数为 index label 值，区分数组。</li>
<li><code>.add(other, level=None, fill_value=None, axis=0)</code>：<br />
等于 <code>series + other</code>，但是可以设置参数 <code>fill_value</code>
<ul>
<li><code>other</code>: 放另一个 Series ，会将同一个 index value 的进行相加 。</li>
<li><code>level=None</code>: 用于填充缺失值（NaN）。如果最少一个不是 NaN，则使用缺失值 ； 如果两个都是 NaN，则结果还是 NaN ；默认情况下不指定，则只要有一个为 NaN，结果就是 NaN 。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = pd.Series([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, np.nan], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = pd.Series([<span class="number">1</span>, np.nan, <span class="number">1</span>, np.nan], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.add(b, fill_value=<span class="number">1</span>)</span><br><span class="line">a    <span class="number">2.0</span></span><br><span class="line">b    <span class="number">2.0</span></span><br><span class="line">c    <span class="number">2.0</span></span><br><span class="line">d    <span class="number">2.0</span></span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.sub(other, level=None, fill_value=None, axis=0)</code>：同上，是删除操作<br />
等于 <code>series - other</code>，但是可以设置参数 <code>fill_value</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a.sub(b, fill_value=4)</span><br><span class="line">a    0.0</span><br><span class="line">b   -3.0</span><br><span class="line">c   -3.0</span><br><span class="line">d    3.0</span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; a.sub(b)</span><br><span class="line">a    0.0</span><br><span class="line">b    NaN</span><br><span class="line">c    NaN</span><br><span class="line">d    NaN</span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.mul(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series * other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.div(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series / other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.floordiv(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series // other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.mod(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series % other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.pow(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series ** other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.combine(other, func, fill_value=None)</code> :根据 <code>func</code>函数，处理两个series 的对应值，比如 <code>max / min / ...</code><br />
注意如果没有指定 <code>fill_value</code> ，如果存在一方为 NaN，并且是比大小的话，则保留调用该方法的 series 内部的值。<br />
如果自定义使用 lambda 的话，则会保留 NaN，即使有填充值。<br />
反正不建议使用这个操作，先 fillna 然后再进行变换比较好。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">a    3.0</span><br><span class="line">b    NaN</span><br><span class="line">d    8.0</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">a    1.0</span><br><span class="line">b    1.0</span><br><span class="line">c    1.0</span><br><span class="line">d    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.combine(a,  min)</span><br><span class="line">a    1.0</span><br><span class="line">b    NaN  # 这里保留了 Series b 的值，尽管 Series a 中有值</span><br><span class="line">c    NaN</span><br><span class="line">d    8.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>.lt(other, level=None, fill_value=None, axis=0)</code></p>
</li>
<li>
<p><code>.gt</code></p>
</li>
<li>
<p><code>.le</code></p>
</li>
<li>
<p><code>.ge</code></p>
</li>
<li>
<p><code>.ne</code></p>
</li>
<li>
<p><code>.eq</code></p>
</li>
<li>
<p><code>.round()</code> ： 四舍五入取整数，不看正负</p>
</li>
<li>
<p><code>.apply(func, convert_dtype=_NoDefault.no_default, args=(), *, by_row='compat', **kwargs)</code>：可以用于 Series 或 DataFrame 对象。</p>
<ul>
<li>args : 是该方法的一些其他参数 ， 可以使用 <code>**</code> 转换为字典，更方便 。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = pd.Series([20, 21, 12],  index=[&#x27;London&#x27;, &#x27;New York&#x27;, &#x27;Helsinki&#x27;])</span><br><span class="line">&gt;&gt;&gt; s.apply(lambda x,y: x-y, args=(5,))</span><br><span class="line">London      15</span><br><span class="line">New York    16</span><br><span class="line">Helsinki     7</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; def add_custom_values(x, **kwargs):</span><br><span class="line">...     for month in kwargs:</span><br><span class="line">...         x += kwargs[month]</span><br><span class="line">...     return x</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s.apply(add_custom_values, june=30, july=20, august=25)</span><br><span class="line">London      95</span><br><span class="line">New York    96</span><br><span class="line">Helsinki    87</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.map(arg, na_action=None)</code>和 apply 类似，但是通常用于 Series 对象。
<ul>
<li><code>arg : function, collections.abc.Mapping subclass or Series</code>，除了 lambda，也可以穿入一个字典</li>
<li><code>na_action=None</code> ，如果为 <code>ignore</code>，则 NaN 处理后还是 NaN 。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.map(&#x27;I am a &#123;&#125;&#x27;.format)</span><br><span class="line">0       I am a cat</span><br><span class="line">1       I am a dog</span><br><span class="line">2       I am a nan</span><br><span class="line">3    I am a rabbit</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s.map(&#x27;I am a &#123;&#125;&#x27;.format, na_action=&#x27;ignore&#x27;)</span><br><span class="line">0     I am a cat</span><br><span class="line">1     I am a dog</span><br><span class="line">2            NaN</span><br><span class="line">3  I am a rabbit</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>
<h1 id="dataframe"><a class="markdownIt-Anchor" href="#dataframe"></a> DataFrame</h1>
<h2 id="创建-2"><a class="markdownIt-Anchor" href="#创建-2"></a> 创建</h2>
<ol>
<li>按列直接创建：</li>
</ol>
<ul>
<li>不指定行索引index（行索引被默认为数字，从0开始），参数为列的字典</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&#x27;one&#x27;: [1, 2, 3], &#x27;two&#x27;: [4, 5, 6]&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">0    1    4</span><br><span class="line">1    2    5</span><br><span class="line">2    3    6</span><br></pre></td></tr></table></figure>
<ul>
<li>指定行索引index，参数为列的字典和行索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&#x27;one&#x27;: [1, 2, 3], &#x27;two&#x27;: [4, 5, 6]&#125;, index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a    1    4</span><br><span class="line">b    2    5</span><br><span class="line">c    3    6</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>按照行进行创建<br />
<code>append</code> 方法创建</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">创建一个空的Dataframe</span><br><span class="line">result =pd.DataFrame(columns=(&#x27;idx&#x27;,&#x27;degree&#x27;,&#x27;weight&#x27;,&#x27;diameter&#x27;))</span><br><span class="line">#将计算结果逐行插入result,注意变量要用[]括起来,同时ignore_index=True，否则会报错，ValueError: If using all scalar values, you must pass an index</span><br><span class="line">for i in idx:</span><br><span class="line">    degree=</span><br><span class="line">    weight=</span><br><span class="line">    diameter=</span><br><span class="line">    result=result.append(pd.DataFrame(&#123;&#x27;idx&#x27;:[i],&#x27;degree&#x27;:[degree],&#x27;weight&#x27;:[weight],&#x27;diameter&#x27;:[diameter]&#125;),ignore_index=True)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>使用Series创建：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&quot;one&quot;: pd.Series([1, 2, 3], index=[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]), &quot;two&quot;:pd.Series([1,2,3,4],index=[&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;,&#x27;d&#x27;])&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a  1.0    2</span><br><span class="line">b  2.0    1</span><br><span class="line">c  3.0    3</span><br><span class="line">d  NaN    4</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>使用index和columns参数创建：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dates = pd.date_range(&#x27;today&#x27;,periods=6) # 定义时间序列作为 index</span><br><span class="line">num_arr = np.random.randn(6,4) # 传入 numpy 随机数组</span><br><span class="line">columns = [&#x27;A&#x27;,&#x27;B&#x27;,&#x27;C&#x27;,&#x27;D&#x27;] # 将列表作为列名</span><br><span class="line">df1 = pd.DataFrame(num_arr, index = dates, columns = columns)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">                                   A         B         C         D</span><br><span class="line">2021-02-14 11:00:38.210410 -0.234308  0.458834  1.758701 -0.390679</span><br><span class="line">2021-02-15 11:00:38.210410 -1.448708  0.534228  0.404082  0.722971</span><br><span class="line">2021-02-16 11:00:38.210410  0.540040 -0.593858  0.882544  0.499553</span><br><span class="line">2021-02-17 11:00:38.210410 -1.295320  0.909557 -1.058109 -0.530681</span><br><span class="line">2021-02-18 11:00:38.210410  0.307840  0.328438 -0.680865 -2.096587</span><br><span class="line">2021-02-19 11:00:38.210410 -1.777850  0.615222 -0.213545 -0.219512</span><br></pre></td></tr></table></figure>
<h2 id="属性"><a class="markdownIt-Anchor" href="#属性"></a> 属性</h2>
<ul>
<li><code>.index</code>: 返回 index</li>
<li><code>.columns</code>: 返回 columns 特征列表</li>
<li><code>.ndim</code>: 返回特征数量，也就是 columns 数量</li>
<li><code>.info()</code></li>
<li><code>.describe()</code>: 返回  statistics 统计量</li>
<li><code>.values</code>: 返回一个 <code>numpy.ndarray</code></li>
<li><code>.size</code>: 返回元素数量，NaN 也算</li>
<li><code>.shape</code></li>
<li><code>.T</code>: 转制</li>
<li>更改列名：
<ol>
<li>修改列名a，b为A、B：<code>df.columns = ['A','B']</code></li>
<li>只修改列名a为A：<code>df = df.rename(columns=&#123;'a':'A'&#125;)</code></li>
</ol>
</li>
<li><code>.reset_index()</code>：重置 DataFrame 的索引，从 0 开始。
<ul>
<li><code>drop=False</code>：默认情况下新的  df 会保留原始 df 的 index，成为一个新的列；如果 <code>drop=True</code>，那么旧的 index 会被直接删除。</li>
</ul>
</li>
<li><code>.set_index('A')</code>：设置 ‘A’ 列作为行索引</li>
<li><code>.rename_axis('New_Index')</code>：重命名索引</li>
</ul>
<h3 id="dtype-类型"><a class="markdownIt-Anchor" href="#dtype-类型"></a> dtype 类型</h3>
<ul>
<li><code>.astype(dtype, copy=None, errors='raise')</code>
<ul>
<li><code>dtype : str, data type, Series or Mapping of column name -&gt; data type</code><br />
str：dtype，比如 <code>'int32'</code><br />
字典：针对特定的列进行操作，key 为 column 名称，value 为 str类型 的 dtype</li>
</ul>
</li>
<li><code>.convert_dtypes()</code>: 转化 dtype 来节省内存，Convert columns to the best possible dtypes using dtypes supporting <a target="_blank" rel="noopener" href="http://pd.NA">pd.NA</a> 。</li>
</ul>
<h3 id="数值操作"><a class="markdownIt-Anchor" href="#数值操作"></a> 数值操作</h3>
<ul>
<li><code>+-*///%   int/arr</code>：int 就是所有列都进行同一个操作 ，arr 表示对应的列跟arr对应元素进行操作 。<br />
而 <code>.add() / sub()</code> 等方法默认就是 <code>columns</code> ，好处就是可以赋值参数 <code>fill_value</code> 。</li>
<li><code>mean()</code>：每一列的 mean</li>
<li><code>sum()</code>：每一列的 sum</li>
<li><code>std(axis=0, skipna=True, ddof=1, numeric_only=False, **kwargs)</code>：计算标准差，默认列</li>
<li><code>var(axis=0, skipna=True, ddof=1, numeric_only=False, **kwargs)</code>：计算方差，默认列</li>
<li><code>nunique(axis=0, dropna=True)</code>：非重复值的数量，默认列</li>
<li><code>round()</code> ：四舍五入<br />
可以直接传入一个 <code>int</code> 表示保留小数部分的位数：<code>df.round(2)</code><br />
或者根据字典单独定义不同列需要保留的位数： <code>df.round(&#123;&quot;col1&quot;:1, &quot;col2&quot;:2&#125;)</code></li>
</ul>
<h3 id="排序"><a class="markdownIt-Anchor" href="#排序"></a> 排序</h3>
<ul>
<li><code>sort_values()</code>：根据元素值进行行排序，NaN 放在最下面
<ul>
<li><code>by : str or list of str</code> ：传入列标签的名称，或者名称的数组，表示排序的依据</li>
<li>当使用多个排序标准时，使用数组 <code>df1.sort_values(by=['age', 'visits'], ascending=[False, True])</code></li>
</ul>
</li>
<li><code>sort_index(axis=0, ascending=True, key=None)</code>：仅根据 index 进行排序，即不考虑实际的内容，只想把 index 改正
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li><code>key : callable, optional</code>：可以传入 lambda 数组</li>
</ul>
</li>
</ul>
<h3 id="增删改"><a class="markdownIt-Anchor" href="#增删改"></a> 增删改</h3>
<p><strong>插入 ：</strong></p>
<ul>
<li>插入列：<code>.insert(loc, column, value, allow_duplicates=_NoDefault.no_default)</code>
<ul>
<li><code>loc : int</code>：Must verify 0 &lt;= loc &lt;= len(columns) ， 表示新插入是第几列</li>
<li><code>column</code>：新的列名</li>
<li><code>value : Scalar, Series, or array-like</code> ：列的值</li>
<li><code>allow_duplicates : bool, optional, default lib.no_default</code> ： 是否允许和已经有的列名重复</li>
</ul>
</li>
<li>插入列：<code>df['new_column_name'] = ...</code></li>
<li>插入行：
<ul>
<li><code>df.loc[len(df)] = [4, 7]</code> ：创建一个列表，其中的元素按照 DataFrame 列的顺序排列</li>
<li><code>df = df.append(&#123;'A': 4, 'B': 7&#125;, ignore_index=True)</code> ：创建一个字典，其中键是列名，值是要插入的数据</li>
</ul>
</li>
</ul>
<p><strong>删除：</strong></p>
<ul>
<li>删除特定行或者列：<code>.drop(labels=None, *, axis=0, index=None, columns=None, level=None, inplace=False, errors='raise')</code>
<ul>
<li><code>labels : single label or list-like</code> ：名称或者名称的列表</li>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li><code>index : single label or list-like</code>：直接指定删除的行名称</li>
<li><code>columns : single label or list-like</code>：直接指定删除的列名称</li>
</ul>
</li>
<li>删除并返回特定列：<code>.pop(column_name)</code> ：删除并返回 column_name 列</li>
</ul>
<p><strong>修改：</strong></p>
<ul>
<li><code>.where(cond, other=nan, *, inplace=False, axis=None, level=None)</code>：<br />
根据指定的条件筛选 DataFrame 中的数据，并将不满足条件的 False元素 替换为指定的值 <code>other=nan</code>。
<ul>
<li><code>cond</code> 返回 True/False ， 需要维度和 df 的维度一致。用于筛选，一般直接是 df 的操作，因为目的是为了填充一些元素。</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = pd.Series(range(5))</span><br><span class="line">&gt;&gt;&gt; s.where(s &gt; 0)</span><br><span class="line">0    NaN</span><br><span class="line">1    1.0</span><br><span class="line">2    2.0</span><br><span class="line">3    3.0</span><br><span class="line">4    4.0</span><br></pre></td></tr></table></figure>
</li>
<li><code>.mask(cond, other=_NoDefault.no_default, *, inplace=False, axis=None, level=None)</code>：和 where 一样，只不过这里是替换 True 的元素 。</li>
<li><code>.truncate(before=None, after=None, axis=None, copy=None)</code>：截断，保留 [before, after] 的部分 。
<ul>
<li><code>before : date, str, int</code> ：Truncate all rows before this index value.</li>
<li><code>after : date, str, int</code> ：Truncate all rows after this index value.</li>
<li><code>axis=0 : &#123;0 or ‘index’, 1 or ‘columns’&#125;, optional</code></li>
</ul>
</li>
<li>根据一列来新建另一列，使用到了 numpy  三元条件表达式：<code>apl['涨跌'] = np.where(apl[3]&gt;0,'涨',np.where(apl[3]==0,'平','跌'))</code></li>
</ul>
<h3 id="apply-map"><a class="markdownIt-Anchor" href="#apply-map"></a> apply / map</h3>
<ul>
<li><code>.apply(func, axis=0, raw=False, result_type=None, args=(), by_row='compat', **kwargs)</code>
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li>默认是每一个 column 为一个整体，当然也可以理解为：逐个元素进行操作 ， 比如：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resampled.apply(lambda col: np.std(col))  # 计算每一列的方差</span><br><span class="line">d.apply(lambda x: x+1) # 每一列元素 + 1 -&gt; 每个元素 + 5</span><br></pre></td></tr></table></figure>
<ul>
<li>可以直接对整个 df 进行操作，即列和列之间对比，注意加上 <code>axis=1</code>：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">step1_df[&#x27;label&#x27;] = step1_df.apply(lambda x: 1 if str(x.pred_content_id) in x.true_content_id else 0, axis=1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="索引方式"><a class="markdownIt-Anchor" href="#索引方式"></a> 索引方式</h2>
<ul>
<li><code>.at['row_label', 'column_label']</code>  /  <code>.iat['row_idx', 'column_idx']</code> ：at 方法仅用于选择单个元素，</li>
<li><code>.loc['row_label', 'column_label']</code> / <code>.iloc['row_idx', 'column_idx']</code> ：选择单个元素</li>
<li><code>[column_label][row_label]</code>：选择标签对应的元素，不建议使用这种方式</li>
<li><code>[column_label]</code>：选择一整个列；<br />
<code>[row_label, :]</code>/<code>[row_label]</code>：选择一整行</li>
<li>花式索引：<code>d['one'][d['one']&gt; 2]</code> ; <code>d.loc[['a', 'c'],  'one']</code> ; <code>target[(target.event==1)&amp;(target.season==3)]</code> ， 注意用 <code>()</code> 括起来，然后加上 <code>&amp;</code>，不能改成 <code>and</code>; <code>or</code> 则是 <code>|</code> 。</li>
<li><code>isin(array)</code>/ <code>~isin(array)</code>：返回一个 True / False 数据结构，可以用于索引，比如 <code>d[d['one'].isin([1,2])]</code> 。</li>
</ul>
<h2 id="nan-处理-填充"><a class="markdownIt-Anchor" href="#nan-处理-填充"></a> NAN 处理 / 填充</h2>
<p><strong>查找 nan：</strong></p>
<ul>
<li><code>.isnull()/notnull()</code>：如果值为NaN，返回 True/False，否则返回 False/True ， 返回结果为同一个 size 的 df。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看每一列是否有NaN：</span><br><span class="line">df.isnull().any(axis=0)</span><br><span class="line"># 查看每一行是否有NaN：</span><br><span class="line">df.isnull().any(axis=1)</span><br><span class="line"># 查看所有数据中是否有NaN最快的：</span><br><span class="line">df.isnull().values.any()</span><br><span class="line"># 查看哪些列有 nan</span><br><span class="line">columns_with_nan = df.columns[df.isnull().any()]</span><br><span class="line"># 查找包含NaN值的行</span><br><span class="line">rows_with_nan = df[df.isnull().any(axis=1)]</span><br></pre></td></tr></table></figure>
<p><strong>填充 null</strong></p>
<ul>
<li>
<p><code>.dropna()</code>：返回删除所有缺失值的Series对象，并返回 df</p>
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125; default 0</code>： 0 按行删除 ；1 按列删除</li>
<li><code>how : &#123;‘any’, ‘all’&#125;, default ‘any’</code>：只要有一个 nan，就删除 ；还是全部为 nan 才删除</li>
<li><code>ignore_index : bool, default False</code>：删除后是否重新更新 index 索引</li>
</ul>
</li>
<li>
<p><code>.fillna(参数)</code>：填充NaN并返回，参数为填充值。</p>
<ul>
<li>根据每一列均值来填充 : <code>df.fillna(df.mean(), inplace=True)</code></li>
</ul>
</li>
<li>
<p><code>df.bfill(axis='rows')</code></p>
<ul>
<li><code>axis='index'</code> 或 <code>axis=0</code>（默认值）:  使用下一行数据进行填充</li>
<li><code>axis= axis='columns' </code>或<code> axis=1</code>: 使用下一列数据进行填充<br />
如果下一行或者下一列也是 None，就向后找，直到找到非空，然后全部填充，如果找不到，那就还是 Nan</li>
</ul>
</li>
<li>
<p><code>df.ffill()</code> ，参考前面，这个是使用前面的数据进行填充</p>
</li>
</ul>
<h2 id="一些方法"><a class="markdownIt-Anchor" href="#一些方法"></a> 一些方法</h2>
<ul>
<li>
<p><code>DataFrame.rolling(window, min_periods=None, center=False, win_type=None, on=None, axis=_NoDefault.no_default, closed=None, step=None, method='single')</code></p>
<ul>
<li><code>window : int, timedelta, str, offset, or BaseIndexer subclass</code>：选择 rolling window 的大小<br />
最常用的是 <code>offset : int</code>：，示选择自己和前面一共 offset 个数字 。<br />
当索引是时间类型 <code>pd.Timestamp</code> ，可以使用如 <code>2s</code> 来选定包含自己的一段时间。但是需要保证时间索引是对的，即没有进行随机排列，所以在之前可以进行 <code>df.sort_index()</code> ，先排序。</li>
<li><code>min_periods : int: default None</code>：Minimum number of observations in window required to have a value; otherwise, result is np.nan.</li>
<li><code>center : bool, default False</code>：默认向右进行划窗，可以选择进行左右两边划窗。</li>
<li><code>on</code>：用于多级索引的情况，以指定在哪个级别上执行滚动操作。</li>
<li>通常是后面跟一个函数来进行 agg 运算，比如 <code>df.rolling(2).sum()</code> 。实际是先 rolling，划分为多个组，然后进行操作，最后赋值，所以可以有：<code>lambda x: np.fabs(x - x.mean()).mean()</code> 。</li>
</ul>
</li>
<li>
<p>切分数组：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_splits = <span class="number">20</span></span><br><span class="line">df_splits = np.array_split(df, num_splits)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>pandas.concat()</code>：可以将数据根据不同的轴作简单的拼接</p>
<ul>
<li><code>a sequence or mapping of Series or DataFrame objects</code></li>
<li><code>axis : &#123;0/’index’, 1/’columns’&#125;, default 0</code>： 需要合并链接的轴，0是行，1是列，默认按行合并</li>
<li><code>join : &#123;‘inner’, ‘outer’&#125;, default 'outer'</code>：连接方式 inner 表示删除不重合的列 ；</li>
<li><code>ignore_index = Flase</code> ：按行拼接后是否重新整理 index</li>
</ul>
</li>
<li>
<p><code>shift()</code>方法，用来偏移元素<br />
参数：<br />
1. periods: 偏移量<br />
2. frep: DateOffset, timedelta, or time rule string，可选参数，默认值为None，只适用于时间序列，如果这个参数存在，那么会按照参数值移动时间索引，而数据值没有发生变化。<br />
3. axis:指定要移位的行或列，0为行，1为列<br />
4. fill_value:指定移位后的填充值，fill_value=0，即表示移位后缺失值填充为0<br />
可以用该方法对单行/列进行操作<br />
可以用该方法来去除重复行</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;&#x27;A&#x27;: [1, 2, 2, 3, 4, 5, 5, 5, 6, 7, 7]&#125;)</span><br><span class="line">df1 = df.loc[df[&#x27;A&#x27;].shift() != df[&#x27;A&#x27;]]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   A</span><br><span class="line">0  1</span><br><span class="line">1  2</span><br><span class="line">3  3</span><br><span class="line">4  4</span><br><span class="line">5  5</span><br><span class="line">8  6</span><br><span class="line">9  7</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>df.diff()</code>: 当前行减去上一行的值<br />
或者 <code>df['diff'] = df['value'] - df['value'].shift(1)</code></p>
</li>
<li>
<p>随机抽样方法</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.sample( n=None, frac=None, replace=False,</span><br><span class="line">                  weights=None, random_state=None, axis=None)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>n: int</code>：用来指定随机抽取的样本数目（行数目）或者列数目，默认随机抽取行数据。<br />
不指定<code>n</code>，也不指定<code>frac</code>时，默认随机抽取一行数据。</li>
<li><code>frac: float</code>：指定随机抽取行或列的比例</li>
<li><code>replace: bool</code>：有放回抽样还是无放回抽样。当 <code>frac&gt;1</code> 的浮点数或者参数 <code>n&gt;样本数目</code> ，需要指定<code>replace=True</code>。</li>
<li><code>weights: str or Series</code>：默认为<code>None</code>，即执行等概率抽样。
<ul>
<li><code>str</code>类型，要求是DataFrame中的一个列名，pandas将str这个列的取值作为该行数据的抽样权重进行抽样。<br />
如果列中数据相加和不等于1，该列数据将被标准化到和为1。列中如果有缺失值，该行数据的抽样权重被视为0。此外这个列中不允许无限值。</li>
<li><code>Series</code>类型，<code>Series</code>的长度可以和数据中行或列的长度不同。<br />
<code>pandas</code>会先进行索引对齐，相当于对<code>DataFrame</code>和<code>Series</code>做一个左连接。<code>DataFrame</code>中没有匹配到的索引对应的行抽样权重为0。</li>
</ul>
</li>
<li><code>random_state: int</code>：用于复现抽样结果</li>
<li><code>axis: int/str</code>：当axis指定为0或者’index’时，对行进行抽样，当axis指定为1或者’col’时，对列进行抽样。默认执行的是行抽样。</li>
</ul>
</li>
</ul>
<h3 id="groupby-聚合方法"><a class="markdownIt-Anchor" href="#groupby-聚合方法"></a> groupby 聚合方法</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lemonbit/p/6810972.html">https://www.cnblogs.com/lemonbit/p/6810972.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   A  B    C</span><br><span class="line">0  a  2  102</span><br><span class="line">1  b  8   98</span><br><span class="line">2  a  1  107</span><br><span class="line">3  c  4  104</span><br><span class="line">4  a  3  115</span><br><span class="line">5  c  2   87</span><br><span class="line">6  b  5   92</span><br><span class="line">7  c  9  123</span><br></pre></td></tr></table></figure>
<ul>
<li>按A列分组（groupby），获取其他列的均值：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(&#x27;A&#x27;).mean()</span><br></pre></td></tr></table></figure>
<ul>
<li>按多列进行分组（groupby）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df.groupby([&#x27;A&#x27;,&#x27;B&#x27;]).mean()</span><br><span class="line"></span><br><span class="line">Out[4]:</span><br><span class="line">       C</span><br><span class="line">A B</span><br><span class="line">a 1  107</span><br><span class="line">  2  102</span><br><span class="line">  3  115</span><br><span class="line">b 5   92</span><br><span class="line">  8   98</span><br><span class="line">c 2   87</span><br><span class="line">  4  104</span><br><span class="line">  9  123</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>分组后选择列进行运算</p>
<ul>
<li>仅选择B列，在 <code>groupby()</code>函数后面加个索引即可:</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">g = df.groupby(&quot;A&quot;)</span><br><span class="line">g[&#x27;B&#x27;].mean() # 仅选择B列</span><br><span class="line"></span><br><span class="line">Out[7]:</span><br><span class="line">A</span><br><span class="line">1    1.5</span><br><span class="line">2    3.0</span><br><span class="line">Name: B, dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li>选择B、C多列</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g[[&#x27;B&#x27;, &#x27;C&#x27;]].mean() # 选择B、C列</span><br></pre></td></tr></table></figure>
<ul>
<li>可以针对不同的列选用不同的聚合方法</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g.agg(&#123;&#x27;B&#x27;:&#x27;mean&#x27;, &#x27;C&#x27;:&#x27;sum&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">Out[9]:</span><br><span class="line">   B   C</span><br><span class="line">A</span><br><span class="line">1  1.5  5</span><br><span class="line">2  3.0  4</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>聚合方法</p>
<ul>
<li><code>count()</code>：nan 不会被计入</li>
<li><code>size()</code>：nan 也会被计入</li>
</ul>
</li>
<li>
<p>分组运算方法 <code>agg()</code></p>
<ul>
<li><code>agg(list)</code> 将属于同一个 group 的所有元素全部整合到一个 list 中</li>
<li><code>agg([&quot;count&quot;]).apply('list')</code></li>
<li><code>agg([&quot;max&quot;]).apply('list')</code></li>
<li><code>.groupby(by=[&quot;id_map&quot;]).hour.std()</code> group之后，选择hour列，然后计算标准差</li>
</ul>
</li>
<li>
<p><code>groupby</code>方法返回的是一个 <code>Series</code> ，无法直接输出。<br />
相当于 <code>groupby</code> 的标准列成为了索引，那么问题就转成了，索引能不能转换为数据？<br />
直接重索引即可：<code>df.reset_index()</code>，例子：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">avg_aqi.head()</span><br><span class="line">Country  Year  Month</span><br><span class="line">Albania  2022  7        32.937500</span><br><span class="line">               8        30.687500</span><br><span class="line">               9        15.565217</span><br><span class="line">         2023  1         9.000000</span><br><span class="line">Algeria  2022  7        65.000000</span><br><span class="line">Name: AQI Value, dtype: float64</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>Country  Year  Month</code> 成了索引，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">avg_aqi.reset_index().head()</span><br><span class="line">   Country  Year  Month  AQI Value</span><br><span class="line">0  Albania  2022      7  32.937500</span><br><span class="line">1  Albania  2022      8  30.687500</span><br><span class="line">2  Albania  2022      9  15.565217</span><br><span class="line">3  Albania  2023      1   9.000000</span><br><span class="line">4  Algeria  2022      7  65.000000</span><br></pre></td></tr></table></figure>
<p>直接重新索引即可</p>
<h3 id="reset_index-和-set_index"><a class="markdownIt-Anchor" href="#reset_index-和-set_index"></a> reset_index() 和 set_index()</h3>
<p>出于增强数据可读性或其他原因，我们需要对数据表的<strong>索引值</strong>进行设定。</p>
<ul>
<li>set_index</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.set_index(keys, drop=True, append=False, inplace=False, verify_integrity=False)</span><br></pre></td></tr></table></figure>
<ul>
<li>keys：列标签:str ； 或 列标签列表，创建多列索引。</li>
<li>drop：默认为True，删除用作新索引的列</li>
<li>append：是否将列附加到现有索引，默认为False。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df</span><br><span class="line">   Country  Income  Age</span><br><span class="line">0    China   10000   50</span><br><span class="line">1    China   10000   43</span><br><span class="line">2    India    5000   34</span><br><span class="line">3    India    5002   40</span><br><span class="line">4  America   40000   25</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df.set_index([&quot;Age&quot; , &quot;Income&quot;])</span><br><span class="line">            Country</span><br><span class="line">Age Income</span><br><span class="line">50  10000     China</span><br><span class="line">43  10000     China</span><br><span class="line">34  5000      India</span><br><span class="line">40  5002      India</span><br><span class="line">25  40000   America</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df.set_index(&quot;Age&quot;)</span><br><span class="line">     Country  Income</span><br><span class="line">Age</span><br><span class="line">50     China   10000</span><br><span class="line">43     China   10000</span><br><span class="line">34     India    5000</span><br><span class="line">40     India    5002</span><br><span class="line">25   America   40000</span><br><span class="line"></span><br><span class="line"># 仍然保留索引列</span><br><span class="line">&gt;&gt;&gt; df.set_index(&quot;Age&quot;, drop=False)</span><br><span class="line">     Country  Income  Age</span><br><span class="line">Age</span><br><span class="line">50     China   10000   50</span><br><span class="line">43     China   10000   43</span><br><span class="line">34     India    5000   34</span><br><span class="line">40     India    5002   40</span><br><span class="line">25   America   40000   25</span><br></pre></td></tr></table></figure>
<h3 id="拆分行合并行"><a class="markdownIt-Anchor" href="#拆分行合并行"></a> 拆分行/合并行</h3>
<h4 id="explode"><a class="markdownIt-Anchor" href="#explode"></a> explode()</h4>
<p>当 dataframe 中某一行其中一个元素是列表形式，即<strong>多个同类型的数据</strong>，若想要展开成多行进行分析，可以使用该函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.explode(self, column: Union[str, Tuple])</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df1</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c   [2, 3, 8]    1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df1.explode(&#x27;measurement&#x27;)</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c           2    1</span><br><span class="line">2  c           3    1</span><br><span class="line">2  c           8    1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df1.explode(&#x27;measurement&#x27;).reset_index(drop=True)</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c           2    1</span><br><span class="line">3  c           3    1</span><br><span class="line">4  c           8    1</span><br></pre></td></tr></table></figure>
<h2 id="内存优化"><a class="markdownIt-Anchor" href="#内存优化"></a> 内存优化</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line"><span class="comment"># inspired by https://www.kaggle.com/code/renatoreggiani/reduce-memory-usage-zzzs-cmi</span></span><br><span class="line"><span class="comment"># with tweaks determined by the selected polars loading strategy</span></span><br><span class="line"><span class="comment"># tweaks inspired by https://github.com/softhints/Pandas-Tutorials/blob/master/column/3.check-dtype-column-columns-pandas-dataframe.ipynb</span></span><br><span class="line"><span class="keyword">from</span> pandas.api.types <span class="keyword">import</span> is_datetime64_ns_dtype</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reduce_mem_usage</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; iterate through all numeric columns of a dataframe and modify the data type</span></span><br><span class="line"><span class="string">        to reduce memory usage.        </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    start_mem = df.memory_usage().<span class="built_in">sum</span>() / <span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Memory usage of dataframe is <span class="subst">&#123;start_mem:<span class="number">.2</span>f&#125;</span> MB&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">        col_type = df[col].dtype</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> col_type != <span class="built_in">object</span> <span class="keyword">and</span> <span class="keyword">not</span> is_datetime64_ns_dtype(df[col]):</span><br><span class="line">            c_min = df[col].<span class="built_in">min</span>()</span><br><span class="line">            c_max = df[col].<span class="built_in">max</span>()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">str</span>(col_type)[:<span class="number">3</span>] == <span class="string">&#x27;int&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> c_min &gt; np.iinfo(np.int8).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int8).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int8)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int16).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int16).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int16)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int32).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int32).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int32)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int64).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int64).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int64)  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> c_min &gt; np.finfo(np.float16).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.finfo(np.float16).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float16)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.finfo(np.float32).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.finfo(np.float32).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float32)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float16)</span><br><span class="line"></span><br><span class="line">    end_mem = df.memory_usage().<span class="built_in">sum</span>() / <span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Memory usage after optimization is: <span class="subst">&#123;end_mem:<span class="number">.2</span>f&#125;</span> MB&#x27;</span>)</span><br><span class="line">    decrease = <span class="number">100</span> * (start_mem - end_mem) / start_mem</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Decreased by <span class="subst">&#123;decrease:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">train_series = reduce_mem_usage(train_series)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mts = dict(zip(range(1,13), [month%12 // 3 + 1 for month in range(1, 13)]))</span><br><span class="line">target[&#x27;season&#x27;] = target.timestamp.dt.month.map(mts) </span><br><span class="line"></span><br><span class="line"># 1 -&gt; winter</span><br><span class="line"># 2 -&gt; spring</span><br><span class="line"># 3 -&gt; summer</span><br><span class="line"># 4 -&gt; fall</span><br><span class="line"></span><br><span class="line">target[&#x27;dayofweek&#x27;] = target.timestamp.dt.dayofweek</span><br><span class="line">target[&#x27;weekend&#x27;] = target.timestamp.dt.dayofweek &gt; 4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="others"><a class="markdownIt-Anchor" href="#others"></a> Others</h2>
<h3 id="pandas-文件处理"><a class="markdownIt-Anchor" href="#pandas-文件处理"></a> pandas 文件处理</h3>
<p>注意一些方法即可：</p>
<ol>
<li><code> pd.read_csv(文件名)</code>：默认分隔符为逗号</li>
</ol>
<p>参数：</p>
<ul>
<li><code>nrows</code>：需要读取的行数，从前向后</li>
<li><code>skiprows : int, list of int or Callable, optional</code>：需要跳过的行数</li>
<li><code>header</code> ： 通过设置 <code>header=None</code> 可以从第一行开始读取，后续通过 <code>df.columns = [col1, col2 ,...]</code> 来设置 columns 。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">my_csv = pd.read_csv(&quot;test.csv&quot;);</span><br><span class="line">print(my_csv)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">  Unnamed: 0  one  two</span><br><span class="line">0          a  1.0    2</span><br><span class="line">1          b  2.0    1</span><br><span class="line">2          c  3.0    3</span><br><span class="line">3          d  NaN    4</span><br></pre></td></tr></table></figure>
<ul>
<li>会出现Unnamed，这是因为他把行索引当成了单独的一列。可以用利用参数<code>index_col=0</code>将第0列作为索引。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(pd.read_csv(&quot;test.csv&quot;, index_col=0))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a  1.0    2</span><br><span class="line">b  2.0    1</span><br><span class="line">c  3.0    3</span><br><span class="line">d  NaN    4</span><br></pre></td></tr></table></figure>
<ul>
<li>除此之外，<code>index_col</code>也可以传入列名称，将某列设置为索引。</li>
<li>使用<code>parse_dates = [列表名]</code>，将该列元素解析为datetime对象。</li>
<li>如果文件没有第一行，<code>header=None, names=[列的名称]</code></li>
<li>注意在识别中，会令一整列都识别为同一种类型。在csv中，NaN可以被识别为浮点数，但是none或者其他数值会被识别为字符串形式。使用<code>na_values=[]</code>参数来指定列表中的某些数值被识别为NaN。</li>
</ul>
<ol start="2">
<li><code>pd.read_table(文件名)</code>：默认分隔符为制表符</li>
<li><code>dataFrame.to_csv(文件名)</code>：写入到文件<br />
参数：
<ul>
<li><code>sep</code> 指定的文件分隔符号，默认为逗号</li>
<li><code>na_rep</code> 缺失值转换的字符串，默认为空字符串</li>
<li><code>header = False</code> 不输出列名称一行</li>
<li><code>index = False</code> 不输出行索引一列</li>
<li><code>cols/columns</code> 指定输出的列，传入列表</li>
</ul>
</li>
</ol>
<h3 id="警告-settingwithcopywarning"><a class="markdownIt-Anchor" href="#警告-settingwithcopywarning"></a> 警告 SettingWithCopyWarning</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SettingWithCopyWarning:</span><br><span class="line">A value is trying to be set on a copy of a slice from a DataFrame</span><br></pre></td></tr></table></figure>
<p>后果是可能导致<strong>修改pandas 单元格中的数据失败</strong>。</p>
<p>原理：当前操作的dataframe是从其他dataframe得到的，不是最初始的dataframe。因此，最好是在原始的dataframe上进行操作，这样就不报警告了。</p>
<p>Pandas 中的某些操作可以返回：</p>
<ul>
<li>数据的视图（View），即一份拷贝对象，共享数据地址，</li>
<li>数据的副本（Copy），即重新创建了一个不同的地址的新对象</li>
</ul>
<p>当 Pandas 检测链式赋值（Chained assignment）时会生成警告，让我们定义一些术语，方便后续的解释：</p>
<ul>
<li>赋值（Assignment） - 设置/更改某些变量值的操作，也被称为设置（set） 。</li>
<li>访问（Access） - 返回某些值的操作，例如下面的索引和链式索引示例。也被称为获取（get） 。</li>
<li>索引（Indexing） - 引用数据子集的任何赋值或访问方法，例如 data[1:5] 。</li>
<li>链式索引（Chaining） - 连续使用多个索引操作，例如data[1:5][1:3] 。</li>
</ul>
<br>
<p>链式赋值（Chained assignment） 是指<strong>链式索引和赋值的组合</strong>，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.bidder == &#x27;parakeet2004&#x27;][&#x27;bidderrate&#x27;] = 100</span><br></pre></td></tr></table></figure>
<p>如果检查一下，可以看到在这种情况下，值没有按预期改变。</p>
<p>是因为这个操作首先进行了索引，然后进行了赋值，但是没有在原始 DataFrame 上运行。</p>
<p>我们可以使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data.bidder == &#x27;parakeet2004&#x27;, &#x27;bidderrate&#x27;] = 100</span><br></pre></td></tr></table></figure>
<p>下面看另一种情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winners = data.loc[data.bid == data.price]</span><br><span class="line">winners.loc[304, &#x27;bidder&#x27;] = &#x27;therealname&#x27;</span><br></pre></td></tr></table></figure>
<p>代码按预期工作了，还是爆出警告，SettingWithCopyWarning！但我们使用了 <code>loc</code> 呀，</p>
<p>因为 winners 是作为 get 操作的输出创建的（data.loc[data.bid == data.price]），它可能是原始 DataFrame 的副本，也可能不是，但除非我们检查，否则我们不能了解到。当我们对 winners 进行索引时，我们实际上使用的是链式索引。</p>
<p>为了防止这种情况下的警告，解决方案是在创建新 DataFrame 时明确告知 Pandas 制作一个副本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winners = data.loc[data.bid == data.price].copy()</span><br><span class="line">winners.loc[304, &#x27;bidder&#x27;] = &#x27;therealname&#x27;</span><br></pre></td></tr></table></figure>
<p>所以，解决方法：</p>
<ol>
<li>如果要更改原始数据，请使用单一赋值操作。</li>
<li>如果你想要一个副本，请确保你强制让 Pandas 制作副本。</li>
</ol>
<br>
<p>定位：<br />
在代码的开头加上这两句，将警告升级为error，就会定位到出warning的地方啦：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import warnings</span><br><span class="line">warnings.filterwarnings(&#x27;error&#x27;)</span><br></pre></td></tr></table></figure>
<p>完整内容：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42575020/article/details/98846427">https://blog.csdn.net/weixin_42575020/article/details/98846427</a></p>
<h3 id="数据可视化"><a class="markdownIt-Anchor" href="#数据可视化"></a> 数据可视化</h3>
<p>draw correlation</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(50, 50))</span><br><span class="line">corr = df_imputed.corr()</span><br><span class="line">sns.heatmap(corr, cmap=&quot;YlGnBu&quot;, annot=True)</span><br><span class="line">plt.title(&#x27;Correlation Heatmap&#x27;, fontsize=30)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>box plot</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(20, 9))</span><br><span class="line">df[idxs].boxplot()</span><br><span class="line">plt.title(&#x27;Box Plot&#x27;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pandas/pandas%20%20Nan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Pandas/pandas%20%20Nan/" class="post-title-link" itemprop="url">pandas  Nan</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/" itemprop="url" rel="index"><span itemprop="name">Data Analysis Package</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/Pandas/" itemprop="url" rel="index"><span itemprop="name">Pandas</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>133</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="单个元素"><a class="markdownIt-Anchor" href="#单个元素"></a> 单个元素</h1>
<p>特殊类型 <code>na=np.nan</code></p>
<ul>
<li>不可以直接用来判断的方式，即以下结果和我们预期不一样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">na == np.nan  # False</span><br><span class="line">bool(na)  # True</span><br><span class="line">if na:</span><br><span class="line">    print(&#x27;na is not null&#x27;)  # Output: na is not null</span><br></pre></td></tr></table></figure>
<ul>
<li>使用专用函数判断单个元素（可以用于 map<br />
对于pandas中空值的判断，我们只能通过pandas或者numpy的函数，不能用python的内置函数any或all判断。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pd.isnull(na)  # True</span><br><span class="line">pd.isna(na)  # True</span><br><span class="line">np.isnan(na)  # True</span><br></pre></td></tr></table></figure>
<h1 id="强制转换数据类型"><a class="markdownIt-Anchor" href="#强制转换数据类型"></a> 强制转换数据类型</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dfx[[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]] = dfx[[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]].astype(&#x27;float32&#x27;)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Sklearn/sklearn%20Model_Selection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Sklearn/sklearn%20Model_Selection/" class="post-title-link" itemprop="url">sklearn Model_Selection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Sklearn/" itemprop="url" rel="index"><span itemprop="name">Sklearn</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>651</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><font size=6>sklearn.Model_Selection</font></p>
<h2 id="train_test_split"><a class="markdownIt-Anchor" href="#train_test_split"></a> train_test_split()</h2>
<p>将数组或矩阵拆分为随机训练和测试子集</p>
<h3 id="方法参数"><a class="markdownIt-Anchor" href="#方法参数"></a> 方法参数</h3>
<ul>
<li><code>*arrays</code>：序列或者可以索引的对象列表</li>
<li><code>test_size = None</code>：float or int, default=None。
<ul>
<li>float：[0.0, 1.0]，表示测试集比例</li>
<li>int：测试集样本数</li>
<li>None：为<code>train_size</code>的补集</li>
<li>如果两者都没设置，则默认<code>0.25</code></li>
</ul>
</li>
<li><code>train_size = None</code></li>
<li><code>random_state = None</code>：int, RandomState instance or None<br />
split前的shuffle方式</li>
<li><code>shuffle =True</code></li>
<li><code>stratify</code>：array-like, default=None</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/02/08/Coding/Sklearn/sklearn%20Model_Selection/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pytorch_lightning/1.%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Pytorch_lightning/1.%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">Pytorch_lightning 1.intro</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Pytorch-Lightning/" itemprop="url" rel="index"><span itemprop="name">Pytorch Lightning</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>10 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>pytorch_lightning</code> 库<br />
reference： <a target="_blank" rel="noopener" href="https://blog.csdn.net/u013250861/article/details/123591130"></a></p>
<p>和 <code>torch</code> 版本匹配：<a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/latest/versioning.html#pytorch-support">Compatibility matrix</a></p>
<p>代码类型分类：</p>
<ol>
<li>研究代码（ model，loss，optimizer ） -&gt; <code>pytorch_lightning.LightningModule</code></li>
<li>工程代码（ early stopping、16位精度、GPUs分布训练 ） -&gt; <code>pytorch_lightning.Trainer</code></li>
<li>非必要代码（ log，tensor board ） -&gt; <code>EarlyStopping.callbacks</code></li>
</ol>
<h1 id="lightningmodule"><a class="markdownIt-Anchor" href="#lightningmodule"></a> LightningModule</h1>
<p>是 <code>torch.nn.Module</code> 的子类，本质上也是一个模型，但不同的是，<code>LightningModule</code> 围绕 <code>torch.nn.Module</code> 做了很多功能性的补充：</p>
<ol>
<li>模型</li>
<li>训练/验证/测试 数据</li>
<li>优化器</li>
<li>训练/验证/测试 计算</li>
</ol>
<p>一般我们是自定义一个类继续继承 LightningModule 类</p>
<p>重要方法：<br />
<code>**_step</code>,<code>on_**_batch/epoch_start</code>,<code>on_**_batch/epoch_end</code>, …</p>
<p>封装流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">outs = []</span><br><span class="line">for batch in data:</span><br><span class="line">    out = training_step(batch)</span><br><span class="line">    outs.append(out)</span><br><span class="line">on_train_epoch_end(outs)</span><br></pre></td></tr></table></figure>
<h2 id="lightningmoduleinit"><a class="markdownIt-Anchor" href="#lightningmoduleinit"></a> LightningModule.<strong>init</strong>()</h2>
<p>即然 <code>LightningModule</code> 仍然是一个模型，那么仍然需要初始化模型结构，也可以重写 <code>forward()</code> 方法，在推理时使用。</p>
<h2 id="训练时不需要生命直接使用的监控参数"><a class="markdownIt-Anchor" href="#训练时不需要生命直接使用的监控参数"></a> 训练时不需要生命直接使用的监控参数</h2>
<p><code>self.current_epoch</code></p>
<h2 id="training_stepself-batch-batch_idx"><a class="markdownIt-Anchor" href="#training_stepself-batch-batch_idx"></a> training_step(self, batch, batch_idx)</h2>
<p>输入参数为：<br />
batch 为从 train_dataloader 中返回的每一个 batch 的数据，已经被放入 <code>device</code> 中了，batch 中不一定全都是Tensor，还可以是别的，他会默认将所有 <code>Torch.Tensor</code> 类型数据 放入 device 中。<br />
batch_idx 为目前 batch 的索引。</p>
<p>返回值：<br />
Tensor - The loss tensor ，代码内部会自动调用这个返回 loss 的 <code>loss.backward()</code><br />
dict - A dictionary. Can include any keys, but must include the key ‘loss’ -&gt; <code>loss.backward()</code>，没loss这个batch就被跳过了。<br />
None - Training will skip to the next batch，没loss这个batch就被跳过了。</p>
<h2 id="validation_stepself-batch-batch_idx"><a class="markdownIt-Anchor" href="#validation_stepself-batch-batch_idx"></a> validation_step(self, batch, batch_idx)</h2>
<p>可以没有返回值<br />
使用 <code>self.log(&quot;val_loss&quot;, val_loss)</code> 来标记该loss，当然也可以是一些评价指标，用于指导 <a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/stable/api/lightning.pytorch.callbacks.ModelCheckpoint.html#modelcheckpoint">ModelCheckpoint</a> 来保存模型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 初始化`ModelCheckpoint`回调，并设置要监控的量</span><br><span class="line">checkpoint_callback = ModelCheckpoint(monitor=&#x27;val_loss&#x27;)</span><br><span class="line"></span><br><span class="line"># 将该callback 放到 callback list 中，作为参数传入</span><br><span class="line">trainer = Trainer(callbacks=[checkpoint_callback])</span><br></pre></td></tr></table></figure>
<h2 id="test_stepself-batch-batch_idx"><a class="markdownIt-Anchor" href="#test_stepself-batch-batch_idx"></a> test_step(self, batch, batch_idx)</h2>
<p>模型在训练时候，是不会进行 test 的，需要我们自己手动调用。<br />
即通过模型的 <code>trainer.test(model=autoencoder, dataloaders=test_loader)</code> 方法进行。</p>
<h2 id="configure_optimizers-优化器定义"><a class="markdownIt-Anchor" href="#configure_optimizers-优化器定义"></a> configure_optimizers: 优化器定义</h2>
<p>返回一个优化器，或数个优化器，或两个List（优化器，Scheduler）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def configure_optimizers(self):</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    return opt # 自动调用返回的一个 optimizer</span><br><span class="line"></span><br><span class="line">    return generator_opt, disriminator_opt # 依次调用两个 optimizer</span><br><span class="line"></span><br><span class="line">    return [gen_opt, dis_opt], [gen_sched, dis_sched]  # optimizer 和 scheduler 的情况</span><br></pre></td></tr></table></figure>
<h1 id="trainer"><a class="markdownIt-Anchor" href="#trainer"></a> Trainer</h1>
<p>default_root_dir：默认存储地址。所有的实验变量和权重全部会被存到这个文件夹里面。推荐是，每个模型有一个独立的文件夹。每次重新训练会产生一个新的version_x子文件夹。</p>
<p>max_epochs：最大训练周期数。trainer = Trainer(max_epochs=1000)<br />
min_epochs：至少训练周期数。当有Early Stop时使用。<br />
auto_scale_batch_size：在进行任何训练前自动选择合适的batch size。<br />
precision : int：精确度。正常是32，使用16可以减小内存消耗<br />
fast_dev_run : bool： 如果设定为true，会只执行一个batch的train, val 和 test，然后结束。仅用于debug。</p>
<p>enable_progress_bar=True：tqdm 输出，默认开始，还是关上吧，太丑了，<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/59455268/how-to-disable-progress-bar-in-pytorch-lightning">同时自己带的这种log方式本身就有 bug</a> ，没必要用。<br />
logger=True：是否使用默认的 logger ，并且保存，我选择不！见上条，一起给关了。但是关上后还是可以用 <code>log</code>方法控制 hook，只是不输出了，只需要保留 <code>validation_step</code> 的 <code>self.log(key,val)</code> 就行了。</p>
<h2 id="构造函数"><a class="markdownIt-Anchor" href="#构造函数"></a> 构造函数</h2>
<p>调用 <code>pl.Trainer()</code> 实例，参数为：</p>
<h2 id="eval"><a class="markdownIt-Anchor" href="#eval"></a> eval</h2>
<h3 id="频率"><a class="markdownIt-Anchor" href="#频率"></a> 频率</h3>
<p>默认为每1个epoch校验一次 : <code>trainer = Trainer(check_val_every_n_epoch=1)</code><br />
每训练单个epoch的 25% 校验一次（传入float）:  <code>trainer = Trainer(val_check_interval=0.25)</code><br />
每训练100个batch校验一次（传入int）： <code>trainer = Trainer(val_check_interval=100)</code><br />
每次 eval 时，使用多少 eval 数据： <code>val_percent_check=1.0</code> 默认 1.0 ， 可以使用一个 float 类型变量表示百分比。</p>
<h3 id="sanity-check"><a class="markdownIt-Anchor" href="#sanity-check"></a> Sanity Check</h3>
<p><a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/latest/common/trainer.html#num-sanity-val-steps">https://lightning.ai/docs/pytorch/latest/common/trainer.html#num-sanity-val-steps</a><br />
for the bug: <a target="_blank" rel="noopener" href="https://github.com/mindslab-ai/faceshifter/issues/5">https://github.com/mindslab-ai/faceshifter/issues/5</a><br />
默认情况下，会在训练开始之前进行 2 steps of validation ，来确保 valid 是正确的，防止训练后 eval 程序出现 bug ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># default used by the Trainer</span><br><span class="line">trainer = Trainer(num_sanity_val_steps=2)</span><br><span class="line"></span><br><span class="line"># turn it off</span><br><span class="line">trainer = Trainer(num_sanity_val_steps=0)</span><br><span class="line"></span><br><span class="line"># check all validation data</span><br><span class="line">trainer = Trainer(num_sanity_val_steps=-1)</span><br></pre></td></tr></table></figure>
<p>但是我训练时候出现bug，数据量大时卡住，于是设置为 0。 -&gt;  <a target="_blank" rel="noopener" href="https://github.com/mindslab-ai/faceshifter/issues/5">https://github.com/mindslab-ai/faceshifter/issues/5</a></p>
<h2 id="datasets-设定"><a class="markdownIt-Anchor" href="#datasets-设定"></a> datasets 设定</h2>
<p>如果自行设定 dataloader 的话，需要在 fit 方法中调用参数 <code>train_dataloaders</code> 和 <code>val_dataloaders</code>:<br />
<code>trainer.fit(autoencoder, train_dataloaders=train_loader, val_dataloaders=valid_loader)</code></p>
<h1 id="checkpoint"><a class="markdownIt-Anchor" href="#checkpoint"></a> checkpoint</h1>
<p>ckpt内部保存了：<br />
16-bit scaling factor (if using 16-bit precision training)<br />
Current epoch<br />
Global step<br />
LightningModule’s state_dict<br />
State of all optimizers<br />
State of all learning rate schedulers<br />
State of all callbacks (for stateful callbacks)<br />
State of datamodule (for stateful datamodules)<br />
The hyperparameters (init arguments) with which the model was created<br />
The hyperparameters (init arguments) with which the datamodule was created<br />
State of Loops</p>
<p>Trainer 自动保存最后一个 epoch 结束的模型</p>
<p>直接使用 <code>MyLightningModule.load_from_checkpoint(path.ckpt)</code> 来读取模型，在直接读取时，还可以传入 <code>__init__</code> 的参数来覆盖重写保存的参数。</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLightningModule</span>(<span class="title class_ inherited__">LightningModule</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, learning_rate, another_parameter, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.save_hyperparameters()  <span class="comment"># 自动保存传入的参数到 checkpoint 字典中 --&gt; checkpoint[&quot;hyper_parameters&quot;]</span></span><br></pre></td></tr></table></figure>
<p>注意，最好加上 <code>self.save_hyperparameters()</code>：saves the arguments passed into the LightningModule init<br />
这样直接 <code>model = MyLightningModule.load_from_checkpoint(checkpoint_path=&quot;epoch=1-step=1760.ckpt&quot;)</code> 就行了，不然后面容易出现 bug 。</p>
<p>Resume training state，重新开始训练：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = LitModel()</span><br><span class="line">trainer = Trainer()</span><br><span class="line"></span><br><span class="line"># automatically restores model, epoch, step, LR schedulers, etc...</span><br><span class="line">trainer.fit(model, ckpt_path=&quot;some/path/to/my_checkpoint.ckpt&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="比较"><a class="markdownIt-Anchor" href="#比较"></a> 比较</h2>
<ol>
<li>
<p>不加 <code>save_weights_only=True</code>，不加<code>self.save_hyperparameters()</code><br />
epoch, global_step, pytorch-lightning_version, state_dict, loops<br />
callbacks, optimizer_states, lr_schedulers</p>
</li>
<li>
<p>加 <code>save_weights_only=True</code>，不加<code>self.save_hyperparameters()</code><br />
epoch, global_step, pytorch-lightning_version, state_dict, loops</p>
</li>
<li>
<p>不加 <code>save_weights_only=True</code>，加<code>self.save_hyperparameters()</code><br />
epoch, global_step, pytorch-lightning_version, state_dict, loops +<br />
callbacks, optimizer_states, lr_schedulers,<br />
hparams_name, hyper_parameters</p>
</li>
<li>
<p>加 <code>save_weights_only=True</code>，加<code>self.save_hyperparameters()</code><br />
epoch, global_step, pytorch-lightning_version, state_dict, loops +<br />
hparams_name, hyper_parameters</p>
</li>
</ol>
<p>结论：<br />
<code>self.save_hyperparameters()</code> -》  +<code>hparams_name</code>, <code>hyper_parameters</code> ，不受 <code>save_weights_only</code> 控制<br />
<code>save_weights_only=True</code> -》 -<code>callbacks, optimizer_states, lr_schedulers</code> ，不受 <code>self.save_hyperparameters()</code> 控制</p>
<p>不加 <code>save_weights_only=True</code> 是为了保存训练相关配置信息，得以继续训练。<br />
加<code>self.save_hyperparameters()</code> 是为了能够直接初始化模型（ 很建议加上去 ），lightning load 权重比较麻烦，见下文。</p>
<h2 id="加载模型的几种方法"><a class="markdownIt-Anchor" href="#加载模型的几种方法"></a> 加载模型的几种方法</h2>
<p>因为上面没有加  <code>self.save_hyperparameters()</code> ，导致只保存了模型参数，而没有保存其他的初始化参数，导致需要先初始化模型，然后根据 ckpt 更新参数。</p>
<h3 id="方法-1"><a class="markdownIt-Anchor" href="#方法-1"></a> 方法 1</h3>
<p>两段式方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">autoencoder = PLModelload_from_checkpoint(checkpoint_path=&quot;checkpoints/epoch=1-step=1760.ckpt&quot;,  # 然后导入，注意需要穿入 超参数</span><br><span class="line">                                encoder=encoder,</span><br><span class="line">                                hyper_parameters=hyper_parameters,</span><br><span class="line">                                handshaking_tagger=handshaking_tagger,</span><br><span class="line">                                tag_size=tag_size)</span><br></pre></td></tr></table></figure>
<p>先使用 ckpt 创建，然后使用传入的参数覆盖。</p>
<h3 id="方法2"><a class="markdownIt-Anchor" href="#方法2"></a> 方法2</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">autoencoder = LitAutoEncoder(encoder, hyper_parameters, handshaking_tagger, tag_size) <span class="comment"># 首先初始化</span></span><br><span class="line">autoencoder.load_state_dict(checkpoint[<span class="string">&quot;state_dict&quot;</span>])</span><br><span class="line"><span class="comment"># list(autoencoder.rel_extractor.encoder.parameters())[-1][:10] # for test</span></span><br></pre></td></tr></table></figure>
<p>使用最原始的方式进行导入</p>
<h1 id="log和return-loss到底在做什么"><a class="markdownIt-Anchor" href="#log和return-loss到底在做什么"></a> Log和return loss到底在做什么</h1>
<p>training_step，还是validation_step，test_step返回值都是loss，或者包含 loss 的字典。</p>
<p>返回的loss</p>
<ol>
<li>用于进行反向传播 ( train 中 )</li>
<li>会被默认用一个list收集起来 （用于 xxx_epoch_end 中的汇总 log） 。</li>
</ol>
<p>现在改版(v2.0.0)了，无法使用 <code>training_epoch_end</code> ，需要自己手动去放入到一个字典中。</p>
<p>而 <code>self.log</code> 则是针对 TensorBoard（默认方式） 的输出，同时用于指导ModelCheckpoint。<br />
是TensorBoard等log记录器，对于每个log的标量，都会有一个相对应的横坐标，它可能是batch number或epoch number。而on_step就表示把这个log出去的量的横坐标表示为当前batch，而on_epoch则表示将log的量在整个epoch上进行累积后log，横坐标为当前epoch。</p>
<p><code>return log_dict</code>：和log函数唯一的区别就是，name和value变量由一个字典替换。表示同时log多个值。如：<br />
python values = {‘loss’: loss, ‘acc’: acc, …, ‘metric_n’: metric_n} self.log_dict(values)</p>
<p>方法参数：</p>
<ul>
<li><code>n_step</code>就表示把这个log出去的量的横坐标表示为当前batch，而<code>on_epoch</code>则表示将log的量在整个epoch上进行累积后log，横坐标为当前epoch。</li>
<li><code>reduce_fx</code>： 在 <code>training_step</code> 调用时，每次调用都会将当前步的结构进行存储/打印<br />
而 <code>validation_step, test_step</code>调用时，会存储起来，在 epoch 结束时打印一次平均，如果不想平均，则可以通过 <code>reduce_fx</code> 参数进行设置：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># default function</span><br><span class="line">self.log(..., reduce_fx=&quot;mean&quot;)  # &#123;min,max,sum&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>batch_size</code>：在设置<code>on_epoch</code>时，操作的底数是什么。</li>
<li><code>enable_graph=False</code>：是否同时保留计算图</li>
<li><code>prog_bar</code>：是否也在命令行显示出来</li>
</ul>
<h1 id="gpu-设置"><a class="markdownIt-Anchor" href="#gpu-设置"></a> GPU 设置</h1>
<p><a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/stable/accelerators/gpu.html">https://lightning.ai/docs/pytorch/stable/accelerators/gpu.html</a></p>
<p>通过 Trainer 的三个参数进行设置，默认情况下为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># run on as many GPUs as available by default</span><br><span class="line">trainer = Trainer(accelerator=&quot;auto&quot;, devices=&quot;auto&quot;, strategy=&quot;auto&quot;)</span><br><span class="line"># equivalent to</span><br><span class="line">trainer = Trainer()</span><br></pre></td></tr></table></figure>
<p><code>devices</code>：设置使用哪些设备，详见：<a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/stable/accelerators/gpu_basic.html#choosing-gpu-devices">Choosing GPU devices</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pytorch_lightning/2.Callbacks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Pytorch_lightning/2.Callbacks/" class="post-title-link" itemprop="url">Pytorch_lightning 2.Callbacks</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Pytorch-Lightning/" itemprop="url" rel="index"><span itemprop="name">Pytorch Lightning</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>101</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="earlystopping"><a class="markdownIt-Anchor" href="#earlystopping"></a> EarlyStopping</h1>
<p>默认在每一个  validation epoch 结束后进行判断</p>
<p><code>from lightning.pytorch.callbacks.early_stopping import EarlyStopping</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EarlyStopping(monitor=&quot;val_loss&quot;, mode=&quot;min&quot;)</span><br><span class="line">EarlyStopping(monitor=&quot;val_accuracy&quot;, min_delta=0.00, patience=3, verbose=False, mode=&quot;max&quot;)</span><br></pre></td></tr></table></figure>
<p>额外的参数：</p>
<ol>
<li>stopping_threshold，一旦被监控的目标大于等于这个值，终止训练</li>
<li>divergence_threshold，一旦被监控的目标小于等于这个值，终止训练</li>
<li>check_finite，当被监控的值为 NaN 或者 infinite 时，终止训练</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Python/functools%E5%B7%A5%E5%85%B7%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Python/functools%E5%B7%A5%E5%85%B7%E5%8C%85/" class="post-title-link" itemprop="url">functools工具包</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Coding/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>146</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaobingqianrui/p/8606410.html">Python之functools库</a></p>
<p>用途：操作其他函数的函数。</p>
<h1 id="partial"><a class="markdownIt-Anchor" href="#partial"></a> partial</h1>
<p>当一个函数有很多参数，但是其中一部分参数的值在每次调用时都是一样的，这时可以使<code>partial</code>类对其封装，来预先设定/冻结这些参数的值。<br />
有点像动态地设置函数的形式参数的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from functools import partial</span><br><span class="line">def fun(arg1, arg2,arg3,arg4):</span><br><span class="line">    return arg1+arg2+arg3+arg4</span><br><span class="line"></span><br><span class="line"># 如果参数arg1, arg2, arg3 一直保持不变，可以使用</span><br><span class="line"># 使用partial对象将这些不变的参数冻结起来</span><br><span class="line">nochangeparm = partial(fun,1,2,3)</span><br><span class="line">print (nochangeparm(4))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 10</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Numpy/numpy%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/Coding/Numpy/numpy%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/" class="post-title-link" itemprop="url">numpy库的简单讲解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 20:34:45" itemprop="dateCreated datePublished" datetime="2021-02-08T20:34:45-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/" itemprop="url" rel="index"><span itemprop="name">Data Analysis Package</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/Numpy/" itemprop="url" rel="index"><span itemprop="name">Numpy</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="numpy-n维数组容器"><a class="markdownIt-Anchor" href="#numpy-n维数组容器"></a> Numpy: N维数组容器</h3>
<p>引入了ndarray-多维数组的概念，可用于储存和处理大型矩阵。</p>
<h3 id="一些基本操作"><a class="markdownIt-Anchor" href="#一些基本操作"></a> 一些基本操作：</h3>
<h4 id="导入numpy库"><a class="markdownIt-Anchor" href="#导入numpy库"></a> 导入numpy库：</h4>
<p><code>import numpy as np</code></p>
<h4 id="创建ndarray对象"><a class="markdownIt-Anchor" href="#创建ndarray对象"></a> 创建ndarray对象：</h4>
<ol>
<li><code>np.array(列表)</code><br />
输入列表，并返回其ndarray形式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [random.uniform(100.0, 200) for i in range(10)]</span><br><span class="line">a = np.array(a)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>
<p><code>np.arange()</code><br />
参数：<br />
a. 1个参数a，生成0到a-1的列表<br />
b. 2个参数a,b，生成a到b-1的列表<br />
c. 3个参数a,b,c，生成a到b-1的列表，步长为c</p>
</li>
<li>
<p><code>np.linspace(起始值，终结值，元素数量)</code>可以将元素均匀分布</p>
</li>
<li>
<p><code>zeros(),ones(),empty()</code><br />
参数：<br />
a. 长度，必需<br />
b. dtype=“”，非必选<br />
empty()生成的其元素是任意值，等待被赋值。</p>
</li>
</ol>
<h4 id="ndarray对象的一些基本属性"><a class="markdownIt-Anchor" href="#ndarray对象的一些基本属性"></a> ndarray对象的一些基本属性：</h4>
<ol>
<li>shape：尺寸</li>
<li>dtype：内部元素的数据类型</li>
<li>T：自身的转置矩阵<br />
<img src="http://i1.fuimg.com/733078/ec7dde96d174a479.jpg" alt="Markdown" /></li>
</ol>
<ul>
<li>批量运算：<br />
<img src="http://i1.fuimg.com/733078/ea4fa165e149d011.jpg" alt="Markdown" /></li>
</ul>
<h4 id="一些常用的方法"><a class="markdownIt-Anchor" href="#一些常用的方法"></a> 一些常用的方法：</h4>
<ol>
<li>
<p><code>sum()</code>： 返回所有元素的和</p>
</li>
<li>
<p>ndarray数组截取：</p>
<ul>
<li><strong>索引截取</strong>：<code>被截取数组[起始索引:结尾索引:步长]</code></li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(20)</span><br><span class="line">c = a[0:15:3]</span><br><span class="line">print(c) --&gt; [ 0  3  6  9 12 15]</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：<br />
不包含结尾索引。<br />
numpy的截取是一个指针指向原数组，不会重新开辟内存。所以改变截取数组也会改变原数组。可以使用copy()来操作，不影响原数组。</li>
<li>多维数组的截取：<code>被截取数组[行切片，列切片]</code></li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(15).reshape((3,5))</span><br><span class="line">print(a)</span><br><span class="line">print(a[0:2, 0:2])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[[ 0  1  2  3  4]</span><br><span class="line">[ 5  6  7  8  9]</span><br><span class="line">[10 11 12 13 14]]</span><br><span class="line"></span><br><span class="line">[[0 1]</span><br><span class="line">[5 6]]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>布尔型截取</strong>：传入一个相同长度的布尔形式的数组索引，过滤，返回对应值为true的值的数组.<br />
可以使用批量处理和布尔型截取来筛选数据，注意多个条件使用：并且-&gt;(条件1)&amp;(条件2) ；或-&gt;(条件1)|(条件2)</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [random.randint(1, 10) for i in range(10)]</span><br><span class="line">a = np.array(a)   --&gt; [ 2  1  9  5 10  1  6  9  9  3]</span><br><span class="line">print(a)</span><br><span class="line"># 多个条件使用：1. 并且 (条件1)&amp;(条件2) 2. 或 (条件1)|(条件2)</span><br><span class="line">print(a[(a&gt;5) &amp; (a%2==0)]) --&gt;[ 2  1  9  5 10  1  6  9  9  3]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>花式索引</strong>：传入一个索引的列表 (列表套列表)</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a =np.arange(10)       --&gt; [0 1 2 3 4 5 6 7 8 9]</span><br><span class="line">b = a[ [1,3,4,6,7] ]     --&gt; [1 3 4 6 7]</span><br></pre></td></tr></table></figure>
<ul>
<li>可以使用这三种索引方式组合来索引多维数组</li>
</ul>
</li>
<li>
<p><code>copy()</code>：复制某个数组，对复制数组修改不会影响原数组。</p>
</li>
<li>
<p><code>reshape(size的元祖数量)</code>：改变矩阵尺寸</p>
</li>
<li>
<p><code>np.abs()</code>：返回ndarray每个元素绝对值的数组</p>
</li>
<li>
<p><code>np.sqrt()</code>：返回开方，负数开方为nan</p>
</li>
<li>
<p><code>np.round()/ np.rint()</code>：每个元素四舍五入</p>
</li>
<li>
<p><code>np.trunc()</code>：向0取整</p>
</li>
<li>
<p><code>np.floor() 和  np.ceil()</code>：向下和向上取整</p>
</li>
<li>
<p><code>np.modf()</code>：返回整数和小数部分数组，共返回2个元素</p>
</li>
<li>
<p><code>np.isnan</code>：判断是否为一个数字</p>
</li>
<li>
<p><code>np.inf</code>表示最大的数，通常是被除数为0的结果。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([3,4,5,6,7])</span><br><span class="line">b = np.array([3,0,0,0,7])</span><br><span class="line">print(a/b) --&gt; [ 1. inf inf inf  1.]</span><br></pre></td></tr></table></figure>
<ol start="13">
<li><code>np.var()</code>方差 <code>np.std()</code>标准差</li>
<li><code>np.max() np.min()</code>, <code>np.argmax()</code>返回最大数的下标, <code>np.argmin()</code>返回最小值的下标</li>
</ol>
<h3 id="np中的random库"><a class="markdownIt-Anchor" href="#np中的random库"></a> np中的random库</h3>
<p>作用：可以用于生成随机数组<br />
参数：前两个参数为随机区间，最后一个为数组的尺存(可以是一个元组)<br />
方法：</p>
<ol>
<li><code>randint(x,y,size)</code> 生成随机整数，[x, y)</li>
<li><code>rand()</code> 生成0到1的随机数，<code>rand(x)</code>生成生成0到1的x个元素的一维数组，<code>rand(x,y)</code>生成x*y的数组</li>
<li><code>randn()</code>以给定的形状创建一个数组，数组元素来符合标准正态分布N(0,1)</li>
<li><code>choice(x,y)</code> 从数组x中随机选择元素，生成y尺寸大小的数组</li>
</ol>
<h4 id="numpyrandomrandomstate"><a class="markdownIt-Anchor" href="#numpyrandomrandomstate"></a> numpy.random.RandomState()</h4>
<p>为一个伪随机数生成器</p>
<blockquote>
<p>伪随机数是用确定性的算法计算出来的似来自[0,1]均匀分布的随机数序列。并不真正的随机，但具有类似于随机数的统计特征，如均匀性、独立性等。(摘自《百度百科》)</p>
</blockquote>
<p>直接传入数字，只要数字相同，则生成数相同。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/32/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><span class="page-number current">33</span><a class="page-number" href="/page/34/">34</a><a class="extend next" rel="next" href="/page/34/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">A foolish, slow learner.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">338</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/YiandLi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;YiandLi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/yiliiiii" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yiliiiii" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">578k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">48:11</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
