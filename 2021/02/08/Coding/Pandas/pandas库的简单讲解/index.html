<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;583d83f1ff81 导入pandas库： import pandas as pd   其他点  注意 dp 中的 nan，应该用  np.nan 来指定   Series  创建 1pd.Series( data&#x3D;None, index&#x3D;None, dtype&#x3D;None, ) data : array-like, Iterable, dic">
<meta property="og:type" content="article">
<meta property="og:title" content="pandas库的简单讲解">
<meta property="og:url" content="http://example.com/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/index.html">
<meta property="og:site_name" content="Yili">
<meta property="og:description" content="https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;583d83f1ff81 导入pandas库： import pandas as pd   其他点  注意 dp 中的 nan，应该用  np.nan 来指定   Series  创建 1pd.Series( data&#x3D;None, index&#x3D;None, dtype&#x3D;None, ) data : array-like, Iterable, dic">
<meta property="og:locale">
<meta property="article:published_time" content="2021-02-09T06:10:47.000Z">
<meta property="article:modified_time" content="2024-03-11T02:59:01.945Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>pandas库的简单讲解 | Yili</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yili</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Suggest Google Chrome for better math Reading.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/Coding/Pandas/pandas%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="A foolish, slow learner.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yili">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          pandas库的简单讲解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 22:10:47" itemprop="dateCreated datePublished" datetime="2021-02-08T22:10:47-08:00">2021-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/" itemprop="url" rel="index"><span itemprop="name">Data Analysis Package</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis-Package/Pandas/" itemprop="url" rel="index"><span itemprop="name">Pandas</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>30 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/583d83f1ff81">https://www.jianshu.com/p/583d83f1ff81</a></p>
<p>导入pandas库： <code>import pandas as pd </code></p>
<h1 id="其他点"><a class="markdownIt-Anchor" href="#其他点"></a> 其他点</h1>
<ul>
<li>注意 dp 中的 nan，应该用  <code>np.nan</code> 来指定</li>
</ul>
<h1 id="series"><a class="markdownIt-Anchor" href="#series"></a> Series</h1>
<h2 id="创建"><a class="markdownIt-Anchor" href="#创建"></a> 创建</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.Series( data=<span class="literal">None</span>, index=<span class="literal">None</span>, dtype=<span class="literal">None</span>, )</span><br></pre></td></tr></table></figure>
<p><code>data : array-like, Iterable, dict, or scalar value</code><br />
<code>index : array-like or Index (1d)</code>：如果没有指定，则默认从 0 开始<br />
<code>dtype : str, numpy.dtype, or ExtensionDtype, optional</code><br />
<code>copy : bool, default False</code> ：Copy input data. <strong>Only affects Series or 1d ndarray input.</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a= pd.Series([1,2,3,4],index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;,&#x27;d&#x27;])</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">d    4</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d = &#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; pd.Series(data=d)</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; pd.Series(data=d, index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span><br><span class="line">a   1</span><br><span class="line">b   2</span><br><span class="line">c   3</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"># 根据字典创建则需要 index 匹配 key</span><br><span class="line">&gt;&gt;&gt; pd.Series(data=d, index=[&#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;])</span><br><span class="line">x   NaN</span><br><span class="line">y   NaN</span><br><span class="line">z   NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<h2 id="attribute"><a class="markdownIt-Anchor" href="#attribute"></a> Attribute</h2>
<p><code>.T</code>：对 Pandas Series 使用 <code>.T</code> ，它将不会执行矩阵的转置操作，而只是返回原始 Series，因为 Series 本身只有一列。<br />
<code>.array</code>：return <code>&lt;PandasArray&gt;</code> ，忽略 index<br />
<code>.values</code>：return <code>numpy.ndarray</code> ，忽略 index<br />
<code>.ndim</code>：return Number of dimensions of the underlying data, by definition 1 .<br />
<code>.hahnans</code>：Return True if there are any NaNs. 注意不是方法，而是属性，不需加括号 。<br />
<code>.empty</code>：用于检查是否为空，注意区别 NaN，NaN 不是空，这里空表示 <code>pd.DataFrame(&#123;'A' : []&#125;)</code> 没有定义。<br />
<code>.name</code>：Series 的一个属性，直接创建的话，默认为空，但是可以修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a.name = &#x27;hhhh&#x27;</span><br><span class="line">&gt;&gt;&gt; a.name</span><br><span class="line">&#x27;hhhh&#x27;</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">a    1</span><br><span class="line">b    2</span><br><span class="line">c    3</span><br><span class="line">Name: hhhh, dtype: int64</span><br></pre></td></tr></table></figure>
<p><strong>dtype 相关 ：</strong></p>
<ul>
<li><code>.dtype</code></li>
<li><code>.astype(dtype, copy=None, errors='raise')</code>：修改 dtype 属性</li>
<li><code>pandas.Series.convert_dtypes()</code>：<strong>non-inplace</strong> 用于将 Series 中的数据类型转换为最适合存储数据的数据类型，以节省内存和提高性能。</li>
</ul>
<p><strong>索引相关 ：</strong></p>
<ul>
<li><code>['a'] / .at['a'] / .loc['a']</code>：返回对应 <code>'a'</code> 的元素，注意使用中括号 <code>[]</code></li>
<li><code>[0] / .iat[0] / .iloc[0]</code>：返回对应 0-index 的元素，注意使用中括号 <code>[]</code></li>
<li><code>.keys()</code>  / <code>.values()</code>：类似字典，返回取值</li>
</ul>
<p><strong>转换函数相关 ：</strong></p>
<ul>
<li><code>.abs()</code></li>
<li><code>.pop()</code>：return and drop，参数为 index label 值，区分数组。</li>
<li><code>.add(other, level=None, fill_value=None, axis=0)</code>：<br />
等于 <code>series + other</code>，但是可以设置参数 <code>fill_value</code>
<ul>
<li><code>other</code>: 放另一个 Series ，会将同一个 index value 的进行相加 。</li>
<li><code>level=None</code>: 用于填充缺失值（NaN）。如果最少一个不是 NaN，则使用缺失值 ； 如果两个都是 NaN，则结果还是 NaN ；默认情况下不指定，则只要有一个为 NaN，结果就是 NaN 。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = pd.Series([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, np.nan], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = pd.Series([<span class="number">1</span>, np.nan, <span class="number">1</span>, np.nan], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.add(b, fill_value=<span class="number">1</span>)</span><br><span class="line">a    <span class="number">2.0</span></span><br><span class="line">b    <span class="number">2.0</span></span><br><span class="line">c    <span class="number">2.0</span></span><br><span class="line">d    <span class="number">2.0</span></span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.sub(other, level=None, fill_value=None, axis=0)</code>：同上，是删除操作<br />
等于 <code>series - other</code>，但是可以设置参数 <code>fill_value</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a.sub(b, fill_value=4)</span><br><span class="line">a    0.0</span><br><span class="line">b   -3.0</span><br><span class="line">c   -3.0</span><br><span class="line">d    3.0</span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; a.sub(b)</span><br><span class="line">a    0.0</span><br><span class="line">b    NaN</span><br><span class="line">c    NaN</span><br><span class="line">d    NaN</span><br><span class="line">e    NaN</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.mul(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series * other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.div(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series / other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.floordiv(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series // other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.mod(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series % other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.pow(other, level=None, fill_value=None, axis=0)</code> ：等于 <code>series ** other</code>，但是可以设置参数 <code>fill_value</code></li>
<li><code>.combine(other, func, fill_value=None)</code> :根据 <code>func</code>函数，处理两个series 的对应值，比如 <code>max / min / ...</code><br />
注意如果没有指定 <code>fill_value</code> ，如果存在一方为 NaN，并且是比大小的话，则保留调用该方法的 series 内部的值。<br />
如果自定义使用 lambda 的话，则会保留 NaN，即使有填充值。<br />
反正不建议使用这个操作，先 fillna 然后再进行变换比较好。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">a    3.0</span><br><span class="line">b    NaN</span><br><span class="line">d    8.0</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">a    1.0</span><br><span class="line">b    1.0</span><br><span class="line">c    1.0</span><br><span class="line">d    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.combine(a,  min)</span><br><span class="line">a    1.0</span><br><span class="line">b    NaN  # 这里保留了 Series b 的值，尽管 Series a 中有值</span><br><span class="line">c    NaN</span><br><span class="line">d    8.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>.lt(other, level=None, fill_value=None, axis=0)</code></p>
</li>
<li>
<p><code>.gt</code></p>
</li>
<li>
<p><code>.le</code></p>
</li>
<li>
<p><code>.ge</code></p>
</li>
<li>
<p><code>.ne</code></p>
</li>
<li>
<p><code>.eq</code></p>
</li>
<li>
<p><code>.round()</code> ： 四舍五入取整数，不看正负</p>
</li>
<li>
<p><code>.apply(func, convert_dtype=_NoDefault.no_default, args=(), *, by_row='compat', **kwargs)</code>：可以用于 Series 或 DataFrame 对象。</p>
<ul>
<li>args : 是该方法的一些其他参数 ， 可以使用 <code>**</code> 转换为字典，更方便 。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = pd.Series([20, 21, 12],  index=[&#x27;London&#x27;, &#x27;New York&#x27;, &#x27;Helsinki&#x27;])</span><br><span class="line">&gt;&gt;&gt; s.apply(lambda x,y: x-y, args=(5,))</span><br><span class="line">London      15</span><br><span class="line">New York    16</span><br><span class="line">Helsinki     7</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; def add_custom_values(x, **kwargs):</span><br><span class="line">...     for month in kwargs:</span><br><span class="line">...         x += kwargs[month]</span><br><span class="line">...     return x</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s.apply(add_custom_values, june=30, july=20, august=25)</span><br><span class="line">London      95</span><br><span class="line">New York    96</span><br><span class="line">Helsinki    87</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>.map(arg, na_action=None)</code>和 apply 类似，但是通常用于 Series 对象。
<ul>
<li><code>arg : function, collections.abc.Mapping subclass or Series</code>，除了 lambda，也可以穿入一个字典</li>
<li><code>na_action=None</code> ，如果为 <code>ignore</code>，则 NaN 处理后还是 NaN 。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.map(&#x27;I am a &#123;&#125;&#x27;.format)</span><br><span class="line">0       I am a cat</span><br><span class="line">1       I am a dog</span><br><span class="line">2       I am a nan</span><br><span class="line">3    I am a rabbit</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s.map(&#x27;I am a &#123;&#125;&#x27;.format, na_action=&#x27;ignore&#x27;)</span><br><span class="line">0     I am a cat</span><br><span class="line">1     I am a dog</span><br><span class="line">2            NaN</span><br><span class="line">3  I am a rabbit</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>
<h1 id="dataframe"><a class="markdownIt-Anchor" href="#dataframe"></a> DataFrame</h1>
<h2 id="创建-2"><a class="markdownIt-Anchor" href="#创建-2"></a> 创建</h2>
<ol>
<li>按列直接创建：</li>
</ol>
<ul>
<li>不指定行索引index（行索引被默认为数字，从0开始），参数为列的字典</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&#x27;one&#x27;: [1, 2, 3], &#x27;two&#x27;: [4, 5, 6]&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">0    1    4</span><br><span class="line">1    2    5</span><br><span class="line">2    3    6</span><br></pre></td></tr></table></figure>
<ul>
<li>指定行索引index，参数为列的字典和行索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&#x27;one&#x27;: [1, 2, 3], &#x27;two&#x27;: [4, 5, 6]&#125;, index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a    1    4</span><br><span class="line">b    2    5</span><br><span class="line">c    3    6</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>按照行进行创建<br />
<code>append</code> 方法创建</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">创建一个空的Dataframe</span><br><span class="line">result =pd.DataFrame(columns=(&#x27;idx&#x27;,&#x27;degree&#x27;,&#x27;weight&#x27;,&#x27;diameter&#x27;))</span><br><span class="line">#将计算结果逐行插入result,注意变量要用[]括起来,同时ignore_index=True，否则会报错，ValueError: If using all scalar values, you must pass an index</span><br><span class="line">for i in idx:</span><br><span class="line">    degree=</span><br><span class="line">    weight=</span><br><span class="line">    diameter=</span><br><span class="line">    result=result.append(pd.DataFrame(&#123;&#x27;idx&#x27;:[i],&#x27;degree&#x27;:[degree],&#x27;weight&#x27;:[weight],&#x27;diameter&#x27;:[diameter]&#125;),ignore_index=True)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>使用Series创建：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">d = pd.DataFrame(&#123;&quot;one&quot;: pd.Series([1, 2, 3], index=[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]), &quot;two&quot;:pd.Series([1,2,3,4],index=[&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;,&#x27;d&#x27;])&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a  1.0    2</span><br><span class="line">b  2.0    1</span><br><span class="line">c  3.0    3</span><br><span class="line">d  NaN    4</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>使用index和columns参数创建：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dates = pd.date_range(&#x27;today&#x27;,periods=6) # 定义时间序列作为 index</span><br><span class="line">num_arr = np.random.randn(6,4) # 传入 numpy 随机数组</span><br><span class="line">columns = [&#x27;A&#x27;,&#x27;B&#x27;,&#x27;C&#x27;,&#x27;D&#x27;] # 将列表作为列名</span><br><span class="line">df1 = pd.DataFrame(num_arr, index = dates, columns = columns)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">                                   A         B         C         D</span><br><span class="line">2021-02-14 11:00:38.210410 -0.234308  0.458834  1.758701 -0.390679</span><br><span class="line">2021-02-15 11:00:38.210410 -1.448708  0.534228  0.404082  0.722971</span><br><span class="line">2021-02-16 11:00:38.210410  0.540040 -0.593858  0.882544  0.499553</span><br><span class="line">2021-02-17 11:00:38.210410 -1.295320  0.909557 -1.058109 -0.530681</span><br><span class="line">2021-02-18 11:00:38.210410  0.307840  0.328438 -0.680865 -2.096587</span><br><span class="line">2021-02-19 11:00:38.210410 -1.777850  0.615222 -0.213545 -0.219512</span><br></pre></td></tr></table></figure>
<h2 id="属性"><a class="markdownIt-Anchor" href="#属性"></a> 属性</h2>
<ul>
<li><code>.index</code>: 返回 index</li>
<li><code>.columns</code>: 返回 columns 特征列表</li>
<li><code>.ndim</code>: 返回特征数量，也就是 columns 数量</li>
<li><code>.info()</code></li>
<li><code>.describe()</code>: 返回  statistics 统计量</li>
<li><code>.values</code>: 返回一个 <code>numpy.ndarray</code></li>
<li><code>.size</code>: 返回元素数量，NaN 也算</li>
<li><code>.shape</code></li>
<li><code>.T</code>: 转制</li>
<li>更改列名：
<ol>
<li>修改列名a，b为A、B：<code>df.columns = ['A','B']</code></li>
<li>只修改列名a为A：<code>df = df.rename(columns=&#123;'a':'A'&#125;)</code></li>
</ol>
</li>
<li><code>.reset_index()</code>：重置 DataFrame 的索引，从 0 开始。
<ul>
<li><code>drop=False</code>：默认情况下新的  df 会保留原始 df 的 index，成为一个新的列；如果 <code>drop=True</code>，那么旧的 index 会被直接删除。</li>
</ul>
</li>
<li><code>.set_index('A')</code>：设置 ‘A’ 列作为行索引</li>
<li><code>.rename_axis('New_Index')</code>：重命名索引</li>
</ul>
<h3 id="dtype-类型"><a class="markdownIt-Anchor" href="#dtype-类型"></a> dtype 类型</h3>
<ul>
<li><code>.astype(dtype, copy=None, errors='raise')</code>
<ul>
<li><code>dtype : str, data type, Series or Mapping of column name -&gt; data type</code><br />
str：dtype，比如 <code>'int32'</code><br />
字典：针对特定的列进行操作，key 为 column 名称，value 为 str类型 的 dtype</li>
</ul>
</li>
<li><code>.convert_dtypes()</code>: 转化 dtype 来节省内存，Convert columns to the best possible dtypes using dtypes supporting <a target="_blank" rel="noopener" href="http://pd.NA">pd.NA</a> 。</li>
</ul>
<h3 id="数值操作"><a class="markdownIt-Anchor" href="#数值操作"></a> 数值操作</h3>
<ul>
<li><code>+-*///%   int/arr</code>：int 就是所有列都进行同一个操作 ，arr 表示对应的列跟arr对应元素进行操作 。<br />
而 <code>.add() / sub()</code> 等方法默认就是 <code>columns</code> ，好处就是可以赋值参数 <code>fill_value</code> 。</li>
<li><code>mean()</code>：每一列的 mean</li>
<li><code>sum()</code>：每一列的 sum</li>
<li><code>std(axis=0, skipna=True, ddof=1, numeric_only=False, **kwargs)</code>：计算标准差，默认列</li>
<li><code>var(axis=0, skipna=True, ddof=1, numeric_only=False, **kwargs)</code>：计算方差，默认列</li>
<li><code>nunique(axis=0, dropna=True)</code>：非重复值的数量，默认列</li>
<li><code>round()</code> ：四舍五入<br />
可以直接传入一个 <code>int</code> 表示保留小数部分的位数：<code>df.round(2)</code><br />
或者根据字典单独定义不同列需要保留的位数： <code>df.round(&#123;&quot;col1&quot;:1, &quot;col2&quot;:2&#125;)</code></li>
</ul>
<h3 id="排序"><a class="markdownIt-Anchor" href="#排序"></a> 排序</h3>
<ul>
<li><code>sort_values()</code>：根据元素值进行行排序，NaN 放在最下面
<ul>
<li><code>by : str or list of str</code> ：传入列标签的名称，或者名称的数组，表示排序的依据</li>
<li>当使用多个排序标准时，使用数组 <code>df1.sort_values(by=['age', 'visits'], ascending=[False, True])</code></li>
</ul>
</li>
<li><code>sort_index(axis=0, ascending=True, key=None)</code>：仅根据 index 进行排序，即不考虑实际的内容，只想把 index 改正
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li><code>key : callable, optional</code>：可以传入 lambda 数组</li>
</ul>
</li>
</ul>
<h3 id="增删改"><a class="markdownIt-Anchor" href="#增删改"></a> 增删改</h3>
<p><strong>插入 ：</strong></p>
<ul>
<li>插入列：<code>.insert(loc, column, value, allow_duplicates=_NoDefault.no_default)</code>
<ul>
<li><code>loc : int</code>：Must verify 0 &lt;= loc &lt;= len(columns) ， 表示新插入是第几列</li>
<li><code>column</code>：新的列名</li>
<li><code>value : Scalar, Series, or array-like</code> ：列的值</li>
<li><code>allow_duplicates : bool, optional, default lib.no_default</code> ： 是否允许和已经有的列名重复</li>
</ul>
</li>
<li>插入列：<code>df['new_column_name'] = ...</code></li>
<li>插入行：
<ul>
<li><code>df.loc[len(df)] = [4, 7]</code> ：创建一个列表，其中的元素按照 DataFrame 列的顺序排列</li>
<li><code>df = df.append(&#123;'A': 4, 'B': 7&#125;, ignore_index=True)</code> ：创建一个字典，其中键是列名，值是要插入的数据</li>
</ul>
</li>
</ul>
<p><strong>删除：</strong></p>
<ul>
<li>删除特定行或者列：<code>.drop(labels=None, *, axis=0, index=None, columns=None, level=None, inplace=False, errors='raise')</code>
<ul>
<li><code>labels : single label or list-like</code> ：名称或者名称的列表</li>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li><code>index : single label or list-like</code>：直接指定删除的行名称</li>
<li><code>columns : single label or list-like</code>：直接指定删除的列名称</li>
</ul>
</li>
<li>删除并返回特定列：<code>.pop(column_name)</code> ：删除并返回 column_name 列</li>
</ul>
<p><strong>修改：</strong></p>
<ul>
<li><code>.where(cond, other=nan, *, inplace=False, axis=None, level=None)</code>：<br />
根据指定的条件筛选 DataFrame 中的数据，并将不满足条件的 False元素 替换为指定的值 <code>other=nan</code>。
<ul>
<li><code>cond</code> 返回 True/False ， 需要维度和 df 的维度一致。用于筛选，一般直接是 df 的操作，因为目的是为了填充一些元素。</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = pd.Series(range(5))</span><br><span class="line">&gt;&gt;&gt; s.where(s &gt; 0)</span><br><span class="line">0    NaN</span><br><span class="line">1    1.0</span><br><span class="line">2    2.0</span><br><span class="line">3    3.0</span><br><span class="line">4    4.0</span><br></pre></td></tr></table></figure>
</li>
<li><code>.mask(cond, other=_NoDefault.no_default, *, inplace=False, axis=None, level=None)</code>：和 where 一样，只不过这里是替换 True 的元素 。</li>
<li><code>.truncate(before=None, after=None, axis=None, copy=None)</code>：截断，保留 [before, after] 的部分 。
<ul>
<li><code>before : date, str, int</code> ：Truncate all rows before this index value.</li>
<li><code>after : date, str, int</code> ：Truncate all rows after this index value.</li>
<li><code>axis=0 : &#123;0 or ‘index’, 1 or ‘columns’&#125;, optional</code></li>
</ul>
</li>
<li>根据一列来新建另一列，使用到了 numpy  三元条件表达式：<code>apl['涨跌'] = np.where(apl[3]&gt;0,'涨',np.where(apl[3]==0,'平','跌'))</code></li>
</ul>
<h3 id="apply-map"><a class="markdownIt-Anchor" href="#apply-map"></a> apply / map</h3>
<ul>
<li><code>.apply(func, axis=0, raw=False, result_type=None, args=(), by_row='compat', **kwargs)</code>
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125;, default 0</code></li>
<li>默认是每一个 column 为一个整体，当然也可以理解为：逐个元素进行操作 ， 比如：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resampled.apply(lambda col: np.std(col))  # 计算每一列的方差</span><br><span class="line">d.apply(lambda x: x+1) # 每一列元素 + 1 -&gt; 每个元素 + 5</span><br></pre></td></tr></table></figure>
<ul>
<li>可以直接对整个 df 进行操作，即列和列之间对比，注意加上 <code>axis=1</code>：</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">step1_df[&#x27;label&#x27;] = step1_df.apply(lambda x: 1 if str(x.pred_content_id) in x.true_content_id else 0, axis=1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="索引方式"><a class="markdownIt-Anchor" href="#索引方式"></a> 索引方式</h2>
<ul>
<li><code>.at['row_label', 'column_label']</code>  /  <code>.iat['row_idx', 'column_idx']</code> ：at 方法仅用于选择单个元素，</li>
<li><code>.loc['row_label', 'column_label']</code> / <code>.iloc['row_idx', 'column_idx']</code> ：选择单个元素</li>
<li><code>[column_label][row_label]</code>：选择标签对应的元素，不建议使用这种方式</li>
<li><code>[column_label]</code>：选择一整个列；<br />
<code>[row_label, :]</code>/<code>[row_label]</code>：选择一整行</li>
<li>花式索引：<code>d['one'][d['one']&gt; 2]</code> ; <code>d.loc[['a', 'c'],  'one']</code> ; <code>target[(target.event==1)&amp;(target.season==3)]</code> ， 注意用 <code>()</code> 括起来，然后加上 <code>&amp;</code>，不能改成 <code>and</code>; <code>or</code> 则是 <code>|</code> 。</li>
<li><code>isin(array)</code>/ <code>~isin(array)</code>：返回一个 True / False 数据结构，可以用于索引，比如 <code>d[d['one'].isin([1,2])]</code> 。</li>
</ul>
<h2 id="nan-处理-填充"><a class="markdownIt-Anchor" href="#nan-处理-填充"></a> NAN 处理 / 填充</h2>
<p><strong>查找 nan：</strong></p>
<ul>
<li><code>.isnull()/notnull()</code>：如果值为NaN，返回 True/False，否则返回 False/True ， 返回结果为同一个 size 的 df。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看每一列是否有NaN：</span><br><span class="line">df.isnull().any(axis=0)</span><br><span class="line"># 查看每一行是否有NaN：</span><br><span class="line">df.isnull().any(axis=1)</span><br><span class="line"># 查看所有数据中是否有NaN最快的：</span><br><span class="line">df.isnull().values.any()</span><br><span class="line"># 查看哪些列有 nan</span><br><span class="line">columns_with_nan = df.columns[df.isnull().any()]</span><br><span class="line"># 查找包含NaN值的行</span><br><span class="line">rows_with_nan = df[df.isnull().any(axis=1)]</span><br></pre></td></tr></table></figure>
<p><strong>填充 null</strong></p>
<ul>
<li>
<p><code>.dropna()</code>：返回删除所有缺失值的Series对象，并返回 df</p>
<ul>
<li><code>axis : &#123;0 or ‘index’, 1 or ‘columns’&#125; default 0</code>： 0 按行删除 ；1 按列删除</li>
<li><code>how : &#123;‘any’, ‘all’&#125;, default ‘any’</code>：只要有一个 nan，就删除 ；还是全部为 nan 才删除</li>
<li><code>ignore_index : bool, default False</code>：删除后是否重新更新 index 索引</li>
</ul>
</li>
<li>
<p><code>.fillna(参数)</code>：填充NaN并返回，参数为填充值。</p>
<ul>
<li>根据每一列均值来填充 : <code>df.fillna(df.mean(), inplace=True)</code></li>
</ul>
</li>
<li>
<p><code>df.bfill(axis='rows')</code></p>
<ul>
<li><code>axis='index'</code> 或 <code>axis=0</code>（默认值）:  使用下一行数据进行填充</li>
<li><code>axis= axis='columns' </code>或<code> axis=1</code>: 使用下一列数据进行填充<br />
如果下一行或者下一列也是 None，就向后找，直到找到非空，然后全部填充，如果找不到，那就还是 Nan</li>
</ul>
</li>
<li>
<p><code>df.ffill()</code> ，参考前面，这个是使用前面的数据进行填充</p>
</li>
</ul>
<h2 id="一些方法"><a class="markdownIt-Anchor" href="#一些方法"></a> 一些方法</h2>
<ul>
<li>
<p><code>DataFrame.rolling(window, min_periods=None, center=False, win_type=None, on=None, axis=_NoDefault.no_default, closed=None, step=None, method='single')</code></p>
<ul>
<li><code>window : int, timedelta, str, offset, or BaseIndexer subclass</code>：选择 rolling window 的大小<br />
最常用的是 <code>offset : int</code>：，示选择自己和前面一共 offset 个数字 。<br />
当索引是时间类型 <code>pd.Timestamp</code> ，可以使用如 <code>2s</code> 来选定包含自己的一段时间。但是需要保证时间索引是对的，即没有进行随机排列，所以在之前可以进行 <code>df.sort_index()</code> ，先排序。</li>
<li><code>min_periods : int: default None</code>：Minimum number of observations in window required to have a value; otherwise, result is np.nan.</li>
<li><code>center : bool, default False</code>：默认向右进行划窗，可以选择进行左右两边划窗。</li>
<li><code>on</code>：用于多级索引的情况，以指定在哪个级别上执行滚动操作。</li>
<li>通常是后面跟一个函数来进行 agg 运算，比如 <code>df.rolling(2).sum()</code> 。实际是先 rolling，划分为多个组，然后进行操作，最后赋值，所以可以有：<code>lambda x: np.fabs(x - x.mean()).mean()</code> 。</li>
</ul>
</li>
<li>
<p>切分数组：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_splits = <span class="number">20</span></span><br><span class="line">df_splits = np.array_split(df, num_splits)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>pandas.concat()</code>：可以将数据根据不同的轴作简单的拼接</p>
<ul>
<li><code>a sequence or mapping of Series or DataFrame objects</code></li>
<li><code>axis : &#123;0/’index’, 1/’columns’&#125;, default 0</code>： 需要合并链接的轴，0是行，1是列，默认按行合并</li>
<li><code>join : &#123;‘inner’, ‘outer’&#125;, default 'outer'</code>：连接方式 inner 表示删除不重合的列 ；</li>
<li><code>ignore_index = Flase</code> ：按行拼接后是否重新整理 index</li>
</ul>
</li>
<li>
<p><code>shift()</code>方法，用来偏移元素<br />
参数：<br />
1. periods: 偏移量<br />
2. frep: DateOffset, timedelta, or time rule string，可选参数，默认值为None，只适用于时间序列，如果这个参数存在，那么会按照参数值移动时间索引，而数据值没有发生变化。<br />
3. axis:指定要移位的行或列，0为行，1为列<br />
4. fill_value:指定移位后的填充值，fill_value=0，即表示移位后缺失值填充为0<br />
可以用该方法对单行/列进行操作<br />
可以用该方法来去除重复行</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;&#x27;A&#x27;: [1, 2, 2, 3, 4, 5, 5, 5, 6, 7, 7]&#125;)</span><br><span class="line">df1 = df.loc[df[&#x27;A&#x27;].shift() != df[&#x27;A&#x27;]]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   A</span><br><span class="line">0  1</span><br><span class="line">1  2</span><br><span class="line">3  3</span><br><span class="line">4  4</span><br><span class="line">5  5</span><br><span class="line">8  6</span><br><span class="line">9  7</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>df.diff()</code>: 当前行减去上一行的值<br />
或者 <code>df['diff'] = df['value'] - df['value'].shift(1)</code></p>
</li>
<li>
<p>随机抽样方法</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.sample( n=None, frac=None, replace=False,</span><br><span class="line">                  weights=None, random_state=None, axis=None)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>n: int</code>：用来指定随机抽取的样本数目（行数目）或者列数目，默认随机抽取行数据。<br />
不指定<code>n</code>，也不指定<code>frac</code>时，默认随机抽取一行数据。</li>
<li><code>frac: float</code>：指定随机抽取行或列的比例</li>
<li><code>replace: bool</code>：有放回抽样还是无放回抽样。当 <code>frac&gt;1</code> 的浮点数或者参数 <code>n&gt;样本数目</code> ，需要指定<code>replace=True</code>。</li>
<li><code>weights: str or Series</code>：默认为<code>None</code>，即执行等概率抽样。
<ul>
<li><code>str</code>类型，要求是DataFrame中的一个列名，pandas将str这个列的取值作为该行数据的抽样权重进行抽样。<br />
如果列中数据相加和不等于1，该列数据将被标准化到和为1。列中如果有缺失值，该行数据的抽样权重被视为0。此外这个列中不允许无限值。</li>
<li><code>Series</code>类型，<code>Series</code>的长度可以和数据中行或列的长度不同。<br />
<code>pandas</code>会先进行索引对齐，相当于对<code>DataFrame</code>和<code>Series</code>做一个左连接。<code>DataFrame</code>中没有匹配到的索引对应的行抽样权重为0。</li>
</ul>
</li>
<li><code>random_state: int</code>：用于复现抽样结果</li>
<li><code>axis: int/str</code>：当axis指定为0或者’index’时，对行进行抽样，当axis指定为1或者’col’时，对列进行抽样。默认执行的是行抽样。</li>
</ul>
</li>
</ul>
<h3 id="groupby-聚合方法"><a class="markdownIt-Anchor" href="#groupby-聚合方法"></a> groupby 聚合方法</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lemonbit/p/6810972.html">https://www.cnblogs.com/lemonbit/p/6810972.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   A  B    C</span><br><span class="line">0  a  2  102</span><br><span class="line">1  b  8   98</span><br><span class="line">2  a  1  107</span><br><span class="line">3  c  4  104</span><br><span class="line">4  a  3  115</span><br><span class="line">5  c  2   87</span><br><span class="line">6  b  5   92</span><br><span class="line">7  c  9  123</span><br></pre></td></tr></table></figure>
<ul>
<li>按A列分组（groupby），获取其他列的均值：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(&#x27;A&#x27;).mean()</span><br></pre></td></tr></table></figure>
<ul>
<li>按多列进行分组（groupby）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df.groupby([&#x27;A&#x27;,&#x27;B&#x27;]).mean()</span><br><span class="line"></span><br><span class="line">Out[4]:</span><br><span class="line">       C</span><br><span class="line">A B</span><br><span class="line">a 1  107</span><br><span class="line">  2  102</span><br><span class="line">  3  115</span><br><span class="line">b 5   92</span><br><span class="line">  8   98</span><br><span class="line">c 2   87</span><br><span class="line">  4  104</span><br><span class="line">  9  123</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>分组后选择列进行运算</p>
<ul>
<li>仅选择B列，在 <code>groupby()</code>函数后面加个索引即可:</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">g = df.groupby(&quot;A&quot;)</span><br><span class="line">g[&#x27;B&#x27;].mean() # 仅选择B列</span><br><span class="line"></span><br><span class="line">Out[7]:</span><br><span class="line">A</span><br><span class="line">1    1.5</span><br><span class="line">2    3.0</span><br><span class="line">Name: B, dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li>选择B、C多列</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g[[&#x27;B&#x27;, &#x27;C&#x27;]].mean() # 选择B、C列</span><br></pre></td></tr></table></figure>
<ul>
<li>可以针对不同的列选用不同的聚合方法</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g.agg(&#123;&#x27;B&#x27;:&#x27;mean&#x27;, &#x27;C&#x27;:&#x27;sum&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">Out[9]:</span><br><span class="line">   B   C</span><br><span class="line">A</span><br><span class="line">1  1.5  5</span><br><span class="line">2  3.0  4</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>聚合方法</p>
<ul>
<li><code>count()</code>：nan 不会被计入</li>
<li><code>size()</code>：nan 也会被计入</li>
</ul>
</li>
<li>
<p>分组运算方法 <code>agg()</code></p>
<ul>
<li><code>agg(list)</code> 将属于同一个 group 的所有元素全部整合到一个 list 中</li>
<li><code>agg([&quot;count&quot;]).apply('list')</code></li>
<li><code>agg([&quot;max&quot;]).apply('list')</code></li>
<li><code>.groupby(by=[&quot;id_map&quot;]).hour.std()</code> group之后，选择hour列，然后计算标准差</li>
</ul>
</li>
<li>
<p><code>groupby</code>方法返回的是一个 <code>Series</code> ，无法直接输出。<br />
相当于 <code>groupby</code> 的标准列成为了索引，那么问题就转成了，索引能不能转换为数据？<br />
直接重索引即可：<code>df.reset_index()</code>，例子：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">avg_aqi.head()</span><br><span class="line">Country  Year  Month</span><br><span class="line">Albania  2022  7        32.937500</span><br><span class="line">               8        30.687500</span><br><span class="line">               9        15.565217</span><br><span class="line">         2023  1         9.000000</span><br><span class="line">Algeria  2022  7        65.000000</span><br><span class="line">Name: AQI Value, dtype: float64</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>Country  Year  Month</code> 成了索引，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">avg_aqi.reset_index().head()</span><br><span class="line">   Country  Year  Month  AQI Value</span><br><span class="line">0  Albania  2022      7  32.937500</span><br><span class="line">1  Albania  2022      8  30.687500</span><br><span class="line">2  Albania  2022      9  15.565217</span><br><span class="line">3  Albania  2023      1   9.000000</span><br><span class="line">4  Algeria  2022      7  65.000000</span><br></pre></td></tr></table></figure>
<p>直接重新索引即可</p>
<h3 id="reset_index-和-set_index"><a class="markdownIt-Anchor" href="#reset_index-和-set_index"></a> reset_index() 和 set_index()</h3>
<p>出于增强数据可读性或其他原因，我们需要对数据表的<strong>索引值</strong>进行设定。</p>
<ul>
<li>set_index</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.set_index(keys, drop=True, append=False, inplace=False, verify_integrity=False)</span><br></pre></td></tr></table></figure>
<ul>
<li>keys：列标签:str ； 或 列标签列表，创建多列索引。</li>
<li>drop：默认为True，删除用作新索引的列</li>
<li>append：是否将列附加到现有索引，默认为False。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df</span><br><span class="line">   Country  Income  Age</span><br><span class="line">0    China   10000   50</span><br><span class="line">1    China   10000   43</span><br><span class="line">2    India    5000   34</span><br><span class="line">3    India    5002   40</span><br><span class="line">4  America   40000   25</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df.set_index([&quot;Age&quot; , &quot;Income&quot;])</span><br><span class="line">            Country</span><br><span class="line">Age Income</span><br><span class="line">50  10000     China</span><br><span class="line">43  10000     China</span><br><span class="line">34  5000      India</span><br><span class="line">40  5002      India</span><br><span class="line">25  40000   America</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df.set_index(&quot;Age&quot;)</span><br><span class="line">     Country  Income</span><br><span class="line">Age</span><br><span class="line">50     China   10000</span><br><span class="line">43     China   10000</span><br><span class="line">34     India    5000</span><br><span class="line">40     India    5002</span><br><span class="line">25   America   40000</span><br><span class="line"></span><br><span class="line"># 仍然保留索引列</span><br><span class="line">&gt;&gt;&gt; df.set_index(&quot;Age&quot;, drop=False)</span><br><span class="line">     Country  Income  Age</span><br><span class="line">Age</span><br><span class="line">50     China   10000   50</span><br><span class="line">43     China   10000   43</span><br><span class="line">34     India    5000   34</span><br><span class="line">40     India    5002   40</span><br><span class="line">25   America   40000   25</span><br></pre></td></tr></table></figure>
<h3 id="拆分行合并行"><a class="markdownIt-Anchor" href="#拆分行合并行"></a> 拆分行/合并行</h3>
<h4 id="explode"><a class="markdownIt-Anchor" href="#explode"></a> explode()</h4>
<p>当 dataframe 中某一行其中一个元素是列表形式，即<strong>多个同类型的数据</strong>，若想要展开成多行进行分析，可以使用该函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.explode(self, column: Union[str, Tuple])</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df1</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c   [2, 3, 8]    1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df1.explode(&#x27;measurement&#x27;)</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c           2    1</span><br><span class="line">2  c           3    1</span><br><span class="line">2  c           8    1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df1.explode(&#x27;measurement&#x27;).reset_index(drop=True)</span><br><span class="line">  id measurement  day</span><br><span class="line">0  a           4    1</span><br><span class="line">1  b           6    1</span><br><span class="line">2  c           2    1</span><br><span class="line">3  c           3    1</span><br><span class="line">4  c           8    1</span><br></pre></td></tr></table></figure>
<h2 id="内存优化"><a class="markdownIt-Anchor" href="#内存优化"></a> 内存优化</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line"><span class="comment"># inspired by https://www.kaggle.com/code/renatoreggiani/reduce-memory-usage-zzzs-cmi</span></span><br><span class="line"><span class="comment"># with tweaks determined by the selected polars loading strategy</span></span><br><span class="line"><span class="comment"># tweaks inspired by https://github.com/softhints/Pandas-Tutorials/blob/master/column/3.check-dtype-column-columns-pandas-dataframe.ipynb</span></span><br><span class="line"><span class="keyword">from</span> pandas.api.types <span class="keyword">import</span> is_datetime64_ns_dtype</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reduce_mem_usage</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; iterate through all numeric columns of a dataframe and modify the data type</span></span><br><span class="line"><span class="string">        to reduce memory usage.        </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    start_mem = df.memory_usage().<span class="built_in">sum</span>() / <span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Memory usage of dataframe is <span class="subst">&#123;start_mem:<span class="number">.2</span>f&#125;</span> MB&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">        col_type = df[col].dtype</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> col_type != <span class="built_in">object</span> <span class="keyword">and</span> <span class="keyword">not</span> is_datetime64_ns_dtype(df[col]):</span><br><span class="line">            c_min = df[col].<span class="built_in">min</span>()</span><br><span class="line">            c_max = df[col].<span class="built_in">max</span>()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">str</span>(col_type)[:<span class="number">3</span>] == <span class="string">&#x27;int&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> c_min &gt; np.iinfo(np.int8).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int8).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int8)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int16).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int16).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int16)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int32).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int32).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int32)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.iinfo(np.int64).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.iinfo(np.int64).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.int64)  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> c_min &gt; np.finfo(np.float16).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.finfo(np.float16).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float16)</span><br><span class="line">                <span class="keyword">elif</span> c_min &gt; np.finfo(np.float32).<span class="built_in">min</span> <span class="keyword">and</span> c_max &lt; np.finfo(np.float32).<span class="built_in">max</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float32)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    df[col] = df[col].astype(np.float16)</span><br><span class="line"></span><br><span class="line">    end_mem = df.memory_usage().<span class="built_in">sum</span>() / <span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Memory usage after optimization is: <span class="subst">&#123;end_mem:<span class="number">.2</span>f&#125;</span> MB&#x27;</span>)</span><br><span class="line">    decrease = <span class="number">100</span> * (start_mem - end_mem) / start_mem</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Decreased by <span class="subst">&#123;decrease:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">train_series = reduce_mem_usage(train_series)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mts = dict(zip(range(1,13), [month%12 // 3 + 1 for month in range(1, 13)]))</span><br><span class="line">target[&#x27;season&#x27;] = target.timestamp.dt.month.map(mts) </span><br><span class="line"></span><br><span class="line"># 1 -&gt; winter</span><br><span class="line"># 2 -&gt; spring</span><br><span class="line"># 3 -&gt; summer</span><br><span class="line"># 4 -&gt; fall</span><br><span class="line"></span><br><span class="line">target[&#x27;dayofweek&#x27;] = target.timestamp.dt.dayofweek</span><br><span class="line">target[&#x27;weekend&#x27;] = target.timestamp.dt.dayofweek &gt; 4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="others"><a class="markdownIt-Anchor" href="#others"></a> Others</h2>
<h3 id="pandas-文件处理"><a class="markdownIt-Anchor" href="#pandas-文件处理"></a> pandas 文件处理</h3>
<p>注意一些方法即可：</p>
<ol>
<li><code> pd.read_csv(文件名)</code>：默认分隔符为逗号</li>
</ol>
<p>参数：</p>
<ul>
<li><code>nrows</code>：需要读取的行数，从前向后</li>
<li><code>skiprows : int, list of int or Callable, optional</code>：需要跳过的行数</li>
<li><code>header</code> ： 通过设置 <code>header=None</code> 可以从第一行开始读取，后续通过 <code>df.columns = [col1, col2 ,...]</code> 来设置 columns 。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">my_csv = pd.read_csv(&quot;test.csv&quot;);</span><br><span class="line">print(my_csv)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">  Unnamed: 0  one  two</span><br><span class="line">0          a  1.0    2</span><br><span class="line">1          b  2.0    1</span><br><span class="line">2          c  3.0    3</span><br><span class="line">3          d  NaN    4</span><br></pre></td></tr></table></figure>
<ul>
<li>会出现Unnamed，这是因为他把行索引当成了单独的一列。可以用利用参数<code>index_col=0</code>将第0列作为索引。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(pd.read_csv(&quot;test.csv&quot;, index_col=0))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">   one  two</span><br><span class="line">a  1.0    2</span><br><span class="line">b  2.0    1</span><br><span class="line">c  3.0    3</span><br><span class="line">d  NaN    4</span><br></pre></td></tr></table></figure>
<ul>
<li>除此之外，<code>index_col</code>也可以传入列名称，将某列设置为索引。</li>
<li>使用<code>parse_dates = [列表名]</code>，将该列元素解析为datetime对象。</li>
<li>如果文件没有第一行，<code>header=None, names=[列的名称]</code></li>
<li>注意在识别中，会令一整列都识别为同一种类型。在csv中，NaN可以被识别为浮点数，但是none或者其他数值会被识别为字符串形式。使用<code>na_values=[]</code>参数来指定列表中的某些数值被识别为NaN。</li>
</ul>
<ol start="2">
<li><code>pd.read_table(文件名)</code>：默认分隔符为制表符</li>
<li><code>dataFrame.to_csv(文件名)</code>：写入到文件<br />
参数：
<ul>
<li><code>sep</code> 指定的文件分隔符号，默认为逗号</li>
<li><code>na_rep</code> 缺失值转换的字符串，默认为空字符串</li>
<li><code>header = False</code> 不输出列名称一行</li>
<li><code>index = False</code> 不输出行索引一列</li>
<li><code>cols/columns</code> 指定输出的列，传入列表</li>
</ul>
</li>
</ol>
<h3 id="警告-settingwithcopywarning"><a class="markdownIt-Anchor" href="#警告-settingwithcopywarning"></a> 警告 SettingWithCopyWarning</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SettingWithCopyWarning:</span><br><span class="line">A value is trying to be set on a copy of a slice from a DataFrame</span><br></pre></td></tr></table></figure>
<p>后果是可能导致<strong>修改pandas 单元格中的数据失败</strong>。</p>
<p>原理：当前操作的dataframe是从其他dataframe得到的，不是最初始的dataframe。因此，最好是在原始的dataframe上进行操作，这样就不报警告了。</p>
<p>Pandas 中的某些操作可以返回：</p>
<ul>
<li>数据的视图（View），即一份拷贝对象，共享数据地址，</li>
<li>数据的副本（Copy），即重新创建了一个不同的地址的新对象</li>
</ul>
<p>当 Pandas 检测链式赋值（Chained assignment）时会生成警告，让我们定义一些术语，方便后续的解释：</p>
<ul>
<li>赋值（Assignment） - 设置/更改某些变量值的操作，也被称为设置（set） 。</li>
<li>访问（Access） - 返回某些值的操作，例如下面的索引和链式索引示例。也被称为获取（get） 。</li>
<li>索引（Indexing） - 引用数据子集的任何赋值或访问方法，例如 data[1:5] 。</li>
<li>链式索引（Chaining） - 连续使用多个索引操作，例如data[1:5][1:3] 。</li>
</ul>
<br>
<p>链式赋值（Chained assignment） 是指<strong>链式索引和赋值的组合</strong>，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.bidder == &#x27;parakeet2004&#x27;][&#x27;bidderrate&#x27;] = 100</span><br></pre></td></tr></table></figure>
<p>如果检查一下，可以看到在这种情况下，值没有按预期改变。</p>
<p>是因为这个操作首先进行了索引，然后进行了赋值，但是没有在原始 DataFrame 上运行。</p>
<p>我们可以使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data.bidder == &#x27;parakeet2004&#x27;, &#x27;bidderrate&#x27;] = 100</span><br></pre></td></tr></table></figure>
<p>下面看另一种情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winners = data.loc[data.bid == data.price]</span><br><span class="line">winners.loc[304, &#x27;bidder&#x27;] = &#x27;therealname&#x27;</span><br></pre></td></tr></table></figure>
<p>代码按预期工作了，还是爆出警告，SettingWithCopyWarning！但我们使用了 <code>loc</code> 呀，</p>
<p>因为 winners 是作为 get 操作的输出创建的（data.loc[data.bid == data.price]），它可能是原始 DataFrame 的副本，也可能不是，但除非我们检查，否则我们不能了解到。当我们对 winners 进行索引时，我们实际上使用的是链式索引。</p>
<p>为了防止这种情况下的警告，解决方案是在创建新 DataFrame 时明确告知 Pandas 制作一个副本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winners = data.loc[data.bid == data.price].copy()</span><br><span class="line">winners.loc[304, &#x27;bidder&#x27;] = &#x27;therealname&#x27;</span><br></pre></td></tr></table></figure>
<p>所以，解决方法：</p>
<ol>
<li>如果要更改原始数据，请使用单一赋值操作。</li>
<li>如果你想要一个副本，请确保你强制让 Pandas 制作副本。</li>
</ol>
<br>
<p>定位：<br />
在代码的开头加上这两句，将警告升级为error，就会定位到出warning的地方啦：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import warnings</span><br><span class="line">warnings.filterwarnings(&#x27;error&#x27;)</span><br></pre></td></tr></table></figure>
<p>完整内容：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42575020/article/details/98846427">https://blog.csdn.net/weixin_42575020/article/details/98846427</a></p>
<h3 id="数据可视化"><a class="markdownIt-Anchor" href="#数据可视化"></a> 数据可视化</h3>
<p>draw correlation</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(50, 50))</span><br><span class="line">corr = df_imputed.corr()</span><br><span class="line">sns.heatmap(corr, cmap=&quot;YlGnBu&quot;, annot=True)</span><br><span class="line">plt.title(&#x27;Correlation Heatmap&#x27;, fontsize=30)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>box plot</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(20, 9))</span><br><span class="line">df[idxs].boxplot()</span><br><span class="line">plt.title(&#x27;Box Plot&#x27;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/08/Coding/Python/functools%E5%B7%A5%E5%85%B7%E5%8C%85/" rel="prev" title="functools工具包">
      <i class="fa fa-chevron-left"></i> functools工具包
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/08/Coding/Pandas/pandas%20%20Nan/" rel="next" title="pandas  Nan">
      pandas  Nan <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E7%82%B9"><span class="nav-number">1.</span> <span class="nav-text"> 其他点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#series"><span class="nav-number">2.</span> <span class="nav-text"> Series</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA"><span class="nav-number">2.1.</span> <span class="nav-text"> 创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#attribute"><span class="nav-number">2.2.</span> <span class="nav-text"> Attribute</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#dataframe"><span class="nav-number">3.</span> <span class="nav-text"> DataFrame</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-2"><span class="nav-number">3.1.</span> <span class="nav-text"> 创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7"><span class="nav-number">3.2.</span> <span class="nav-text"> 属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dtype-%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.2.1.</span> <span class="nav-text"> dtype 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E6%93%8D%E4%BD%9C"><span class="nav-number">3.2.2.</span> <span class="nav-text"> 数值操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-number">3.2.3.</span> <span class="nav-text"> 排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-number">3.2.4.</span> <span class="nav-text"> 增删改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#apply-map"><span class="nav-number">3.2.5.</span> <span class="nav-text"> apply &#x2F; map</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E6%96%B9%E5%BC%8F"><span class="nav-number">3.3.</span> <span class="nav-text"> 索引方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nan-%E5%A4%84%E7%90%86-%E5%A1%AB%E5%85%85"><span class="nav-number">3.4.</span> <span class="nav-text"> NAN 处理 &#x2F; 填充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%96%B9%E6%B3%95"><span class="nav-number">3.5.</span> <span class="nav-text"> 一些方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#groupby-%E8%81%9A%E5%90%88%E6%96%B9%E6%B3%95"><span class="nav-number">3.5.1.</span> <span class="nav-text"> groupby 聚合方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reset_index-%E5%92%8C-set_index"><span class="nav-number">3.5.2.</span> <span class="nav-text"> reset_index() 和 set_index()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%86%E5%88%86%E8%A1%8C%E5%90%88%E5%B9%B6%E8%A1%8C"><span class="nav-number">3.5.3.</span> <span class="nav-text"> 拆分行&#x2F;合并行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#explode"><span class="nav-number">3.5.3.1.</span> <span class="nav-text"> explode()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96"><span class="nav-number">3.6.</span> <span class="nav-text"> 内存优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#others"><span class="nav-number">3.7.</span> <span class="nav-text"> Others</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pandas-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="nav-number">3.7.1.</span> <span class="nav-text"> pandas 文件处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AD%A6%E5%91%8A-settingwithcopywarning"><span class="nav-number">3.7.2.</span> <span class="nav-text"> 警告 SettingWithCopyWarning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">3.7.3.</span> <span class="nav-text"> 数据可视化</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">A foolish, slow learner.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">336</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/YiandLi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;YiandLi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/yiliiiii" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yiliiiii" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">575k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">47:56</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
